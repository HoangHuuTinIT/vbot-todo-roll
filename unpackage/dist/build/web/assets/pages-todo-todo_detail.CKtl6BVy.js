import{T as e,u as t,a,c as s,r as i,a0 as l,i as n,a1 as o,a2 as r,a3 as c,a4 as d,a5 as u,a6 as h,a7 as m,W as p,N as g,s as f,L as y,a8 as v,a9 as A,aa as b,n as k,ab as x,ac as w,k as C,l as _,w as I,F as O,H as T,G as S,C as D,E,p as R,I as N,m as U,t as L,B as M,P as J,O as B,q as z,ad as V,ae as j,v as P,af as F,M as q,ag as Q,ah as Y,j as H,D as G,J as K,X as Z}from"./index-BBxu6ItV.js";import{e as W,o as X,_ as $,T as ee,a as te,b as ae,c as se}from"./TodoDatePicker.rJD0xhEk.js";import{_ as ie,C as le}from"./ConfirmModal.Bhspo6m3.js";import{T as ne,q as oe,s as re,r as ce,t as de,v as ue,i as he,w as me,u as pe,c as ge,x as fe,y as ye,z as ve,B as Ae,C as be,D as ke,m as xe,_ as we,U as Ce,e as _e,A as Ie,G as Oe,f as Te}from"./GlobalNotification.BP0YwJ99.js";const Se=e=>{if(!e||e<=0)return"";try{const t=new Date(e),a=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0");return`${a}-${s}-${i} ${l}:${n}:${"00"}`}catch{return""}},De=e=>{if(!e||-1===e||0===e)return"";const t=new Date(e);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},Ee=()=>{const{t:v}=t(),A=a(),b=s((()=>A.uid)),k=i(!1),x=i(!1),w=i(!1),C=i([]),_=i(!1),I=i(1),O=i(10),T=i(0),S=i(!1),D=i([]),E=i(!1),R=i(""),N=i(!1),U=i(!1),L=i(null),M=i(!1),J=i(""),B=i(!1),z=i(!1),V=i(!1),j=i(null),P=i(""),F=i(!1),q=i(null),Q=i(0),Y=s((()=>[v("todo.filter_activity_all"),v("todo.filter_activity_comment")])),H=["","COMMENT"],G=i(!1),K=i(""),Z=s((()=>Ie.value.raw&&"DONE"===Ie.value.raw.status)),X=s((()=>!Ie.value.raw||"DONE"===Ie.value.raw.status)),$=e=>{if(!e)return!0;if(e.includes("<img")||e.includes("<iframe"))return!1;let t=e.replace(/&nbsp;/gi," ");return t=t.replace(/<[^>]+>/g,""),0===t.trim().length},ee=async e=>{if(!e)return{cleanMessage:"",fileUrl:""};const t=/<img[^>]+src="([^">]+)"[^>]*>/g;let a,s="",i=e;const l=[];for(;null!==(a=t.exec(e));){const e=a[0],t=a[1];if(i=i.replace(e,""),t.startsWith("http")||t.startsWith("https"))s=t;else{const e=xe(t).then((e=>e)).catch((e=>(console.error("Upload áº£nh bÃ¬nh luáº­n lá»—i:",e),"")));l.push(e)}}if(l.length>0){const e=(await Promise.all(l)).find((e=>""!==e));e&&(s=e)}return i=i.trim(),{cleanMessage:i,fileUrl:s}},te=()=>{V.value=!1,se()},ae=()=>{const e=String(A.uid),t=Te.value.find((t=>String(t.UID)===e));return t?t.memberUID:e},se=()=>{z.value=!1,j.value=null,K.value="",P.value="",R.value=""},ie=()=>{F.value=!1,q.value=null},le=i(null),we=i(0),Ce=s((()=>[v("todo.history_all"),v("todo.history_todo"),v("todo.history_ticket"),v("todo.history_call"),v("todo.history_customer"),v("todo.history_note")])),_e=["ALL","TODO","TICKET","HISTORY_CALL","CUSTOMER","NOTE"],Ie=i({id:"",title:"",code:v("common.loading"),desc:"",statusIndex:0,sourceIndex:0,assigneeIndex:0,assigneeId:"",dueDate:"",notifyAt:"",customerCode:"",customerName:"",customerNameLabel:"",customerPhone:"",customerPhoneLabel:"",customerManagerName:"",customerManagerLabel:"",raw:void 0}),Oe=s((()=>[v("source.call"),v("source.customer"),v("source.conversation"),v("source.message")])),Te=i([]),Ee=i([]),Re=s((()=>{const e=[{label:v("todo.status_todo"),value:"TO_DO"},{label:v("todo.status_progress"),value:"IN_PROGRESS"},{label:v("todo.status_done"),value:"DONE"}];return Ie.value.raw&&"IN_PROGRESS"===Ie.value.raw.status?e.filter((e=>"TO_DO"!==e.value)):e})),Ne=s((()=>Re.value.map((e=>e.label)))),Ue=()=>{M.value=!1,le.value=null,R.value="",J.value=""};l((async e=>{await Le(),e&&e.id&&Me(e.id)}));const Le=async()=>{try{const e=await n();if(Te.value=e,Ee.value=e.map((e=>e.UserName||v("common.unknown_member"))),Ie.value.assigneeId){const e=Te.value.findIndex((e=>e.memberUID===Ie.value.assigneeId));-1!==e&&(Ie.value.assigneeIndex=e)}}catch(e){console.error("Lá»—i láº¥y members",e)}};o((()=>{console.log("Refreshing detail..."),(async()=>{if(Ie.value.id)try{await Promise.all([Me(Ie.value.id)])}catch(e){console.error(e)}finally{f()}else f()})()})),r((()=>{je()}));const Me=async t=>{Ie.value.title?c():k.value=!0;try{const a=await oe(t),s=(t=>{if(!t)return null;let a=[ne.NEW,ne.IN_PROGRESS,ne.DONE].indexOf(t.status);-1===a&&(a=0);let s=[e.CALL,e.CUSTOMER,e.CONVERSATION,e.CHAT_MESSAGE].indexOf(t.links);return-1===s&&(s=0),t.notificationReceivedAt,{id:t.id,title:t.title||"",code:t.code||"",desc:t.description||"",statusIndex:a,sourceIndex:s,assigneeIndex:0,assigneeId:t.assigneeId||"",dueDate:Se(t.dueDate),notifyAt:Se(t.notificationReceivedAt),customerCode:t.customerCode||"",customerName:"",customerNameLabel:"TÃªn khÃ¡ch hÃ ng",customerPhone:"",customerPhoneLabel:"Sá»‘ Ä‘iá»‡n thoáº¡i",customerManagerName:"",raw:t}})(a&&a.data&&!a.id?a.data:a);if(s){Ie.value=s;const e=s.raw.status,a=Re.value.findIndex((t=>t.value===e));if(-1!==a&&(Ie.value.statusIndex=a),Ie.value.assigneeId&&Te.value.length>0){const e=Te.value.findIndex((e=>e.memberUID===Ie.value.assigneeId));-1!==e&&(Ie.value.assigneeIndex=e)}Be(t),Ie.value.customerCode&&(ze(Ie.value.customerCode),Ve(Ie.value.customerCode))}}catch(a){console.error("Lá»—i láº¥y chi tiáº¿t:",a),re(v("common.error_connection"))}finally{k.value=!1,d()}},Je=e=>{var t;let a=v("todo.user_hidden"),s="?",i="#e3f2fd",l=!1;const n=String(A.uid);if(e.senderId){const t=String(e.senderId),s=Te.value.find((e=>String(e.UID)===t||String(e.memberUID)===t));s?(a=s.UserName,s.AvatarColor&&(i=s.AvatarColor),String(s.UID)===n&&(l=!0)):t===n&&(l=!0)}s=a.charAt(0).toUpperCase();let o="";switch(e.type){case"NEW_TODO":o=v("todo.action_NEW_TODO");break;case"REOPEN_TODO":o=v("todo.action_REOPEN_TODO");break;case"NEW_SUB_TODO":o=v("todo.action_NEW_SUB_TODO");break;case"UPDATE_TODO":o=v("todo.action_UPDATE_TODO");break;case"UPLOAD_ATTACHMENT":o=v("todo.action_UPLOAD_ATTACHMENT");break;case"COMMENT":o=v("todo.action_COMMENT");break;default:o=""}const r=(null==(t=e.reactions)?void 0:t.details)||[];return{id:e.id,senderId:e.senderId,senderName:a,senderAvatarChar:s,senderAvatarColor:i,message:e.message||"",files:e.files||"",timeDisplay:ke(e.createdAt,v),actionText:o,isEdited:!!e.updatedAt,type:e.type,reactions:r,children:[],isMe:l}},Be=async e=>{E.value=!0;try{const t=H[Q.value],a=await ce(e,t);Array.isArray(a)?D.value=a.map((e=>{const t=Je(e);return e.replies&&e.replies.length>0&&(t.children=e.replies.map((t=>{const a=Je(t);return a.rootParentId=e.id,a}))),t})):D.value=[]}catch(t){console.error("Lá»—i láº¥y bÃ¬nh luáº­n:",t)}finally{E.value=!1}},ze=async e=>{var t;x.value=!0;try{const a=A.todoToken;if(!a)return;const s=await u(a,e),i=s.fields||(null==(t=s.data)?void 0:t.fields)||[],l=i.find((e=>"name"===e.code)),n=i.find((e=>"phone"===e.code)),o=i.find((e=>"member_no"===e.code));if(l&&(Ie.value.customerName=l.value,Ie.value.customerNameLabel=l.name||v("todo.customer_name_label")),n&&(Ie.value.customerPhone=n.value,Ie.value.customerPhoneLabel=n.name),o){Ie.value.customerManagerLabel=o.name||v("todo.customer_manager_label");const e=o.value,t=Te.value.find((t=>t.memberUID===e));Ie.value.customerManagerName=t?t.UserName:v("todo.unknown")}}catch(a){console.error("Lá»—i CRM:",a)}finally{x.value=!1}},Ve=async(e,t=!1)=>{t?S.value=!0:(w.value=!0,I.value=1);try{const a=_e[we.value],s=A.todoToken;if(!s)return void console.error("ChÆ°a cÃ³ Token CRM/Todo");if(!t){const t=await h(s,e,a);T.value=t}const i=await m(s,e,a,I.value,O.value);if(Array.isArray(i)){const e=i.map((e=>{const t=new Date(e.createAt),a=`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`;let s=v("common.system");if(e.memberUid){const t=Te.value.find((t=>t.memberUID===e.memberUid));t&&(s=t.UserName)}let i="";if(e.typeSub){const t=`timeline.${e.typeSub}`;i=v(t),i===t&&(i=de[e.typeSub]||e.typeSub)}else i=v("todo.interaction_other");return{id:e.id,timeStr:a,content:i,actorName:s,originalType:e.typeSub}}));C.value=t?[...C.value,...e]:e}}catch(a){console.error("Lá»—i láº¥y lá»‹ch sá»­:",a)}finally{w.value=!1,S.value=!1}},je=()=>{w.value||S.value||C.value.length>=T.value||Ie.value.customerCode&&_.value&&(I.value+=1,Ve(Ie.value.customerCode,!0))};return{isLoading:k,isLoadingCustomer:x,isLoadingHistory:w,historyList:C,form:Ie,statusOptions:Ne,sourceOptions:Oe,assigneeOptions:Ee,onStatusChange:async e=>{const t=parseInt(e.detail.value),a=Re.value[t];if(!a)return;Ie.value.statusIndex=t;const s=a.value;if(Ie.value.raw){k.value=!0;try{const e={...Ie.value.raw,status:s,preFixCode:"TODO",description:Ie.value.desc,files:"",tagCodes:"",title:Ie.value.title||Ie.value.raw.title};console.log("Payload Update Status:",e);if(await pe(e)){ge(v("todo.msg_status_changed")),Ie.value.raw.status=s;const e=Re.value.findIndex((e=>e.value===s));Ie.value.statusIndex=-1!==e?e:0,Ie.value.customerCode&&await Ve(Ie.value.customerCode),await Be(Ie.value.id),p("refresh-todo-list",{type:"update",data:Ie.value.raw})}}catch(i){console.error("Lá»—i cáº­p nháº­t tráº¡ng thÃ¡i:",i),re(v("todo.msg_update_error"))}finally{k.value=!1}}},onSourceChange:e=>{Ie.value.sourceIndex=e.detail.value},onAssigneeChange:async e=>{const t=parseInt(e.detail.value);if(!Te.value[t])return;const a=Te.value[t].memberUID;if(Ie.value.assigneeIndex=t,Ie.value.assigneeId=a,Ie.value.raw){k.value=!0;try{const e={...Ie.value.raw,assigneeId:a,preFixCode:"TODO",description:Ie.value.desc,files:"",tagCodes:"",title:Ie.value.title||Ie.value.raw.title};console.log("Payload Update Assignee:",e);await pe(e)&&(ge(v("todo.msg_assignee_changed")),Ie.value.raw.assigneeId=a,Ie.value.customerCode&&await Ve(Ie.value.customerCode),await Be(Ie.value.id),p("refresh-todo-list",{type:"update",data:Ie.value.raw}))}catch(s){console.error("Lá»—i cáº­p nháº­t ngÆ°á»i giao:",s),re(v("todo.msg_update_error"))}finally{k.value=!1}}else re(v("common.error_missing_data"))},goBack:()=>{y()},saveTodo:()=>{console.log("LÆ°u:",Ie.value),ge(v("todo.msg_saved"))},historyFilterOptions:Ce,historyFilterIndex:we,onHistoryFilterChange:e=>{we.value=e.detail.value,Ie.value.customerCode&&Ve(Ie.value.customerCode)},comments:D,isLoadingComments:E,newCommentText:R,isSubmittingComment:N,submitComment:async()=>{if($(R.value))he(v("todo.msg_empty_content"));else{N.value=!0;try{const{cleanMessage:e,fileUrl:t}=await ee(R.value),a=Ie.value.id,s={todoId:a,senderId:ae(),message:e,files:t,parentId:-1},i=await fe(s);if(i){ge(v("todo.msg_comment_success")),R.value="";const e=await ye(i,a);if(e){const t=Je(e);D.value.unshift(t)}}}catch(e){console.error("Lá»—i gá»­i bÃ¬nh luáº­n:",e),re(v("common.error_send"))}finally{N.value=!1}}},isConfirmDeleteCommentOpen:U,onRequestDeleteComment:e=>{L.value=e,U.value=!0},confirmDeleteComment:async()=>{if(!L.value)return;const e=L.value;U.value=!1;try{await be(e),ge(v("todo.msg_deleted"));const t=D.value.findIndex((t=>t.id===e));if(-1!==t)D.value.splice(t,1);else for(const a of D.value)if(a.children&&a.children.length>0){const t=a.children.findIndex((t=>t.id===e));if(-1!==t){a.children.splice(t,1);break}}}catch(t){console.error("Lá»—i xÃ³a bÃ¬nh luáº­n:",t),re(v("common.fail_delete"))}finally{L.value=null}},cancelDeleteComment:()=>{U.value=!1,L.value=null},currentUserId:b,isEditingComment:M,onRequestEditComment:async e=>{const t=Ie.value.id;if(t){z.value=!1,j.value=null,P.value="",K.value="";try{const a=await ye(e,t);if(console.log("API Response Detail:",a),a){const e=a.data||a;le.value={id:e.id,todoId:e.todoId,senderId:e.senderId};const t=e.senderId,s=Te.value.find((e=>e.UID===t));J.value=s?s.UserName:v("common.me");const i=e.message||"";console.log("Ná»™i dung edit:",i),M.value=!0,await g(),R.value=i}}catch(a){console.error("Lá»—i láº¥y chi tiáº¿t bÃ¬nh luáº­n:",a),re(v("common.error_load"))}finally{k.value=!1}}},submitUpdateComment:async()=>{if(le.value)if($(R.value))he(v("todo.msg_empty_content"));else{N.value=!0;try{const{cleanMessage:e,fileUrl:t}=await ee(R.value),a={id:le.value.id,todoId:le.value.todoId,senderId:le.value.senderId,message:e,files:t},s=await Ae(a);if(s){ge(v("todo.msg_update_success"));const e=D.value.findIndex((e=>e.id===s.id));if(-1!==e)D.value[e].message=s.message,D.value[e].files=s.files,D.value[e].isEdited=!0;else for(const t of D.value)if(t.children){const e=t.children.findIndex((e=>e.id===s.id));if(-1!==e){t.children[e].message=s.message,t.children[e].files=s.files,t.children[e].isEdited=!0;break}}Ue()}}catch(e){console.error("Lá»—i cáº­p nháº­t:",e),re(v("common.error_update"))}finally{N.value=!1}}},onCancelEditComment:()=>{B.value=!0},isConfirmCancelEditOpen:B,continueEditing:()=>{B.value=!1},confirmCancelEdit:async()=>{B.value=!1,Ue()},editingMemberName:J,isEmojiPickerOpen:F,emojiList:["ðŸ‘","ðŸ‘Ž","ðŸ˜","ðŸ˜†","ðŸ˜±","ðŸ˜­","ðŸ˜¤"],onToggleEmojiPicker:e=>{q.value=e,F.value=!0},closeEmojiPicker:ie,selectEmoji:async e=>{if(!q.value)return;const t=q.value.id;ie();const a=Ie.value.id,s=A.uid,i={todoId:Number(a),senderId:s,todoMessageId:Number(t),codeEmoji:e};try{if(await ve(i)){let a=null;const i=D.value.findIndex((e=>e.id===t));if(-1!==i)a=D.value[i];else for(const e of D.value)if(e.children){const s=e.children.find((e=>e.id===t));if(s){a=s;break}}if(a){a.reactions||(a.reactions=[]);const t=a.reactions.findIndex((e=>e.senderId===s));if(-1!==t){a.reactions[t].codeEmoji===e?console.log("User tháº£ trÃ¹ng emoji cÅ©"):a.reactions[t].codeEmoji=e}else a.reactions.push({codeEmoji:e,senderId:s});a.reactions=[...a.reactions]}}}catch(l){console.error("Lá»—i tháº£ cáº£m xÃºc:",l),re(v("common.error_connection"))}},isReplying:z,isConfirmCancelReplyOpen:V,replyingCommentData:j,replyingMemberName:P,onRequestReply:async e=>{M.value=!1,le.value=null,R.value="",j.value=e;const t=e.message||"",{cleanHtml:a}=W(t);K.value=a,z.value=!0;const s=e.senderId,i=Te.value.find((e=>e.memberUID===s));P.value=i?i.UserName:v("todo.user_hidden"),await g()},onCancelReply:()=>{R.value.trim()?V.value=!0:te()},confirmCancelReply:te,continueReplying:()=>{V.value=!1},submitReply:async()=>{if($(R.value))he(v("todo.msg_empty_content"));else if(j.value){N.value=!0;try{const{cleanMessage:e,fileUrl:t}=await ee(R.value),a=Ie.value.id,s=ae();let i=j.value.id;j.value.rootParentId&&(i=j.value.rootParentId);const l={todoId:a,senderId:s,message:e,files:t,parentId:i},n=await fe(l);if(n){ge(v("todo.msg_reply_success"));const e=await ye(n,Ie.value.id),t=Je(e),a=j.value.rootParentId||j.value.id,s=D.value.find((e=>e.id===a));s&&(s.children||(s.children=[]),t.rootParentId=a,s.children.push(t)),se()}}catch(e){console.error("Lá»—i gá»­i tráº£ lá»i:",e),re(v("common.error_send"))}finally{N.value=!1}}},commentFilterIndex:Q,commentFilterOptions:Y,onCommentFilterChange:e=>{const t=e.detail.value;Q.value!==t&&(Q.value=t,Ie.value.id&&Be(Ie.value.id))},isSavingDescription:G,onSaveDescription:async()=>{if(!Z.value)if(Ie.value.raw){G.value=!0;try{const{newContent:e,fileUrls:t}=await(async e=>{if(!e)return{newContent:"",fileUrls:[]};const t=/<img[^>]+src="([^">]+)"/g;let a;const s=[],i=[],l=[];for(;null!==(a=t.exec(e));){const e=a[1];if(!e.startsWith("http")&&!e.startsWith("https")){const t=xe(e).then((t=>{i.push({oldSrc:e,newSrc:t}),l.push(t)})).catch((e=>{console.error("Upload áº£nh detail lá»—i:",e)}));s.push(t)}}s.length>0&&await Promise.all(s);let n=e;return i.forEach((e=>{n=n.split(e.oldSrc).join(e.newSrc)})),{newContent:n,fileUrls:l}})(Ie.value.desc);Ie.value.desc=e;const a=t.length>0?t.join(","):"",s={...Ie.value.raw,preFixCode:"TODO",description:Ie.value.desc,files:a,tagCodes:"",title:Ie.value.title||Ie.value.raw.title};console.log("Payload Update Description:",s);await pe(s)&&(ge(v("todo.msg_desc_saved")),Ie.value.raw.description=Ie.value.desc,a&&(Ie.value.raw.files=a),await Be(Ie.value.id),p("refresh-todo-list",{type:"update",data:Ie.value.raw}))}catch(e){console.error("Lá»—i cáº­p nháº­t cÃ´ng viá»‡c:",e),re(v("common.error_update"))}finally{G.value=!1}}else re(v("common.error_missing_data"))},onDateUpdate:async e=>{if(Z.value)return;if(!Ie.value.raw)return;let t=Ie.value.dueDate,a=Ie.value.notifyAt;"dueDate"===e.field?t=e.value:"notifyAt"===e.field&&(a=e.value);if(!ue(t,a))return he(v("todo.msg_notify_must_be_before_due")),"dueDate"===e.field?Ie.value.dueDate:Ie.value.notifyAt,void("dueDate"===e.field?Ie.value.dueDate=Ie.value.raw.dueDate?me(Ie.value.raw.dueDate):"":Ie.value.notifyAt=Ie.value.raw.notificationReceivedAt?me(Ie.value.raw.notificationReceivedAt):"");k.value=!0;try{const t={...Ie.value.raw,preFixCode:"TODO",description:Ie.value.desc,files:"",tagCodes:"",title:Ie.value.title||Ie.value.raw.title},a=(e=>{if(!e)return 0;try{const t=e.replace(/-/g,"/");return new Date(t).getTime()}catch{return 0}})(e.value);"dueDate"===e.field?t.dueDate=a:"notifyAt"===e.field&&(t.notificationReceivedAt=a),console.log(`Payload Update ${e.field}:`,t);await pe(t)&&(ge(v("todo.msg_update_success")),"dueDate"===e.field?(Ie.value.raw.dueDate=t.dueDate,Ie.value.dueDate=e.value,Ie.value.raw&&(Ie.value.raw.dueDateFormatted=De(t.dueDate))):(Ie.value.raw.notificationReceivedAt=t.notificationReceivedAt,Ie.value.notifyAt=e.value,Ie.value.raw&&(Ie.value.raw.notifyAtFormatted=De(t.notificationReceivedAt))),Ie.value.customerCode&&await Ve(Ie.value.customerCode),await Be(Ie.value.id),p("refresh-todo-list",{type:"update",data:Ie.value.raw}))}catch(s){console.error("Lá»—i cáº­p nháº­t ngÃ y:",s),re(v("todo.msg_update_error")),"dueDate"===e.field?Ie.value.dueDate=me(Ie.value.raw.dueDate):Ie.value.notifyAt=me(Ie.value.raw.notificationReceivedAt)}finally{k.value=!1}},isStatusDisabled:X,dynamicStatusOptions:Re,onSaveTitle:async()=>{if(Z.value)return;if(!Ie.value.raw)return;const e=Ie.value.title?Ie.value.title.trim():"",t=Ie.value.raw.title;if(!e)return he(v("todo.msg_title_empty")),void(Ie.value.title=t);if(e!==t){k.value=!0;try{const t={...Ie.value.raw,title:e,preFixCode:"TODO",description:Ie.value.raw.description,files:Ie.value.raw.files||"",tagCodes:Ie.value.raw.tagCodes||""};console.log("Payload Update Title:",t);await pe(t)&&(ge(v("todo.msg_title_changed")),Ie.value.raw.title=e,Ie.value.customerCode&&await Ve(Ie.value.customerCode),await Be(Ie.value.id),p("refresh-todo-list",{type:"update",data:Ie.value.raw}))}catch(a){console.error("Lá»—i cáº­p nháº­t tiÃªu Ä‘á»:",a),re(v("todo.msg_update_error")),Ie.value.title=t}finally{k.value=!1}}},replyingMessagePreview:K,isHistoryOpen:_,toggleHistory:()=>{_.value=!_.value},isDone:Z,loadMoreHistory:je,isLoadingMoreHistory:S}};var Re={abbr:!0,b:!0,big:!0,code:!0,del:!0,em:!0,i:!0,ins:!0,label:!0,q:!0,small:!0,span:!0,strong:!0,sub:!0,sup:!0};const Ne={isInline:function(e,t){return Re[e]||-1!==(t||"").indexOf("display:inline")}},Ue=e=>{e.$wxs||(e.$wxs=[]),e.$wxs.push("handler"),e.mixins||(e.mixins=[]),e.mixins.push({beforeCreate(){this.handler=Ne}})},Le={name:"node",options:{},data:()=>({ctrl:{},nodes:[]}),props:{name:String,attrs:{type:Object,default:()=>({})},childs:Array,opts:Array},watch:{childs:{handler(e){for(;this.nodes.length>e.length;)e.push({});this.nodes=e},immediate:!0}},components:{},mounted(){if(this.$nextTick((()=>{for(this.root=this.$parent;"mp-html"!==this.root.$options.name;this.root=this.root.$parent);})),this.opts[0]){let e;for(e=this.childs.length;e--&&"img"!==this.childs[e].name;);-1!==e&&(this.observer=v(this).relativeToViewport({top:500,bottom:500}),this.observer.observe("._img",(e=>{e.intersectionRatio&&(this.$set(this.ctrl,"load",1),this.observer.disconnect())})))}},beforeDestroy(){this.observer&&this.observer.disconnect()},methods:{play(e){const t=e.currentTarget.dataset.i,a=this.childs[t];if(this.root.$emit("play",{source:a.name,attrs:{...a.attrs,src:a.src[this.ctrl[t]||0]}}),this.root.pauseVideo){let t=!1;const a=e.target.id;for(let e=this.root._videos.length;e--;)this.root._videos[e].id===a?t=!0:this.root._videos[e].pause();if(!t){const e=A(a,this);e.id=a,this.root.playbackRate&&e.playbackRate(this.root.playbackRate),this.root._videos.push(e)}}},mediaEvent(e){const t=e.currentTarget.dataset.i,a=this.childs[t];this.root.$emit(e.type,{...e.detail,source:a.name,attrs:{...a.attrs,src:a.src[this.ctrl[t]||0]}})},imgTap(e){const t=this.childs[e.currentTarget.dataset.i];t.a?this.linkTap(t.a):t.attrs.ignore||(t.attrs.src=t.attrs.src||t.attrs["data-src"],this.root.$emit("imgtap",t.attrs),this.root.previewImg&&b({current:parseInt(t.attrs.i),urls:this.root.imgList}))},imgLongTap(e){},imgLoad(e){const t=e.currentTarget.dataset.i;(this.opts[1]&&!this.ctrl[t]||-1===this.ctrl[t])&&this.$set(this.ctrl,t,1),this.checkReady()},checkReady(){this.root&&!this.root.lazyLoad&&(this.root._unloadimgs-=1,this.root._unloadimgs||setTimeout((()=>{this.root.getRect().then((e=>{this.root.$emit("ready",e)})).catch((()=>{this.root.$emit("ready",{})}))}),350))},linkTap(e){const t=e.currentTarget?this.childs[e.currentTarget.dataset.i]:{},a=t.attrs||e,s=a.href;this.root.$emit("linktap",Object.assign({innerText:this.root.getText(t.children||[])},a)),s&&("#"===s[0]?this.root.navigateTo(s.substring(1)).catch((()=>{})):s.split("?")[0].includes("://")?this.root.copyLink&&window.open(s):k({url:s,fail(){x({url:s,fail(){}})}}))},mediaError(e){const t=e.currentTarget.dataset.i,a=this.childs[t];if("video"===a.name||"audio"===a.name){let e=(this.ctrl[t]||0)+1;if(e>a.src.length&&(e=0),e<a.src.length)return void this.$set(this.ctrl,t,e)}else if("img"===a.name){if(this.opts[0]&&!this.ctrl.load)return;this.opts[2]&&this.$set(this.ctrl,t,-1),this.checkReady()}this.root&&this.root.$emit("error",{source:a.name,attrs:a.attrs})}}};Ue(Le);const Me=we(Le,[["render",function(e,t,a,s,i,l){const n=J,o=B,r=w("node",!0),c=z,d=V,u=j;return C(),_(c,{id:a.attrs.id,class:R("_block _"+a.name+" "+a.attrs.class),style:D(a.attrs.style)},{default:I((()=>[(C(!0),O(T,null,S(i.nodes,((s,h)=>(C(),O(T,{key:h},["img"===s.name&&!s.t&&(a.opts[1]&&!i.ctrl[h]||i.ctrl[h]<0)?(C(),_(n,{key:0,class:"_img",style:D(s.attrs.style),src:i.ctrl[h]<0?a.opts[2]:a.opts[1],mode:"widthFix"},null,8,["style","src"])):E("",!0),"img"===s.name?(C(),O("img",{key:1,id:s.attrs.id,class:R("_img "+s.attrs.class),style:D((-1===i.ctrl[h]?"display:none;":"")+s.attrs.style),src:s.attrs.src||(i.ctrl.load?s.attrs["data-src"]:""),"data-i":h,onLoad:t[0]||(t[0]=(...e)=>l.imgLoad&&l.imgLoad(...e)),onError:t[1]||(t[1]=(...e)=>l.mediaError&&l.mediaError(...e)),onClick:t[2]||(t[2]=N(((...e)=>l.imgTap&&l.imgTap(...e)),["stop"])),onLongpress:t[3]||(t[3]=(...e)=>l.imgLongTap&&l.imgLongTap(...e))},null,46,["id","src","data-i"])):s.text?(C(),_(o,{key:2,decode:""},{default:I((()=>[U(L(s.text),1)])),_:2},1024)):"br"===s.name?(C(),_(o,{key:3},{default:I((()=>[U(L("\n"))])),_:1})):"a"===s.name?(C(),_(c,{key:4,id:s.attrs.id,class:R((s.attrs.href?"_a ":"")+s.attrs.class),"hover-class":"_hover",style:D("display:inline;"+s.attrs.style),"data-i":h,onClick:N(l.linkTap,["stop"])},{default:I((()=>[M(r,{name:"span",childs:s.children,opts:a.opts,style:{display:"inherit"}},null,8,["childs","opts"])])),_:2},1032,["id","class","style","data-i","onClick"])):"video"===s.name?(C(),_(d,{key:5,id:s.attrs.id,class:R(s.attrs.class),style:D(s.attrs.style),autoplay:s.attrs.autoplay,controls:s.attrs.controls,loop:s.attrs.loop,muted:s.attrs.muted,"object-fit":s.attrs["object-fit"],poster:s.attrs.poster,src:s.src[i.ctrl[h]||0],"data-i":h,onPlay:l.play,onPause:l.mediaEvent,onFullscreenchange:l.mediaEvent,onError:l.mediaError},null,8,["id","class","style","autoplay","controls","loop","muted","object-fit","poster","src","data-i","onPlay","onPause","onFullscreenchange","onError"])):"iframe"===s.name?(C(),O("iframe",{key:6,style:D(s.attrs.style),allowfullscreen:s.attrs.allowfullscreen,frameborder:s.attrs.frameborder,src:s.attrs.src},null,12,["allowfullscreen","frameborder","src"])):"embed"===s.name?(C(),O("embed",{key:7,style:D(s.attrs.style),src:s.attrs.src},null,12,["src"])):"table"===s.name&&s.c||"li"===s.name?(C(),_(c,{key:8,id:s.attrs.id,class:R("_"+s.name+" "+s.attrs.class),style:D(s.attrs.style)},{default:I((()=>["li"===s.name?(C(),_(r,{key:0,childs:s.children,opts:a.opts},null,8,["childs","opts"])):(C(!0),O(T,{key:1},S(s.children,((e,t)=>(C(),_(c,{key:t,class:R("_"+e.name+" "+e.attrs.class),style:D(e.attrs.style)},{default:I((()=>["td"===e.name||"th"===e.name?(C(),_(r,{key:0,childs:e.children,opts:a.opts},null,8,["childs","opts"])):(C(!0),O(T,{key:1},S(e.children,((e,t)=>(C(),O(T,{key:t},["td"===e.name||"th"===e.name?(C(),_(c,{key:0,class:R("_"+e.name+" "+e.attrs.class),style:D(e.attrs.style)},{default:I((()=>[M(r,{childs:e.children,opts:a.opts},null,8,["childs","opts"])])),_:2},1032,["class","style"])):(C(),_(c,{key:1,class:R("_"+e.name+" "+e.attrs.class),style:D(e.attrs.style)},{default:I((()=>[(C(!0),O(T,null,S(e.children,((e,t)=>(C(),_(c,{key:t,class:R("_"+e.name+" "+e.attrs.class),style:D(e.attrs.style)},{default:I((()=>[M(r,{childs:e.children,opts:a.opts},null,8,["childs","opts"])])),_:2},1032,["class","style"])))),128))])),_:2},1032,["class","style"]))],64)))),128))])),_:2},1032,["class","style"])))),128))])),_:2},1032,["id","class","style"])):s.c||e.handler.isInline(s.name,s.attrs.style)?2===s.c?(C(),_(c,{key:10,id:s.attrs.id,class:R("_block _"+s.name+" "+s.attrs.class),style:D(s.f+";"+s.attrs.style)},{default:I((()=>[(C(!0),O(T,null,S(s.children,((e,t)=>(C(),_(r,{key:t,style:D(e.f),name:e.name,attrs:e.attrs,childs:e.children,opts:a.opts},null,8,["style","name","attrs","childs","opts"])))),128))])),_:2},1032,["id","class","style"])):(C(),_(r,{key:11,style:D(s.f),name:s.name,attrs:s.attrs,childs:s.children,opts:a.opts},null,8,["style","name","attrs","childs","opts"])):(C(),_(u,{key:9,id:s.attrs.id,style:D(s.f),"user-select":a.opts[4],nodes:[s]},null,8,["id","style","user-select","nodes"]))],64)))),128))])),_:1},8,["id","class","style"])}],["__scopeId","data-v-c6611527"]]),Je={trustTags:Fe("a,abbr,ad,audio,b,blockquote,br,code,col,colgroup,dd,del,dl,dt,div,em,fieldset,h1,h2,h3,h4,h5,h6,hr,i,img,ins,label,legend,li,ol,p,q,ruby,rt,source,span,strong,sub,sup,table,tbody,td,tfoot,th,thead,tr,title,ul,video"),blockTags:Fe("address,article,aside,body,caption,center,cite,footer,header,html,nav,pre,section"),ignoreTags:Fe("area,base,canvas,embed,frame,head,iframe,input,link,map,meta,param,rp,script,source,style,textarea,title,track,wbr"),voidTags:Fe("area,base,br,col,circle,ellipse,embed,frame,hr,img,input,line,link,meta,param,path,polygon,rect,source,track,use,wbr"),entities:{lt:"<",gt:">",quot:'"',apos:"'",ensp:"â€‚",emsp:"â€ƒ",nbsp:"Â ",semi:";",ndash:"â€“",mdash:"â€”",middot:"Â·",lsquo:"â€˜",rsquo:"â€™",ldquo:"â€œ",rdquo:"â€",bull:"â€¢",hellip:"â€¦",larr:"â†",uarr:"â†‘",rarr:"â†’",darr:"â†“"},tagStyle:{address:"font-style:italic",big:"display:inline;font-size:1.2em",caption:"display:table-caption;text-align:center",center:"text-align:center",cite:"font-style:italic",dd:"margin-left:40px",mark:"background-color:yellow",pre:"font-family:monospace;white-space:pre",s:"text-decoration:line-through",small:"display:inline;font-size:0.8em",strike:"text-decoration:line-through",u:"text-decoration:underline"},svgDict:{animatetransform:"animateTransform",lineargradient:"linearGradient",viewbox:"viewBox",attributename:"attributeName",repeatcount:"repeatCount",repeatdur:"repeatDur",foreignobject:"foreignObject"}},Be={};let ze;const Ve=P();ze=Ve.windowWidth;const je=Fe(" ,\r,\n,\t,\f");let Pe=0;function Fe(e){const t=Object.create(null),a=e.split(",");for(let s=a.length;s--;)t[a[s]]=!0;return t}function qe(e,t){let a=e.indexOf("&");for(;-1!==a;){const s=e.indexOf(";",a+3);let i;if(-1===s)break;"#"===e[a+1]?(i=parseInt(("x"===e[a+2]?"0":"")+e.substring(a+2,s)),isNaN(i)||(e=e.substr(0,a)+String.fromCharCode(i)+e.substr(s+1))):(i=e.substring(a+1,s),(Je.entities[i]||"amp"===i&&t)&&(e=e.substr(0,a)+(Je.entities[i]||"&")+e.substr(s+1))),a=e.indexOf("&",a+1)}return e}function Qe(e){let t=e.length-1;for(let a=t;a>=-1;a--)(-1===a||e[a].c||!e[a].name||"div"!==e[a].name&&"p"!==e[a].name&&"h"!==e[a].name[0]||(e[a].attrs.style||"").includes("inline"))&&(t-a>=5&&e.splice(a+1,t-a,{name:"div",attrs:{},children:e.slice(a+1,t+1)}),t=a-1)}function Ye(e){this.options=e||{},this.tagStyle=Object.assign({},Je.tagStyle,this.options.tagStyle),this.imgList=e.imgList||[],this.imgList._unloadimgs=0,this.plugins=e.plugins||[],this.attrs=Object.create(null),this.stack=[],this.nodes=[],this.pre=(this.options.containerStyle||"").includes("white-space")&&this.options.containerStyle.includes("pre")?2:0}function He(e){this.handler=e}Je.ignoreTags.iframe=void 0,Je.trustTags.iframe=!0,Je.ignoreTags.embed=void 0,Je.trustTags.embed=!0,Ye.prototype.parse=function(e){for(let t=this.plugins.length;t--;)this.plugins[t].onUpdate&&(e=this.plugins[t].onUpdate(e,Je)||e);for(new He(this).parse(e);this.stack.length;)this.popNode();return this.nodes.length>50&&Qe(this.nodes),this.nodes},Ye.prototype.expose=function(){for(let e=this.stack.length;e--;){const t=this.stack[e];if(t.c||"a"===t.name||"video"===t.name||"audio"===t.name)return;t.c=1}},Ye.prototype.hook=function(e){for(let t=this.plugins.length;t--;)if(this.plugins[t].onParse&&!1===this.plugins[t].onParse(e,this))return!1;return!0},Ye.prototype.getUrl=function(e){const t=this.options.domain;return"/"===e[0]?"/"===e[1]?e=(t?t.split("://")[0]:"http")+":"+e:t&&(e=t+e):e.includes("data:")||e.includes("://")||t&&(e=t+"/"+e),e},Ye.prototype.parseStyle=function(e){const t=e.attrs,a=(this.tagStyle[e.name]||"").split(";").concat((t.style||"").split(";")),s={};let i="";t.id&&!this.xml&&(this.options.useAnchor?this.expose():"img"!==e.name&&"a"!==e.name&&"video"!==e.name&&"audio"!==e.name&&(t.id=void 0)),t.width&&(s.width=parseFloat(t.width)+(t.width.includes("%")?"%":"px"),t.width=void 0),t.height&&(s.height=parseFloat(t.height)+(t.height.includes("%")?"%":"px"),t.height=void 0);for(let l=0,n=a.length;l<n;l++){const e=a[l].split(":");if(e.length<2)continue;const t=e.shift().trim().toLowerCase();let n=e.join(":").trim();if("-"===n[0]&&n.lastIndexOf("-")>0||n.includes("safe"))i+=`;${t}:${n}`;else if(!s[t]||n.includes("import")||!s[t].includes("import")){if(n.includes("url")){let e=n.indexOf("(")+1;if(e){for(;'"'===n[e]||"'"===n[e]||je[n[e]];)e++;n=n.substr(0,e)+this.getUrl(n.substr(e))}}else n.includes("rpx")&&(n=n.replace(/[0-9.]+\s*rpx/g,(e=>parseFloat(e)*ze/750+"px")));s[t]=n}}return e.attrs.style=i,s},Ye.prototype.onTagName=function(e){this.tagName=this.xml?e:e.toLowerCase(),"svg"===this.tagName&&(this.xml=(this.xml||0)+1,Je.ignoreTags.style=void 0)},Ye.prototype.onAttrName=function(e){(e=this.xml?e:e.toLowerCase()).includes("?")||e.includes(";")?this.attrName=void 0:"data-"===e.substr(0,5)?"data-src"!==e||this.attrs.src?"img"===this.tagName||"a"===this.tagName?this.attrName=e:this.attrName=void 0:this.attrName="src":(this.attrName=e,this.attrs[e]="T")},Ye.prototype.onAttrVal=function(e){const t=this.attrName||"";"style"===t||"href"===t?this.attrs[t]=qe(e,!0):t.includes("src")?this.attrs[t]=this.getUrl(qe(e,!0)):t&&(this.attrs[t]=e)},Ye.prototype.onOpenTag=function(e){const t=Object.create(null);t.name=this.tagName,t.attrs=this.attrs,this.options.nodes.length&&(t.type="node"),this.attrs=Object.create(null);const a=t.attrs,s=this.stack[this.stack.length-1],i=s?s.children:this.nodes,l=this.xml?e:Je.voidTags[t.name];if(Be[t.name]&&(a.class=Be[t.name]+(a.class?" "+a.class:"")),"embed"===t.name&&this.expose(),"video"!==t.name&&"audio"!==t.name||("video"!==t.name||a.id||(a.id="v"+Pe++),a.controls||a.autoplay||(a.controls="T"),t.src=[],a.src&&(t.src.push(a.src),a.src=void 0),this.expose()),l){if(!this.hook(t)||Je.ignoreTags[t.name])return void("base"!==t.name||this.options.domain?"source"===t.name&&s&&("video"===s.name||"audio"===s.name)&&a.src&&s.src.push(a.src):this.options.domain=a.href);const e=this.parseStyle(t);if("img"===t.name){if(a.src&&(a.src.includes("webp")&&(t.webp="T"),a.src.includes("data:")&&"all"!==this.options.previewImg&&!a["original-src"]&&(a.ignore="T"),!a.ignore||t.webp||a.src.includes("cloud://"))){for(let i=this.stack.length;i--;){const s=this.stack[i];"a"===s.name&&(t.a=s.attrs),"table"!==s.name||t.webp||a.src.includes("cloud://")||(!e.display||e.display.includes("inline")?t.t="inline-block":t.t=e.display,e.display=void 0),s.c=1}a.i=this.imgList.length.toString();let s=a["original-src"]||a.src;this.imgList.push(s),t.t||(this.imgList._unloadimgs+=1),this.options.lazyLoad&&(a["data-src"]=a.src,a.src=void 0)}"inline"===e.display&&(e.display=""),a.ignore&&(e["max-width"]=e["max-width"]||"100%",a.style+=";-webkit-touch-callout:none"),parseInt(e.width)>ze&&(e.height=void 0),isNaN(parseInt(e.width))||(t.w="T"),!isNaN(parseInt(e.height))&&(!e.height.includes("%")||s&&(s.attrs.style||"").includes("height"))&&(t.h="T"),t.w&&t.h&&e["object-fit"]&&("contain"===e["object-fit"]?t.m="aspectFit":"cover"===e["object-fit"]&&(t.m="aspectFill"))}else if("svg"===t.name)return i.push(t),this.stack.push(t),void this.popNode();for(const t in e)e[t]&&(a.style+=`;${t}:${e[t].replace(" !important","")}`);a.style=a.style.substr(1)||void 0}else("pre"===t.name||(a.style||"").includes("white-space")&&a.style.includes("pre"))&&2!==this.pre&&(this.pre=t.pre=1),t.children=[],this.stack.push(t);i.push(t)},Ye.prototype.onCloseTag=function(e){let t;for(e=this.xml?e:e.toLowerCase(),t=this.stack.length;t--&&this.stack[t].name!==e;);if(-1!==t)for(;this.stack.length>t;)this.popNode();else if("p"===e||"br"===e){(this.stack.length?this.stack[this.stack.length-1].children:this.nodes).push({name:e,attrs:{class:Be[e]||"",style:this.tagStyle[e]||""}})}},Ye.prototype.popNode=function(){const e=this.stack.pop();let t=e.attrs;const a=e.children,s=this.stack[this.stack.length-1],i=s?s.children:this.nodes;if(!this.hook(e)||Je.ignoreTags[e.name])return"title"===e.name&&a.length&&"text"===a[0].type&&this.options.setTitle&&F({title:a[0].text}),void i.pop();if(e.pre&&2!==this.pre){this.pre=e.pre=void 0;for(let e=this.stack.length;e--;)this.stack[e].pre&&(this.pre=1)}const l={};if("svg"===e.name){if(this.xml>1)return void this.xml--;let a="";const s=t.style;return t.style="",t.xmlns="http://www.w3.org/2000/svg",function e(t){if("text"===t.type)return void(a+=t.text);const s=Je.svgDict[t.name]||t.name;if("foreignObject"===s)for(const a of t.children||[])if(a.attrs&&!a.attrs.xmlns){a.attrs.xmlns="http://www.w3.org/1999/xhtml";break}a+="<"+s;for(const i in t.attrs){const e=t.attrs[i];e&&(a+=` ${Je.svgDict[i]||i}="${e.replace(/"/g,"")}"`)}if(t.children){a+=">";for(let a=0;a<t.children.length;a++)e(t.children[a]);a+="</"+s+">"}else a+="/>"}(e),e.name="img",e.attrs={src:"data:image/svg+xml;utf8,"+a.replace(/#/g,"%23"),style:s,ignore:"T"},e.children=void 0,this.xml=!1,void(Je.ignoreTags.style=!0)}if(t.align&&("table"===e.name?"center"===t.align?l["margin-inline-start"]=l["margin-inline-end"]="auto":l.float=t.align:l["text-align"]=t.align,t.align=void 0),t.dir&&(l.direction=t.dir,t.dir=void 0),"font"===e.name&&(t.color&&(l.color=t.color,t.color=void 0),t.face&&(l["font-family"]=t.face,t.face=void 0),t.size)){let e=parseInt(t.size);isNaN(e)||(e<1?e=1:e>7&&(e=7),l["font-size"]=["x-small","small","medium","large","x-large","xx-large","xxx-large"][e-1]),t.size=void 0}if((t.class||"").includes("align-center")&&(l["text-align"]="center"),Object.assign(l,this.parseStyle(e)),"table"!==e.name&&parseInt(l.width)>ze&&(l["max-width"]="100%",l["box-sizing"]="border-box"),Je.blockTags[e.name]?e.name="div":Je.trustTags[e.name]||this.xml||(e.name="span"),"a"===e.name||"ad"===e.name||"iframe"===e.name)this.expose();else if("video"===e.name)(l.height||"").includes("auto")&&(l.height=void 0);else if("ul"!==e.name&&"ol"!==e.name||!e.c)if("table"===e.name){let s=parseFloat(t.cellpadding),i=parseFloat(t.cellspacing);const n=parseFloat(t.border),o=l["border-color"],r=l["border-style"];if(e.c&&(isNaN(s)&&(s=2),isNaN(i)&&(i=2)),n&&(t.style+=`;border:${n}px ${r||"solid"} ${o||"gray"}`),e.flag&&e.c){l.display="grid","collapse"===l["border-collapse"]&&(l["border-collapse"]=void 0,i=0),i?(l["grid-gap"]=i+"px",l.padding=i+"px"):n&&(t.style+=";border-left:0;border-top:0");const c=[],d=[],u=[],h={};!function e(t){for(let a=0;a<t.length;a++)if("tr"===t[a].name)d.push(t[a]);else if("colgroup"===t[a].name){let e=1;for(const s of t[a].children||[])if("col"===s.name){const t=s.attrs.style||"",a=t.indexOf("width")?t.indexOf(";width"):0;if(-1!==a){let s=t.indexOf(";",a+6);-1===s&&(s=t.length),c[e]=t.substring(a?a+7:6,s)}e+=1}}else e(t[a].children||[])}(a);for(let e=1;e<=d.length;e++){let t=1;for(let a=0;a<d[e-1].children.length;a++){const l=d[e-1].children[a];if("td"===l.name||"th"===l.name){for(;h[e+"."+t];)t++;let a=l.attrs.style||"",d=a.indexOf("width")?a.indexOf(";width"):0;if(-1!==d){let e=a.indexOf(";",d+6);-1===e&&(e=a.length),l.attrs.colspan||(c[t]=a.substring(d?d+7:6,e)),a=a.substr(0,d)+a.substr(e)}if(a+=";display:flex",d=a.indexOf("vertical-align"),-1!==d){const e=a.substr(d+15,10);e.includes("middle")?a+=";align-items:center":e.includes("bottom")&&(a+=";align-items:flex-end")}else a+=";align-items:center";if(d=a.indexOf("text-align"),-1!==d){const e=a.substr(d+11,10);e.includes("center")?a+=";justify-content: center":e.includes("right")&&(a+=";justify-content: right")}if(a=(n?`;border:${n}px ${r||"solid"} ${o||"gray"}`+(i?"":";border-right:0;border-bottom:0"):"")+(s?`;padding:${s}px`:"")+";"+a,l.attrs.colspan&&(a+=`;grid-column-start:${t};grid-column-end:${t+parseInt(l.attrs.colspan)}`,l.attrs.rowspan||(a+=`;grid-row-start:${e};grid-row-end:${e+1}`),t+=parseInt(l.attrs.colspan)-1),l.attrs.rowspan){a+=`;grid-row-start:${e};grid-row-end:${e+parseInt(l.attrs.rowspan)}`,l.attrs.colspan||(a+=`;grid-column-start:${t};grid-column-end:${t+1}`);for(let a=1;a<l.attrs.rowspan;a++)for(let s=0;s<(l.attrs.colspan||1);s++)h[e+a+"."+(t-s)]=1}a&&(l.attrs.style=a),u.push(l),t++}}if(1===e){let e="";for(let a=1;a<t;a++)e+=(c[a]?c[a]:"auto")+" ";l["grid-template-columns"]=e}}e.children=u}else e.c&&(l.display="table"),isNaN(i)||(l["border-spacing"]=i+"px"),(n||s)&&function e(t){for(let a=0;a<t.length;a++){const i=t[a];"th"===i.name||"td"===i.name?(n&&(i.attrs.style=`border:${n}px ${r||"solid"} ${o||"gray"};${i.attrs.style||""}`),s&&(i.attrs.style=`padding:${s}px;${i.attrs.style||""}`)):i.children&&e(i.children)}}(a);if(this.options.scrollTable&&!(t.style||"").includes("inline")){const a=Object.assign({},e);e.name="div",e.attrs={style:"overflow:auto"},e.children=[a],t=a.attrs}}else if(("tbody"===e.name||"tr"===e.name)&&e.flag&&e.c)e.flag=void 0,function e(t){for(let a=0;a<t.length;a++)if("td"===t[a].name)for(const e of["color","background","background-color"])l[e]&&(t[a].attrs.style=e+":"+l[e]+";"+(t[a].attrs.style||""));else e(t[a].children||[])}(a);else if("td"!==e.name&&"th"!==e.name||!t.colspan&&!t.rowspan)if("ruby"===e.name){e.name="span";for(let e=0;e<a.length-1;e++)"text"===a[e].type&&"rt"===a[e+1].name&&(a[e]={name:"div",attrs:{style:"display:inline-block;text-align:center"},children:[{name:"div",attrs:{style:"font-size:50%;"+(a[e+1].attrs.style||"")},children:a[e+1].children},a[e]]},a.splice(e+1,1))}else e.c&&function(e){e.c=2;for(let t=e.children.length;t--;){const a=e.children[t];a.c&&"table"!==a.name||(e.c=1)}}(e);else for(let o=this.stack.length;o--;)"table"!==this.stack[o].name&&"tbody"!==this.stack[o].name&&"tr"!==this.stack[o].name||(this.stack[o].flag=1);else{const e={a:"lower-alpha",A:"upper-alpha",i:"lower-roman",I:"upper-roman"};e[t.type]&&(t.style+=";list-style-type:"+e[t.type],t.type=void 0);for(let t=a.length;t--;)"li"===a[t].name&&(a[t].c=1)}if((l.display||"").includes("flex")&&!e.c)for(let o=a.length;o--;){const e=a[o];e.f&&(e.attrs.style=(e.attrs.style||"")+e.f,e.f=void 0)}const n=s&&((s.attrs.style||"").includes("flex")||(s.attrs.style||"").includes("grid"))&&!e.c;n&&(e.f=";max-width:100%"),a.length>=50&&e.c&&!(l.display||"").includes("flex")&&Qe(a);for(const o in l)if(l[o]){const a=`;${o}:${l[o].replace(" !important","")}`;n&&(o.includes("flex")&&"flex-direction"!==o||"align-self"===o||o.includes("grid")||"-"===l[o][0]||o.includes("width")&&a.includes("%"))?(e.f+=a,"width"===o&&(t.style+=";width:100%")):t.style+=a}t.style=t.style.substr(1)||void 0},Ye.prototype.onText=function(e){if(!this.pre){let t,a="";for(let s=0,i=e.length;s<i;s++)je[e[s]]?(" "!==a[a.length-1]&&(a+=" "),"\n"!==e[s]||t||(t=!0)):a+=e[s];if(" "===a){if(t)return;{const e=this.stack[this.stack.length-1];if(e&&"t"===e.name[0])return}}e=a}const t=Object.create(null);if(t.type="text",t.text=qe(e),this.hook(t)){(this.stack.length?this.stack[this.stack.length-1].children:this.nodes).push(t)}},He.prototype.parse=function(e){this.content=e||"",this.i=0,this.start=0,this.state=this.text;for(let t=this.content.length;-1!==this.i&&this.i<t;)this.state()},He.prototype.checkClose=function(e){const t="/"===this.content[this.i];return!!(">"===this.content[this.i]||t&&">"===this.content[this.i+1])&&(e&&this.handler[e](this.content.substring(this.start,this.i)),this.i+=t?2:1,this.start=this.i,this.handler.onOpenTag(t),"script"===this.handler.tagName?(this.i=this.content.indexOf("</",this.i),-1!==this.i&&(this.i+=2,this.start=this.i),this.state=this.endTag):this.state=this.text,!0)},He.prototype.text=function(){if(this.i=this.content.indexOf("<",this.i),-1===this.i)return void(this.start<this.content.length&&this.handler.onText(this.content.substring(this.start,this.content.length)));const e=this.content[this.i+1];if(e>="a"&&e<="z"||e>="A"&&e<="Z")this.start!==this.i&&this.handler.onText(this.content.substring(this.start,this.i)),this.start=++this.i,this.state=this.tagName;else if("/"===e||"!"===e||"?"===e){this.start!==this.i&&this.handler.onText(this.content.substring(this.start,this.i));const t=this.content[this.i+2];if("/"===e&&(t>="a"&&t<="z"||t>="A"&&t<="Z"))return this.i+=2,this.start=this.i,void(this.state=this.endTag);let a="--\x3e";"!"===e&&"-"===this.content[this.i+2]&&"-"===this.content[this.i+3]||(a=">"),this.i=this.content.indexOf(a,this.i),-1!==this.i&&(this.i+=a.length,this.start=this.i)}else this.i++},He.prototype.tagName=function(){if(je[this.content[this.i]]){for(this.handler.onTagName(this.content.substring(this.start,this.i));je[this.content[++this.i]];);this.i<this.content.length&&!this.checkClose()&&(this.start=this.i,this.state=this.attrName)}else this.checkClose("onTagName")||this.i++},He.prototype.attrName=function(){let e=this.content[this.i];if(je[e]||"="===e){this.handler.onAttrName(this.content.substring(this.start,this.i));let t="="===e;const a=this.content.length;for(;++this.i<a;)if(e=this.content[this.i],!je[e]){if(this.checkClose())return;if(t)return this.start=this.i,void(this.state=this.attrVal);if("="!==this.content[this.i])return this.start=this.i,void(this.state=this.attrName);t=!0}}else this.checkClose("onAttrName")||this.i++},He.prototype.attrVal=function(){const e=this.content[this.i],t=this.content.length;if('"'===e||"'"===e){if(this.start=++this.i,this.i=this.content.indexOf(e,this.i),-1===this.i)return;this.handler.onAttrVal(this.content.substring(this.start,this.i))}else for(;this.i<t;this.i++){if(je[this.content[this.i]]){this.handler.onAttrVal(this.content.substring(this.start,this.i));break}if(this.checkClose("onAttrVal"))return}for(;je[this.content[++this.i]];);this.i<t&&!this.checkClose()&&(this.start=this.i,this.state=this.attrName)},He.prototype.endTag=function(){const e=this.content[this.i];if(je[e]||">"===e||"/"===e){if(this.handler.onCloseTag(this.content.substring(this.start,this.i)),">"!==e&&(this.i=this.content.indexOf(">",this.i),-1===this.i))return;this.start=++this.i,this.state=this.text}else this.i++};const Ge=[];const Ke=we({name:"mp-html",data:()=>({nodes:[]}),props:{containerStyle:{type:String,default:""},content:{type:String,default:""},copyLink:{type:[Boolean,String],default:!0},domain:String,errorImg:{type:String,default:""},lazyLoad:{type:[Boolean,String],default:!1},loadingImg:{type:String,default:""},pauseVideo:{type:[Boolean,String],default:!0},previewImg:{type:[Boolean,String],default:!0},scrollTable:[Boolean,String],selectable:[Boolean,String],setTitle:{type:[Boolean,String],default:!0},showImgMenu:{type:[Boolean,String],default:!0},tagStyle:Object,useAnchor:[Boolean,Number]},emits:["load","ready","imgtap","linktap","play","error"],components:{node:Me},watch:{content(e){this.setContent(e)}},created(){this.plugins=[];for(let e=Ge.length;e--;)this.plugins.push(new Ge[e](this))},mounted(){this.content&&!this.nodes.length&&this.setContent(this.content)},beforeDestroy(){this._hook("onDetached")},methods:{in(e,t,a){e&&t&&a&&(this._in={page:e,selector:t,scrollTop:a})},navigateTo(e,t){return new Promise(((a,s)=>{if(!this.useAnchor)return void s(Error("Anchor is disabled"));t=t||parseInt(this.useAnchor)||0;const i=q().in(this._in?this._in.page:this).select((this._in?this._in.selector:"._root")+(e?` #${e}`:"")).boundingClientRect();this._in?i.select(this._in.selector).scrollOffset().select(this._in.selector).boundingClientRect():i.selectViewport().scrollOffset(),i.exec((e=>{if(!e[0])return void s(Error("Label not found"));const i=e[1].scrollTop+e[0].top-(e[2]?e[2].top:0)+t;this._in?this._in.page[this._in.scrollTop]=i:Q({scrollTop:i,duration:300}),a()}))}))},getText(e){let t="";return function e(a){for(let s=0;s<a.length;s++){const i=a[s];if("text"===i.type)t+=i.text.replace(/&amp;/g,"&");else if("br"===i.name)t+="\n";else{const a="p"===i.name||"div"===i.name||"tr"===i.name||"li"===i.name||"h"===i.name[0]&&i.name[1]>"0"&&i.name[1]<"7";a&&t&&"\n"!==t[t.length-1]&&(t+="\n"),i.children&&e(i.children),a&&"\n"!==t[t.length-1]?t+="\n":"td"!==i.name&&"th"!==i.name||(t+="\t")}}}(e||this.nodes),t},getRect(){return new Promise(((e,t)=>{q().in(this).select("#_root").boundingClientRect().exec((a=>a[0]?e(a[0]):t(Error("Root label not found"))))}))},pauseMedia(){for(let e=(this._videos||[]).length;e--;)this._videos[e].pause()},setPlaybackRate(e){this.playbackRate=e;for(let t=(this._videos||[]).length;t--;)this._videos[t].playbackRate(e)},setContent(e,t){t&&this.imgList||(this.imgList=[]);const a=new Ye(this).parse(e);if(this.$set(this,"nodes",t?(this.nodes||[]).concat(a):a),this._videos=[],this.$nextTick((()=>{this._hook("onLoad"),this.$emit("load")})),this.lazyLoad||this.imgList._unloadimgs<this.imgList.length/2){let e=0;const t=a=>{a&&a.height||(a={}),a.height===e?this.$emit("ready",a):(e=a.height,setTimeout((()=>{this.getRect().then(t).catch(t)}),350))};this.getRect().then(t).catch(t)}else this.imgList._unloadimgs||this.getRect().then((e=>{this.$emit("ready",e)})).catch((()=>{this.$emit("ready",{})}))},_hook(e){for(let t=Ge.length;t--;)this.plugins[t][e]&&this.plugins[t][e]()}}},[["render",function(e,t,a,s,i,l){const n=w("node"),o=z;return C(),_(o,{id:"_root",class:R((a.selectable?"_select ":"")+"_root"),style:D(a.containerStyle)},{default:I((()=>[i.nodes[0]?(C(),_(n,{key:1,childs:i.nodes,opts:[a.lazyLoad,a.loadingImg,a.errorImg,a.showImgMenu,a.selectable],name:"span"},null,8,["childs","opts"])):Y(e.$slots,"default",{key:0},void 0,!0)])),_:3},8,["class","style"])}],["__scopeId","data-v-dc899c23"]]),Ze=we(H({__name:"CommentItem",props:{data:{},isReply:{type:Boolean}},emits:["react","reply","edit","delete"],setup(e,{emit:t}){const i=e;a();const l=s((()=>!0===i.data.isMe)),n={p:"font-size: 14px; line-height: 1.5; color: var(--text-primary); margin: 0; margin-bottom: 2px;",div:"font-size: 14px; line-height: 1.5; color: var(--text-primary);",span:"font-size: 14px; line-height: 1.5; color: var(--text-primary);",a:"color: #007aff; text-decoration: none; font-size: 14px;",img:"max-width: 100%; border-radius: 6px; margin-top: 4px;"},o=e=>{const t=e.href||e["data-src"]||e.src;t&&(console.log("Má»Ÿ link:",t),X(t))},r=s((()=>{const e=i.data.message||"";if("UPDATE_TODO"===i.data.type&&e.includes("->")){const t=e.lastIndexOf("->");if(-1!==t){const a=e.substring(0,t).trim(),s=e.substring(t+2).trim(),i=a.match(/^<p>(- .*?:)/)||a.match(/^(- .*?:)/);let l="",n=a;return i&&(l=i[1].replace(/<p>|:$/g,"").trim()+":",n=a.replace(i[0],"").trim(),n.startsWith("</p>")&&(n=n.substring(4))),{isUpdate:!0,label:l,oldRaw:n,newRaw:s}}}return{isUpdate:!1}}));return(e,t)=>{const a=B,s=z,i=J;return C(),_(s,{class:"comment-thread"},{default:I((()=>[M(s,{class:"flex gap-3 mb-4 items-start"},{default:I((()=>[M(Ce,{name:e.data.senderName,"avatar-color":e.data.senderAvatarColor,size:e.isReply?30:40,class:R(["shrink-0",e.isReply?"mr-2":"mr-3"])},null,8,["name","avatar-color","size","class"]),M(s,{class:"flex-1 overflow-hidden"},{default:I((()=>[M(s,{class:"comment-bubble rounded-2xl p-3 rounded-tl-none relative"},{default:I((()=>[M(s,{class:"flex flex-col items-start mb-2"},{default:I((()=>[M(s,{class:"flex flex-wrap items-center gap-1"},{default:I((()=>[M(a,{class:"font-bold text-sm sender-name"},{default:I((()=>[U(L(e.data.senderName),1)])),_:1}),e.data.actionText?(C(),_(a,{key:0,class:"text-xs action-text font-normal"},{default:I((()=>[U(L(e.data.actionText),1)])),_:1})):E("",!0)])),_:1}),M(s,{class:"flex items-center mt-1"},{default:I((()=>[M(a,{class:"text-xs time-text"},{default:I((()=>[U(L(e.data.timeDisplay),1)])),_:1}),e.data.isEdited?(C(),_(a,{key:0,class:"text-xs time-text italic ml-1"},{default:I((()=>[U(" â€¢ ÄÃ£ sá»­a ")])),_:1})):E("",!0)])),_:1})])),_:1}),r.value.isUpdate?(C(),_(s,{key:0,class:"content-body"},{default:I((()=>[M(a,{class:"font-bold text-sm log-label block mb-1"},{default:I((()=>[U(L(r.value.label),1)])),_:1}),M(s,{class:"change-flow"},{default:I((()=>[M(s,{class:"part-container"},{default:I((()=>[M(Ke,{content:r.value.oldRaw,"copy-link":!1,"tag-style":n,"container-style":"font-size: 14px; color: var(--text-primary); line-height: 1.5;",onLinktap:o},null,8,["content"])])),_:1}),M(s,{class:"arrow-container"},{default:I((()=>[M(a,{class:"arrow-text"},{default:I((()=>[U("â†’")])),_:1})])),_:1}),M(s,{class:"part-container"},{default:I((()=>[M(Ke,{content:r.value.newRaw,"copy-link":!1,"tag-style":n,"container-style":"font-size: 14px; color: var(--text-primary); line-height: 1.5;",onLinktap:o},null,8,["content"])])),_:1})])),_:1})])),_:1})):(C(),_(s,{key:1,class:"content-body"},{default:I((()=>[M(Ke,{content:e.data.message,"copy-link":!1,"tag-style":n,"container-style":"font-size: 14px; color: var(--text-primary); line-height: 1.5;",onLinktap:o},null,8,["content"]),e.data.files?(C(),_(s,{key:0,class:"mt-2"},{default:I((()=>[M(i,{src:e.data.files,mode:"widthFix",class:"comment-attachment-img",onClick:t[0]||(t[0]=N((t=>{var a;(a=e.data.files)&&b({urls:[a],current:0})}),["stop"]))},null,8,["src"])])),_:1})):E("",!0)])),_:1}))])),_:1}),M(s,{class:"c-footer-actions"},{default:I((()=>[M(s,{class:"reaction-row"},{default:I((()=>[e.data.reactions&&e.data.reactions.length>0?(C(),_(s,{key:0,class:"flex gap-1 mt-1"},{default:I((()=>[(C(!0),O(T,null,S(e.data.reactions,((e,t)=>(C(),_(s,{key:t,class:"emoji-tag"},{default:I((()=>[U(L(e.codeEmoji),1)])),_:2},1024)))),128))])),_:1})):E("",!0)])),_:1}),"COMMENT"===e.data.type?(C(),_(s,{key:0,class:"action-buttons-container"},{default:I((()=>[M(s,{class:"btn-icon-action",onClick:t[1]||(t[1]=t=>e.$emit("react",e.data))},{default:I((()=>[M(i,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE6klEQVR4nO1aOYwcRRQtboTNchkISDgiDnGkkHIZa8GQgE1qtE68XjmCwF4yzBU0M3T9V72rkSacjMO7IrGxbIM5bCBhbdZAAMthbDIWIyMNetO/pBY708d0zyHLX2qpd7vqV/2q+r/ef3+MuSgXqARBMCEikyLyuoi8B2AJwO8AVvXh+xK/aZvJubm5a804SBAEVwF4AcAigPMA2gWf8yKyICLPt1qtK4duQKPRuBrATgA/JyZ1DsB+ALsBbI6i6O4wDG8AcAUfvvN//AZgD4AD2qfTX0R+AjBN3UMxwjn3hIgsJwz4AsA2ANcV1dVoNK53zr0kIl8m9H0H4PGB7oKIvJsY8FiVA4rIkyLyVWKHajy6pkqJouhWXXkO8peI7Gi1WpdVOogxhjr1yK7qWJ+FYXhLJcqttbcnjtJSGIb3mQFLFEX3i8hJf9Q4h1IK5+fnb/YKReRzABvMkCSMA8VhNeYUT0WZyOSP0yfNZnOdGbI0m811AI76Y9aXzwAI/XGKouhGMyKp1Wo3JU5FrVBnABu9Yw/DJ/L4DDQAMPwXOVKndAV2mDEREZnROS3nujRFZJe/JwYRYvuV2dnZywF8rcbM5MFOHdhhrX3MjJlYa5/SRf4ldVeccy962GHGUNrt9iWKKDjHrT0bAvhIG20zYyoApnSOiz0vIBH5VxFpJgAk7GZewW0WkRUAe4tA8X77h/E8/2EKQNDZzdLNaun+PBPhwF3yi715DSnTX0Q+1vZPd1P8ln7cnVPZyv8nwv/lNaRMfwCvavs3uyle6Gllzokw4pUxBDn7O+eeVUM+WPNRE5o2s7gSR+O1vIaU6e+cu1cNOdlN8Rl+JLbJo4yOyclwZft19n77A9ighv+x5qNGgvZISICCEsQXd4cnuKANOas+MjLIXiThUx85XdrZRylOnR3AiTUfAexTsPiMGXMRkefUkPfTLsQ9KQqOaMo5MahJBkEwoSn24awLEcAbaRDlQIoCjzwXBxEUgtiJPXA9ljKPg+ojk6mgsSsYixXcxdjttxXANVUZQV0APvROHIbhnd3aMRh50NjzZPjVII3Za8AwDB/yEY7HzFp7W1kjqEPppjYvZmvtA73aish2NXYhM7EiF5sx8D0AftS2Z621W/o1Qsf8U3X9kBY1NbE6rkFpSxa/u5KHrVAadTGBXBkIHs1rAFNpEfk0gbP2ZdGjADZ55j6T40qQD8ezyAddoamE33RYQUZALgR3jsUcPnwnUQ3gbQDfJxbgNDNS6jIZ5IOIfKP9pgvRQSSUMzsYYzhRAK+IyG8Fijy/Ani5Xq+vzzOG6AIT8eZmHBME3SrJsVyd4lW71Fr7COM7gENqGFPnc/p+SNPbh9k2r17n3IMi8rfOqVgpw9dCuAJ5of0gZD4m0n014J2yJPbRUZDY9Xp9PUN8KRI7gTJP+LIC/zZDkii++I6ULit4cc7d4beWxyztsqpKXOwTy5UVenqU3lbJvTIcmoplNg6xuxKOXV3pLaUYSkJ5YxW69T7alLgnOo5deTG0S/U1WZ4mIp4i6OzTD7Z72IFhlKe77M5M8gcDikgPisgseSdmcQzbhPt8+M6iEZMittG2HZ7Aww4A0wPdhYz8YSsxl6YAhX/CQYxFADgSA7oJiW8mOrzVyQDqj2rOcNV15fn+reYxbDM5yEzzopgRy39FfuuU+t1BWQAAAABJRU5ErkJggg==",class:"icon-action"})])),_:1}),M(s,{class:"btn-icon-action",onClick:t[2]||(t[2]=t=>e.$emit("reply",e.data))},{default:I((()=>[M(i,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAENElEQVR4nO1a+YtcRRAur6jxSIyIKKh4GxUVFAVREQT/ACNeMfqT4IFEUbxx0N9EVhx39/X3db/16UpQn6ImKMEjkmAMChITzZoYLxTUEEN+UWOMmJXaqcHHHJvZnZ2ZHtgPHixT/aqrXldXV3+1IrOYxSy6ApInArgewNMk3wSwkeR3JHfYo39vAPCGjvHeXzc8PHyCxIAQwmkknwSwieR4k+d3e5rJvwDwBMlTu+6A9/5ykitJ/lswaAPJ57z3iwFcFEJY0MDxBSoDcDOAQVu16vuq6x2Sl3bcAf1qNtnE5AC+J/mw9/7k6epMkuQUAI+Q/KHg1Ip2dDbF+Pj4fgDuIfmnOfC17odSqbT/TM2hupxzN5LcanP8AeDumdIvQ0NDh5N8zZT/pStQKpUOlA6B5EEkHyW521bnldHR0cPaUqoxTfITU7g1SZJzZ8zifc99HoBvbO51WZbNn5aiNE2PILneVmI1yXnSZWRZNp/kGrPhM42OKSnI8/wAy0r6Nd4bGBg4VHoEknMBrDJb3lbbWn4ZwGP2FTaWy+UjpccgOY/kl+bMQy295Jw7n+QePcScc6dLJEiS5EzNmgD+bmmvkvzAPL9TIgPJpWbbu5MOdM5daQPHOpli20zNmy3sr2g6UAs6HaRlhkQK59wt5sirk6W6PQC253k+RyJFuVw+WKtp3SsNE5GW1RZWz0vkIPmC2uqcu7ZOCOBZc+QGiRwkb7LweqZOWD10QggLJXJ4788xR96vE2pFq8KY90cVWZYdYtGzRWoBYBvJXdInQKUS/7VOoD9q6Sx9AlbK/F8aCcZsueZKn4fWKhVqTSN9vtmfMi+XSOTw3i+eLP1eY46kEjlIvmi2LqoT6r1YL/wkd2oZIHHvjx262fUW23AQyWWxF40kb7WwernpoBDChQD26uEYcRm/xcLqsn0NfssGLpXIQPJes21lq8yf7pVdJM+SSBBCWGg27db029JLAO6yONyUJMlR0mNklbtS9cB+YEoUaTXFGafVs9N+tJJNV5sty6dM02oVXOCT1g0ODh4tvVmJj8yGT6dNnSoxp6RYlTLVloB0Cd77C0h+a3OvbZvp1JQHYNgU6p3+Qekg8jyfQ/LxAom9rG0Suwij/DVOt0sHoOcWySXWopvodAG4vVNNnolYnen2nVG0P9mH2qs9yDRNT5JOVpwkk0Zy7TppO817f5tz7uIQwrG1NdvIyMgxKlNuysJ1rKb1toLkJdJJFFpuV9eGRIGBqXv0SmoHbDP55wBKHWm11YLkcST/Ifljkdb33p9B8kMzaJu24/TAIvkSgI8BfGVX6N8s9tcDeN3uPovSND1eugn8/8XvqIYIyQFl++z3zTGVMw3hnDtbDbbwuE+LyoIDE+V003tBLMgrnau1TeJ7DYCrpB/ASj9iJ4Cf7T8UlpO8vx/YyFlIj/EfWzn/4zKL2Z4AAAAASUVORK5CYII=",class:"icon-action"})])),_:1}),l.value?(C(),O(T,{key:0},[M(s,{class:"btn-icon-action",onClick:t[3]||(t[3]=t=>e.$emit("edit",e.data))},{default:I((()=>[M(i,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDUlEQVR4nO3Zv24TMRwHcFNoF0DiBeiAChRYeQhWBtSt8A59gGMqI0JKzt+vHSlSxlu6MSGQ2vIMdOlEC50YUFcIMvJJp1OSS+7OfyL5J1mKzrHjT/zLT+eLEClSrBxZlt0CkJH8BuA3yVMAL8Q6BclNkkckp7X2Z60wSqk3MxD/G4CvIvaYTqc3ytck38+BXIuYYzKZ3Cb5CcBeeY3kuxmYMxFrDAaDOyRP7ELPi6LYWrAzByJ2BIDvWuud+nsqmKOiKG6KyHfioo6o7cxrU81mTmQqwLzq4LC9XQahtd4xaaaUetn4jcSCkFI+rCNMmtn+z9VqthAi/FenL/azf2qtn1T7DcrgbP/paDS62zipb4gThG+IM4RPiFOEL4hzhA9IFQHgygnCNaSOkFI+XQZBW6KjgHRBsM16XEDaIjqtp29IF0Q0kCaEUupR0w+boSHLIABcNlUnhoT0hQgK6RMRDNI3IgjEBcI7xBxyABzbsT9I7tbm3LXXTf+JOUS5XE/rgXmeP7A78RfA874Q3iEkX5XjzJm/TJs8zx+3SadgEACH1XO4wZid6YoIAflYf6hg0qxtOoWEXM15QtIJ4RVCctuO+WVSiOQHKeW+UupZlmUbKy+g43paDxyPx/eGw+F94SgY+qaxr2CCMEGcBBOECeIkmCBMkDghjKyJFpDyf7xoGoDjlSEpRBzxD8CDuZ8WmeYsAAAAAElFTkSuQmCC",class:"icon-action"})])),_:1}),M(s,{class:"btn-icon-action",onClick:t[4]||(t[4]=t=>e.$emit("delete",e.data.id))},{default:I((()=>[M(i,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAADjklEQVR4nM1ZW4hNURhehCjiwSiXeCDKJXJ7cHkwilxeXB6McolQPKBcIhwe3DJT1LHX/6+zj51LZHJ5oVwiDJHrELm+UGZGLvE0D4Ojle/U7DF7xpz9r935ar/8/zrfZf/7rL3bWykhVFZWdiKi/cxcw8y5lg4i+sjMe+1vVLGBmfe1FqCZQHtUsYH+nmVrcEJra7XWE/OTUcUGxll2tT4xFG2QXC7Xjpmr23rdOzyqCgqSSqXaM/PjIgiQw//pVuzpMPM7EA5UCSGTyQxCgLdipER05393JClo7GzMfFuMlJnPW1JjzByVEIhoLiZyTpKUcHZWRa1h5pvM/CBuPQ+rhSCkpEBEuxBkR1u307bW8yCiFNbsVFIgojU4O4eTCsLMHtasVlLQWs9HkDMJBjmLNfOUFIwxk1vbyx0EqcKaSUoKnucNQZDXCQZ5g51ysJJCEAQ9IPw9wSA/sKa7kgQR1VviIAg6uw4SBEFnXAH1QvZDwh8g3t91EN/3B6D/Xsh+SPgByMe5DqK1Ho+J3BeyHxK+CPFZroMYY2ajf0HIfkj4CMiXJTCR5ZhIVsh+SHgvxLe4DkJEW529nGDm9SA/6DoIMx+C1joh+yHyhRA/mcBETtme1rpMyH6IfCrO0rUEJnIdd/VSIfsh8hEI8jyBIC9sz/O84Uoanuf1gvjnBIJ8sb1sNluipIG3Kg1E9JuZO8Y1HFVPpVIdmPkXEf20msoFiKgOBnrHNRxV932/D3q1wvZD4s+wm4yMaziqbowZhf/iU+UKRHQVBqY5DDIdvSvKFYjoBEQWxTUcVddaL0bvuLD9kHgFRDbENRxVJ6KN6JUL2w+JbMb1eyCu4Rbq5ehtUq5gjFkKkaMOJ3IMvSXKFbTWMzGRS3ENt1C/jN4M5QqZTGYMgjwRMBxVr0ZvtHIFY0w/iNQIGI6q1+Je1Ve5Aj5B20eUhqaPDxJBUo0eg5x/umbmbzDRs1DDUfVsNluCS/erI/shA68w+qGFGo6qG2OGof7Skf1/vmtYsSmFGo6qG2NKMZEbjuyHDFTCxIJCDUfVtdZlCHLakf2QgTRMrG1Sr2rubX1b6sy8FtxpR/ZDYtshtluam4j2YCLbpLmbE1uJIL4D7qzlNsasUK7R6DHlYUVFRRcpXsvFzI+cP57k4ft+N2b+lP+zSh9EVJdOp7s6D2Jh38gz8z17FxYMYe/od4lobCGm/gAfYnDjhrpJZwAAAABJRU5ErkJggg==",class:"icon-action"})])),_:1})],64)):E("",!0)])),_:1})):E("",!0)])),_:1})])),_:1})])),_:1}),e.data.children&&e.data.children.length>0?(C(),_(s,{key:0,class:"pl-12 mt-2 replies-wrapper"},{default:I((()=>[(C(!0),O(T,null,S(e.data.children,(a=>(C(),_(Ze,{key:a.id,data:a,"is-reply":!0,onReact:t[5]||(t[5]=t=>e.$emit("react",t)),onReply:t[6]||(t[6]=t=>e.$emit("reply",t)),onEdit:t[7]||(t[7]=t=>e.$emit("edit",t)),onDelete:t[8]||(t[8]=t=>e.$emit("delete",t))},null,8,["data"])))),128))])),_:1})):E("",!0)])),_:1})}}}),[["__scopeId","data-v-7486139f"]]),We=we(H({__name:"todo_detail",setup(e){const t=a(),l=s((()=>t.isDark)),{isLoading:n,isLoadingCustomer:o,isLoadingHistory:r,historyList:c,form:d,statusOptions:u,sourceOptions:h,assigneeOptions:m,onStatusChange:p,onSourceChange:g,onAssigneeChange:f,saveTodo:y,historyFilterOptions:v,historyFilterIndex:A,onHistoryFilterChange:b,comments:k,isLoadingComments:x,newCommentText:w,isSubmittingComment:D,submitComment:V,isConfirmDeleteCommentOpen:P,onRequestDeleteComment:F,confirmDeleteComment:Y,cancelDeleteComment:H,currentUserId:W,isEditingComment:X,onRequestEditComment:ne,submitUpdateComment:oe,onCancelEditComment:re,isConfirmCancelEditOpen:ce,continueEditing:de,confirmCancelEdit:ue,editingMemberName:he,isEmojiPickerOpen:me,emojiList:pe,onToggleEmojiPicker:ge,closeEmojiPicker:fe,selectEmoji:ye,isReplying:ve,replyingMemberName:Ae,replyingCommentData:be,onRequestReply:ke,onCancelReply:xe,submitReply:we,isConfirmCancelReplyOpen:Ce,continueReplying:Se,confirmCancelReply:De,commentFilterIndex:Re,commentFilterOptions:Ne,onCommentFilterChange:Ue,isSavingDescription:Le,onSaveDescription:Me,onDateUpdate:Je,isStatusDisabled:Be,onSaveTitle:ze,replyingMessagePreview:Ve,isHistoryOpen:je,toggleHistory:Pe,goBack:Fe,isDone:qe,isLoadingMoreHistory:Qe}=Ee(),Ye=i(!1);i("");const He=()=>{Ye.value=!Ye.value},Ge=i(null),Ke=()=>{Ye.value||(Ye.value=!0),setTimeout((()=>{q().select("#comment-input-anchor").boundingClientRect((e=>{e&&q().selectViewport().scrollOffset((t=>{if(t){let a=t.scrollTop+e.top-100;Q({scrollTop:a,duration:300})}})).exec()})).exec()}),150)};return(e,t)=>{const a=z,s=J,i=B,g=Z,y=j;return C(),_(a,{class:R(["container",{"theme-dark":l.value}])},{default:I((()=>[G(n)?(C(),_(a,{key:0,class:"loading-bar"})):E("",!0),M(a,{class:"custom-header"},{default:I((()=>[M(a,{onClick:G(Fe),class:"back-btn"},{default:I((()=>[M(s,{src:$,class:"back-icon"})])),_:1},8,["onClick"]),M(i,{class:"header-title"},{default:I((()=>[U(L(e.$t("todo.todo_detail_title")),1)])),_:1}),M(a,{class:"header-right"})])),_:1}),M(a,{class:"detail-header-content"},{default:I((()=>[M(a,{class:"header-top"},{default:I((()=>[M(i,{class:"header-code"},{default:I((()=>[U("#"+L(G(d).code||"..."),1)])),_:1})])),_:1}),M(g,{class:"header-title-input",modelValue:G(d).title,"onUpdate:modelValue":t[0]||(t[0]=e=>G(d).title=e),placeholder:e.$t("todo.header_loading"),"auto-height":"",maxlength:"256","confirm-type":"done",disabled:G(qe),onConfirm:G(ze),onBlur:G(ze),"placeholder-class":"input-placeholder"},null,8,["modelValue","placeholder","disabled","onConfirm","onBlur"])])),_:1}),M(a,{class:"detail-body"},{default:I((()=>[M(a,{class:"section-title"},{default:I((()=>[U(L(e.$t("todo.desc_section")),1)])),_:1}),M(a,{class:"section-block"},{default:I((()=>[M(ee,{modelValue:G(d).desc,"onUpdate:modelValue":t[1]||(t[1]=e=>G(d).desc=e),placeholder:e.$t("todo.desc_placeholder"),"read-only":G(qe)},null,8,["modelValue","placeholder","read-only"]),G(qe)?E("",!0):(C(),_(a,{key:0,class:"input-actions",style:{"margin-top":"10px"}},{default:I((()=>[M(_e,{type:"primary",size:"small",loading:G(Le),label:G(Le)?e.$t("common.saving"):e.$t("common.save"),onClick:G(Me)},null,8,["loading","label","onClick"])])),_:1}))])),_:1}),M(a,{class:"section-title"},{default:I((()=>[U(L(e.$t("todo.info_section")),1)])),_:1}),M(a,{class:R(["info-group",{"disabled-group":G(qe)}])},{default:I((()=>[M(a,{class:"flat-item"},{default:I((()=>[M(a,{class:"item-left"},{default:I((()=>[M(s,{src:ie,class:"item-icon"}),M(i,{class:"item-label"},{default:I((()=>[U(L(e.$t("todo.status")),1)])),_:1})])),_:1}),M(a,{class:"item-picker-box"},{default:I((()=>[M(Ie,{range:G(u),value:G(d).statusIndex,onChange:G(p),title:e.$t("todo.status")},{default:I((()=>[M(a,{class:R(["picker-text",{"disabled-text":G(Be)}])},{default:I((()=>[U(L(G(u)[G(d).statusIndex]||e.$t("common.loading"))+" ",1),G(Be)?E("",!0):(C(),_(i,{key:0},{default:I((()=>[U("â–¾")])),_:1}))])),_:1},8,["class"])])),_:1},8,["range","value","onChange","title"])])),_:1})])),_:1}),M(a,{class:"flat-item"},{default:I((()=>[M(a,{class:"item-left"},{default:I((()=>[M(s,{src:te,class:"item-icon"}),M(i,{class:"item-label"},{default:I((()=>[U(L(e.$t("todo.source")),1)])),_:1})])),_:1}),M(a,{class:"item-picker-box"},{default:I((()=>[M(a,{class:"picker-text disabled-text"},{default:I((()=>[U(L(G(h)[G(d).sourceIndex]||"..."),1)])),_:1})])),_:1})])),_:1}),M(a,{class:"flat-item"},{default:I((()=>[M(a,{class:"item-left"},{default:I((()=>[M(s,{src:ae,class:"item-icon"}),M(i,{class:"item-label"},{default:I((()=>[U(L(e.$t("todo.assignee")),1)])),_:1})])),_:1}),M(a,{class:"item-picker-box"},{default:I((()=>[M(Ie,{range:G(m),value:G(d).assigneeIndex,onChange:G(f),title:e.$t("todo.assignee")},{default:I((()=>[M(a,{class:"picker-text"},{default:I((()=>[U(L(G(m).length>0&&G(d).assigneeIndex>-1?G(m)[G(d).assigneeIndex]:e.$t("common.loading"))+" â–¾ ",1)])),_:1})])),_:1},8,["range","value","onChange","title"])])),_:1})])),_:1}),M(se,{dueDate:G(d).dueDate,"onUpdate:dueDate":t[2]||(t[2]=e=>G(d).dueDate=e),notifyAt:G(d).notifyAt,"onUpdate:notifyAt":t[3]||(t[3]=e=>G(d).notifyAt=e),onChange:G(Je)},null,8,["dueDate","notifyAt","onChange"])])),_:1},8,["class"]),M(a,{class:"section-title"},{default:I((()=>[U(L(e.$t("todo.customer_section")),1)])),_:1}),M(a,{class:"info-group customer-block"},{default:I((()=>[G(o)?(C(),_(a,{key:0,class:"loading-row"},{default:I((()=>[M(i,{class:"loading-text"},{default:I((()=>[U(L(e.$t("todo.loading_crm")),1)])),_:1})])),_:1})):G(d).customerCode?(C(),_(a,{key:2},{default:I((()=>[M(a,{class:"flat-item"},{default:I((()=>[M(a,{class:"item-left"},{default:I((()=>[M(s,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF8ElEQVR4nO1a2W9UVRi/FXEl4q644YLGFdT4J2gUk4oY50GsqZ17fr87M81Iiw8+mDAmhhjRl2qj8UWfjEZfgIpbDJHEiCJK9cEFUKMs0YB9MEFLodR8l+/osdy5c87ttC7hS24ymfut55xvPTeKjsH/FLq7u08HcBeA1SSHSH5Fci/J3/WR318CWKc4nSTnRv8GqNfrJxpj7if5NslDJCcCn0MA3iK5THhFMw3d3d0nkVxBcrdVCsAoyfdJNowxS40x1/X29p4luPLI70qlcj3JewQHwEaSBxz6XST7BHdGjACwmOQOZ1U/BZBUq9UzQnkJjdAC+Mzht90Yc/t078JzzgqK8DvaxL5DFgjAsGPQs20/bnEcn0dyixrwG4DlpVJpVluFRFHUaDSOB9CvwUGM2VypVM5tC/MkSS6V7VYjviZ5Qwv8KwGsBPAeyT3qO/s1ig2Uy+X5HjIXAdimMreJDu3YidQIkh+Jw+add5IvARhvEal+BfBAvV4/LU82ybMBfGyNKbwz6hPpcSK5qVarzckROk9X3Cr6ogaFq0meIo9GrCecMC3HZ0DeNeNbq9XmWGPkmBXyGQDP2+OUtxPiqBp20whG8pI8vsaYBzXvjCn/D/IU5JGdscdsMMiIJEnutI7t4RNL1Ii9LQz+G8gOae4Q2kfycI0xN9oA4B2a+/v7TwbwrQp4qBU+yZcVd4WvEQ5tp9L+0AoXR6JZ6i9eR4zkwzZP+IRYkr+oMldE4dChNdhEuVy+oFVoJvm56rbcx8F3+25hV1fXqdbBo4JAcoPwSJLktoAjvyt3V0h2qWJbfJSoVqsXK/7OQP1dmUPKo9OzAkjLmSRJ7muKBeBd3Q34KCGx3a5QiPJZMn3LHZIVxX8zL6FJWT0qvYUPU/EhTYBjslqBNljF0vwTx/FCH/w4js+UqhnAwcx+huTdaumGEEUA/KhbfWEUCOpjkk8OSLSM/GVubHocST6tx2RliDIA1qghS0LolPZWlflhIN1jSrf6qJck3yiiEIBVynRVCJ3SPq4rOxBCZ4xZqjLXZTFNy4A4jq/xZdhoNI6zTRaAR0OUcVdWeAivyBOk+7TlUxbTffIypMyQJKYMRwL0nyx3RI2Z50sj9Zcti7Jepv1zqVQ6wZeh4GqjNe4b6TJa3XGt6Wb70kkytHOCthgioFOQCfWxW3zpBNf6ZdOcUMQQe7QkTkcBUKlUbgLwsyr0pC+d4CrNT8IjRCbzjpZ1dmmGQpgq45t1hYYDaNICMNQIgSRJrm3q7EXDrxO9dirzxa3wtXu05XtwRcC/kvdQ2xKiQ9+nzL/Lc3x5JziK21dQViMvIRYqURz62c6w4OgtV9BJTNqDh0QqF5zWurMtRWOzsl5CajMcO2UR3CIy4lZF46SSmkWE6MRE6A/n4BxWnKbTkzyQEWvLkG0bK2lecrk1p59rRz05iowqTpErhQ5nTrysVau7J6TRcSGO4wW6EPua4Tj5akEo/8S31Z00fBiWht9XiDHmIplGKu2aHP5r7dBPaHz5N44MH77wGj5kjINahkeZe8ngTOulNPzmObIM8Gz41Tpt0Kc7ROg4yN1COetZQqRXl1UB8IlzzSDF36s+JY5GnlcmzYm3irK1Wu38DH0WBQ/oJo9MSX4jtY2d+ImyGvqsASOyqtIjBAnQvgLAM85sbEJTwOtS9jh11fZCI9OsIbYen3QFxRDpzpIkubcdlzFazcqV3Fq7SCpLLpY2TWmILdDT03OO7sifx4fka8aYq6JpgnK5PB/AC+6uSwcpVxxTYlytVi+3zg/ge9+xzVQgjuOFTj22wxhzWVsYiwPqlYEw3i9OOR1Xb6VSaZYMw50IuHnKO5HlM04ASLN/O29ftbTf6vAfnNa796zr6SRJ4iKFptAI7eTrabbvtrh10tQPBmw5I8+YXIDqiKdTxkpSUUvTJY/81s6uU3D0sjS9tdJHbgFm7oOBjBAtheY7U/mEQz4D+Uc+4cg5JnIN9xSA9dJAabI8qM+I/rdecAS3aN9zDKL/APwBbeoXgdqsneAAAAAASUVORK5CYII=",class:"item-icon"}),M(i,{class:"item-label"},{default:I((()=>[U(L(e.$t("todo.customer_name_label")),1)])),_:1})])),_:1}),M(a,{class:"item-right-text"},{default:I((()=>[U(L(G(d).customerName),1)])),_:1})])),_:1}),M(a,{class:"flat-item"},{default:I((()=>[M(a,{class:"item-left"},{default:I((()=>[M(s,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEF0lEQVR4nO1aS4gcVRS94x9FI/5jjKKCK8GIC43iQhE3oiChFXSk7Op7TlXPpHUprnohWalElKgB3ehOxUmM+FmI4sLfQMaAiJ+FUVQEY2KiYvyO3PR9+Gi6Ot2hU/MG5kBtpu6rvrfq3nPPu29EVrCCpQOA2wDMAzhIchfJ9bKc0Gg0TiC5heRi37WvKIo1shxAchXJt9zx3wFsJHkWye3+t9ckdczMzJwH4GN3+DtVvarv3h67ByCXVNHpdE4DsNOD+DTP84v6bVT1br//M8kLJTV0Op0TSb7rTn4yOzt7ZpUtyblkUwzAJnfua1W9YJitpRjJn9w+k5QAYK87dsOI9vd4rdi61ZIK0OsTi1mWnT7qGpKvevBzkgpIfmlOlWV5+ahrLAW96C2YOyUF0AvYWGmcdaoKD+RzSQHoNT1z6Llx1nmjtHV/i8jU0fNwRJC8lOS/JA/keX7qqOtU9V4v+nlJBfxflpSj2GdZdhLJ3cnRsKreEfK92+0edzh7AA+6/UK32z1GUkGj0TjWpImnSjHMtizLcwDsd9ubJDUA2OBv+XuSJw+x2+p22yVRTAH40J18uKo2APziNiqpoizLK0n+CeAfVb1+kA3J+8JGS1UvllQB4KFQ+BUpNkVyh9t8NCwNU9jq7nJHtwyyMV0WkcM2IwtJEaq6zra6HkxzSCP90YPZmkR3HwQLIOzdSV5dYbM+FD+AzZIqADweKLlqgqKqN4avB+BRSREkjwfwtjv5XlVhk7zV2M7tNkmKaDabZwP4yp183chgkB3JRhTM5iRrRlUvI/mDp9kLVSzlXyaQxNNJsllRFFdYE/Q3/kzVG7eaiQhg26B0dG1nZLJgzRfAFyZcpS4AuJbkr4crbFW9JqLm+XhOZkIz6lP910utVuvcWoIheTPJP6JgBn6Zdrt9SdQ09/rWOCiCRa+7zHaadi9S1DbRvKuWYFT19hAMyWerasEUAIBX4rfuDj9gArQv8LVGJpHtnM3R6voyIc1erGIz12YdqxsAT9l+ZthzAeShFm0YaHM0OdooiuK66EffGCYgbTQ7xnPXRLMzu3bkeX6+1KDLAjW/P8npI8ksmoTuq5JKk+4zh4YRAL6d5A+SXB2RxILUoQBIvuPBHKxSzUeCVqt1hgfym9SlzUg+EeX2k5PYeAG4P+g9qRP2NcJw3Lq2kcKRPkt7zTVQ/S2T9XR0EjjUwU2GkHxkenr6lHGe0e411UAkj8lSwXqLzQAA/BX2NTY3G2UI2Oyp7s983ZuWtrLUsINVkh9EtWODjbJq1txut9dG8mbnODPpuuZmG6K3bNcBAM/bkYadz9jxuKvnbwLd1iYix4WllR0O+eDcTgEWKy6j8lWyHODFPEvyZWM3/yeFPVZX40iaFaxAJov/AB/x+nqRD82iAAAAAElFTkSuQmCC",class:"item-icon"}),M(i,{class:"item-label"},{default:I((()=>[U(L(e.$t("todo.customer_phone_label")),1)])),_:1})])),_:1}),M(a,{class:"item-right-text phone-text"},{default:I((()=>[U(L(G(d).customerPhone),1)])),_:1})])),_:1}),M(a,{class:"flat-item"},{default:I((()=>[M(a,{class:"item-left"},{default:I((()=>[M(s,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD9klEQVR4nO1ZUYgWVRS+W0mRpUQiZZmgL5ZJgQiBRCU9JInhw2rG0trs+b77z7/+ghBhQk2aINFToBKiDz4UJKgPKkIqZUpCFqRi+SBlYWVmbEoZmLZy3DMxLLuz/8z87gz0f3BhYO757nfm3Hvn3HOda6ONNkYdYRjeQ7IbwFaSXwG4QPIKgMNRFN3mqo56vX4fyY0ALpPsH6qJyFJXZXjvXyDZFwsG8DXJVQAWkJxJsmbvLpHcB2BFo9EY56oEEVkK4Jo5cNh7/9jgPjql9F0yOgB+8d7PcVWAiDyh89+EvR1F0S1p/UneKSJPAvjYbC729PQ87MpEZ2fnrSSP2RfelMVWHQaw3Zz5xJUJks+bE+e7urrG5tndbEfrr9Vqj7qyQHKDOfJGAY73jOOd1qrLJuKIiiiyYEk+Z47sa626bCLOmYjxeTmCIJhiHGdcWSD5Q1FHSE4wjp9bqy6biOMqIgzDqXk5wjCcbDvX964sANhsa+TlvBwiMt8icsCVBQAvmogdBTg+NI5VriyQbJiIIwU4frOp9Wpr1WUT8Y2JWFCA45XSpxbJMyZiel4O/QcZxyFXFkhus4jUC3AsN47NrizEO45msHkOTCRf0jzNDlwLb47K5sWstKnxXUa7MfoB7ByzwTnXcfNUZlwrmm40a+O9f9qiedRVBbAfI8m1zdqQ/MAcectVBTJwSrxxHvfePzBSfz0RAvhHW5Yojgri056Wf9KOu93d3XdoH4vGelc1kJygi9ecuT+l30zr81PlqigxNBW3bHiyS5lWFo2TrqqgHbTS1gnJaRaR066qIPm3bcN3p/R5yCLyo6siADxlX/qPtJ+bVU70J3hFRB53VYKILCL5e1xp1BrwcH11I0hkzWdFZK4rGR1aAQGwf4hitVYePyL5jEWnQwVbknmjKplo/+rBTCPqRhO6ZQJYFn9Va31WpNaC3S6SV4erxtu7nQDmkYwGVe6PayZdpJgxInp7e+8luc6q6XER+iyA1wYPbAt6Dcm/EiL1ebWIPDjEVcRqAL8m+v5J8t1arTaxZQ5YFf31QQ4cJLlYM9g0W60HJ8Sl1oYbjcbt3vslJD9NOgTgzZHGGRG2wxxMOLBX86pm7UVkVuKCZ1azdgBmk9ydGPdzzRxyOaHlf5Jfxns+gGezcnjvH4nF6HNWexGZq2Mbx7F6vX5XHkfeN4JvgyCYlJlggCNKTJMoD0cQBJMAnDKOLZmMLR+6qmm2iMxwOQHgRGJ6nMjLw4FEU/Vcy6THdicVsDvv4HFymGxFbqYA7DGedU0bJdaGzzuw3pkM8Q/JfY8CwBvHF1lE/Hc7W8HWl8WRQxUQ3D9M+yxnUNto43+N64tfgZqzuBAqAAAAAElFTkSuQmCC",class:"item-icon"}),M(i,{class:"item-label"},{default:I((()=>[U(L(e.$t("todo.customer_manager_label")),1)])),_:1})])),_:1}),M(a,{class:"item-right-text highlight-text"},{default:I((()=>[U(L(G(d).customerManagerName||e.$t("todo.manager_none")),1)])),_:1})])),_:1})])),_:1})):(C(),_(a,{key:1,class:"empty-row"},{default:I((()=>[M(i,null,{default:I((()=>[U(L(e.$t("todo.no_customer_attached")),1)])),_:1})])),_:1}))])),_:1}),M(a,{class:"section-header-row"},{default:I((()=>[M(a,{class:"toggle-header",onClick:He},{default:I((()=>[M(i,{class:"section-title no-margin"},{default:I((()=>[U(L(e.$t("todo.comments_activities")),1)])),_:1}),M(s,{src:$,class:R(["toggle-icon",{open:Ye.value}])},null,8,["class"])])),_:1}),M(Ie,{range:G(Ne),value:G(Re),onClick:t[4]||(t[4]=N((()=>{}),["stop"])),onChange:G(Ue),title:e.$t("common.filter")},{default:I((()=>[M(a,{class:"filter-badge"},{default:I((()=>[U(L(G(Ne)[G(Re)])+" â–¾",1)])),_:1})])),_:1},8,["range","value","onChange","title"])])),_:1}),Ye.value?(C(),_(a,{key:0,class:"comments-section"},{default:I((()=>[M(a,{class:"comment-input-block",id:"comment-input-anchor"},{default:I((()=>[M(a,{class:"editor-container"},{default:I((()=>[M(ee,{ref_key:"todoEditorRef",ref:Ge,modelValue:G(w),"onUpdate:modelValue":t[5]||(t[5]=e=>K(w)?w.value=e:null),placeholder:G(X)?e.$t("todo.comment_placeholder_edit"):G(ve)?e.$t("todo.comment_placeholder_reply"):e.$t("todo.comment_placeholder_write")},null,8,["modelValue","placeholder"])])),_:1}),G(X)?(C(),_(a,{key:0,class:"editing-alert"},{default:I((()=>[M(i,{class:"editing-text"},{default:I((()=>[U(L(e.$t("todo.editing_alert"))+" ",1),M(i,{class:"editing-name"},{default:I((()=>[U(L(G(he)),1)])),_:1})])),_:1})])),_:1})):E("",!0),G(ve)&&G(be)?(C(),_(a,{key:1,class:"reply-alert"},{default:I((()=>[M(a,{class:"reply-info"},{default:I((()=>[M(i,{class:"reply-label"},{default:I((()=>[U(L(e.$t("todo.replying_alert")),1)])),_:1}),M(i,{class:"reply-name"},{default:I((()=>[U(L(G(Ae)),1)])),_:1})])),_:1}),M(a,{class:"reply-quote"},{default:I((()=>[M(i,{class:"quote-icon"},{default:I((()=>[U("â€œ")])),_:1}),M(y,{nodes:G(Ve),class:"quote-content"},null,8,["nodes"]),M(i,{class:"quote-icon"},{default:I((()=>[U("â€")])),_:1})])),_:1})])),_:1})):E("",!0),M(a,{class:"input-actions"},{default:I((()=>[G(X)||G(ve)?G(X)?(C(),_(a,{key:1,class:"edit-actions-row"},{default:I((()=>[M(_e,{type:"secondary",size:"small",label:e.$t("common.cancel"),disabled:G(D),onClick:G(re)},null,8,["label","disabled","onClick"]),M(_e,{type:"primary",size:"small",loading:G(D),label:G(D)?e.$t("common.saving"):e.$t("todo.update_btn"),onClick:G(oe)},null,8,["loading","label","onClick"])])),_:1})):G(ve)?(C(),_(a,{key:2,class:"edit-actions-row"},{default:I((()=>[M(_e,{type:"secondary",size:"small",label:e.$t("common.cancel"),disabled:G(D),onClick:G(xe)},null,8,["label","disabled","onClick"]),M(_e,{type:"primary",size:"small",loading:G(D),label:G(D)?e.$t("common.saving"):e.$t("todo.reply_btn"),onClick:G(we)},null,8,["loading","label","onClick"])])),_:1})):E("",!0):(C(),_(_e,{key:0,type:"primary",size:"small",loading:G(D),label:G(D)?e.$t("common.saving"):e.$t("common.save"),onClick:G(V)},null,8,["loading","label","onClick"]))])),_:1})])),_:1}),M(a,{class:"divider-line"}),G(x)?(C(),_(a,{key:0,class:"loading-row"},{default:I((()=>[M(i,null,{default:I((()=>[U(L(e.$t("todo.loading_comments")),1)])),_:1})])),_:1})):0===G(k).length?(C(),_(a,{key:1,class:"empty-row"},{default:I((()=>[M(i,null,{default:I((()=>[U(L(e.$t("todo.no_comments")),1)])),_:1})])),_:1})):(C(),_(a,{key:2},{default:I((()=>[(C(!0),O(T,null,S(G(k),(e=>(C(),_(Ze,{key:e.id,data:e,onReact:G(ge),onReply:t[6]||(t[6]=e=>(e=>{ke(e),Ke()})(e)),onEdit:t[7]||(t[7]=e=>(e=>{ne(e.id),Ke()})(e)),onDelete:t[8]||(t[8]=e=>G(F)(e))},null,8,["data","onReact"])))),128))])),_:1}))])),_:1})):E("",!0),M(a,{class:"section-header-row"},{default:I((()=>[M(a,{class:"toggle-header",onClick:G(Pe)},{default:I((()=>[M(i,{class:"section-title no-margin"},{default:I((()=>[U(L(e.$t("todo.history_section")),1)])),_:1}),M(s,{src:$,class:R(["toggle-icon",{open:G(je)}])},null,8,["class"])])),_:1},8,["onClick"]),M(Ie,{range:G(v),value:G(A),onClick:t[9]||(t[9]=N((()=>{}),["stop"])),onChange:G(b),title:e.$t("common.filter")},{default:I((()=>[M(a,{class:"filter-badge"},{default:I((()=>[U(L(G(v)[G(A)])+" â–¾",1)])),_:1})])),_:1},8,["range","value","onChange","title"])])),_:1}),G(je)?(C(),_(a,{key:1,class:"history-container"},{default:I((()=>[G(r)?(C(),_(a,{key:0,class:"loading-row"},{default:I((()=>[M(i,{class:"loading-text"},{default:I((()=>[U(L(e.$t("todo.loading_history")),1)])),_:1})])),_:1})):0===G(c).length?(C(),_(a,{key:1,class:"empty-row"},{default:I((()=>[M(i,null,{default:I((()=>[U(L(e.$t("todo.no_history")),1)])),_:1})])),_:1})):(C(),_(a,{key:2,class:"timeline-list"},{default:I((()=>[(C(!0),O(T,null,S(G(c),((e,t)=>(C(),_(a,{key:e.id,class:"timeline-item"},{default:I((()=>[t!==G(c).length-1?(C(),_(a,{key:0,class:"timeline-line"})):E("",!0),M(a,{class:"timeline-dot"}),M(a,{class:"timeline-content"},{default:I((()=>[M(a,{class:"timeline-header"},{default:I((()=>[M(i,{class:"t-actor"},{default:I((()=>[U(L(e.actorName),1)])),_:2},1024),M(i,{class:"t-time"},{default:I((()=>[U(L(e.timeStr),1)])),_:2},1024)])),_:2},1024),M(i,{class:"t-action"},{default:I((()=>[U(L(e.content),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})),G(Qe)?(C(),_(a,{key:3,class:"loading-more-container"},{default:I((()=>[M(i,{class:"loading-more-text"},{default:I((()=>[U(L(e.$t("common.loading"))+"...",1)])),_:1})])),_:1})):E("",!0)])),_:1})):E("",!0),M(a,{style:{height:"50px"}})])),_:1}),M(le,{visible:G(ce),"onUpdate:visible":t[10]||(t[10]=e=>K(ce)?ce.value=e:null),title:e.$t("todo.cancel_edit_title"),message:e.$t("todo.cancel_edit_msg"),"cancel-label":e.$t("todo.continue_edit"),"confirm-label":e.$t("common.cancel_action"),"confirm-type":"danger",onCancel:G(de),onConfirm:G(ue)},null,8,["visible","title","message","cancel-label","confirm-label","onCancel","onConfirm"]),M(le,{visible:G(Ce),"onUpdate:visible":t[11]||(t[11]=e=>K(Ce)?Ce.value=e:null),title:e.$t("todo.cancel_reply_title"),message:e.$t("todo.cancel_reply_msg"),"cancel-label":e.$t("todo.continue_reply"),"confirm-label":e.$t("common.cancel_action"),"confirm-type":"danger",onCancel:G(Se),onConfirm:G(De)},null,8,["visible","title","message","cancel-label","confirm-label","onCancel","onConfirm"]),M(le,{visible:G(P),"onUpdate:visible":t[12]||(t[12]=e=>K(P)?P.value=e:null),title:e.$t("todo.delete_comment_title"),message:e.$t("todo.delete_comment_msg"),"confirm-type":"danger",onConfirm:G(Y),onCancel:G(H)},null,8,["visible","title","message","onConfirm","onCancel"]),G(me)?(C(),_(a,{key:1,class:"modal-overlay",onClick:G(fe)},{default:I((()=>[M(a,{class:"emoji-picker-container",onClick:t[13]||(t[13]=N((()=>{}),["stop"]))},{default:I((()=>[M(a,{class:"emoji-grid"},{default:I((()=>[(C(!0),O(T,null,S(G(pe),((e,t)=>(C(),_(a,{key:t,class:"emoji-item",onClick:t=>G(ye)(e)},{default:I((()=>[U(L(e),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["onClick"])):E("",!0),M(Oe),M(Te)])),_:1},8,["class"])}}}),[["__scopeId","data-v-039adede"]]);export{We as default};
