import{T as e,u as t,a as s,c as a,r as i,Z as l,g as n,o,_ as r,$ as c,a0 as d,a1 as u,M as h,s as m,K as p,a2 as g,a3 as f,a4 as y,n as v,a5 as A,a6 as b,i as k,j as x,w,E as C,G as I,F as _,B as O,D as T,l as S,H as D,k as R,t as E,A as N,O as U,N as J,m as L,a7 as M,a8 as V,q as z,a9 as B,L as j,aa as q,ab as P,f as Y,C as Q,I as F,V as K}from"./index-QVVW7vKj.js";import{e as Z,o as X,_ as H,T as G,a as W}from"./TodoDatePicker.za20Lb_h.js";import{_ as $,C as ee}from"./ConfirmModal.CUjCXsz3.js";import{T as te,q as se,s as ae,r as ie,t as le,v as ne,i as oe,w as re,u as ce,c as de,x as ue,y as he,z as me,B as pe,C as ge,D as fe,m as ye,_ as ve,U as Ae,e as be,A as ke,G as xe,f as we}from"./GlobalNotification.BhdNdCXS.js";const Ce=e=>{if(!e||e<=0)return"";try{const t=new Date(e),s=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0");return`${s}-${a}-${i} ${l}:${n}:${"00"}`}catch{return""}},Ie=()=>{const{t:g}=t(),f=s(),y=a((()=>f.uid)),v=i(!1),A=i(!1),b=i(!1),k=i([]),x=i(!1),w=i([]),C=i(!1),I=i(""),_=i(!1),O=i(!1),T=i(null),S=i(!1),D=i(""),R=i(!1),E=i(!1),N=i(!1),U=i(null),J=i(""),L=i(!1),M=i(null),V=i(0),z=a((()=>[g("todo.filter_activity_all"),g("todo.filter_activity_comment")])),B=["","COMMENT"],j=i(!1),q=i(""),P=a((()=>Ae.value.raw&&"DONE"===Ae.value.raw.status)),Y=a((()=>!Ae.value.raw||"DONE"===Ae.value.raw.status)),Q=e=>{if(!e)return!0;if(e.includes("<img")||e.includes("<iframe"))return!1;let t=e.replace(/&nbsp;/gi," ");return t=t.replace(/<[^>]+>/g,""),0===t.trim().length},F=async e=>{if(!e)return{cleanMessage:"",fileUrl:""};const t=/<img[^>]+src="([^">]+)"[^>]*>/g;let s,a="",i=e;const l=[];for(;null!==(s=t.exec(e));){const e=s[0],t=s[1];if(i=i.replace(e,""),t.startsWith("http")||t.startsWith("https"))a=t;else{const e=ye(t).then((e=>e)).catch((e=>(console.error("Upload áº£nh bÃ¬nh luáº­n lá»—i:",e),"")));l.push(e)}}if(l.length>0){const e=(await Promise.all(l)).find((e=>""!==e));e&&(a=e)}return i=i.trim(),{cleanMessage:i,fileUrl:a}},K=()=>{N.value=!1,H()},X=()=>{const e=String(f.uid),t=ke.value.find((t=>String(t.UID)===e));return t?t.memberUID:e},H=()=>{E.value=!1,U.value=null,q.value="",J.value="",I.value=""},G=()=>{L.value=!1,M.value=null},W=i(null),$=i(0),ee=a((()=>[g("todo.history_all"),g("todo.history_todo"),g("todo.history_ticket"),g("todo.history_call"),g("todo.history_customer"),g("todo.history_note")])),ve=["ALL","TODO","TICKET","HISTORY_CALL","CUSTOMER","NOTE"],Ae=i({id:"",title:"",code:g("common.loading"),desc:"",statusIndex:0,sourceIndex:0,assigneeIndex:0,assigneeId:"",dueDate:"",notifyAt:"",customerCode:"",customerName:"",customerNameLabel:"",customerPhone:"",customerPhoneLabel:"",customerManagerName:"",customerManagerLabel:"",raw:void 0}),be=a((()=>[g("source.call"),g("source.customer"),g("source.conversation"),g("source.message")])),ke=i([]),xe=i([]),we=a((()=>{const e=[{label:g("todo.status_todo"),value:"TO_DO"},{label:g("todo.status_progress"),value:"IN_PROGRESS"},{label:g("todo.status_done"),value:"DONE"}];return Ae.value.raw&&"IN_PROGRESS"===Ae.value.raw.status?e.filter((e=>"TO_DO"!==e.value)):e})),Ie=a((()=>we.value.map((e=>e.label)))),_e=()=>{S.value=!1,W.value=null,I.value="",D.value=""};l((async e=>{await Oe(),e&&e.id&&Te(e.id)}));const Oe=async()=>{try{const e=await n();if(ke.value=e,xe.value=e.map((e=>e.UserName||g("common.unknown_member"))),Ae.value.assigneeId){const e=ke.value.findIndex((e=>e.memberUID===Ae.value.assigneeId));-1!==e&&(Ae.value.assigneeIndex=e)}}catch(e){console.error("Lá»—i láº¥y members",e)}};o((()=>{console.log("Refreshing detail..."),(async()=>{if(Ae.value.id)try{await Promise.all([Te(Ae.value.id)])}catch(e){console.error(e)}finally{m()}else m()})()}));const Te=async t=>{Ae.value.title?r():v.value=!0;try{const s=await se(t),a=(t=>{if(!t)return null;let s=[te.NEW,te.IN_PROGRESS,te.DONE].indexOf(t.status);-1===s&&(s=0);let a=[e.CALL,e.CUSTOMER,e.CONVERSATION,e.CHAT_MESSAGE].indexOf(t.links);return-1===a&&(a=0),t.notificationReceivedAt,{id:t.id,title:t.title||"",code:t.code||"",desc:t.description||"",statusIndex:s,sourceIndex:a,assigneeIndex:0,assigneeId:t.assigneeId||"",dueDate:Ce(t.dueDate),notifyAt:Ce(t.notificationReceivedAt),customerCode:t.customerCode||"",customerName:"",customerNameLabel:"TÃªn khÃ¡ch hÃ ng",customerPhone:"",customerPhoneLabel:"Sá»‘ Ä‘iá»‡n thoáº¡i",customerManagerName:"",raw:t}})(s&&s.data&&!s.id?s.data:s);if(a){Ae.value=a;const e=a.raw.status,s=we.value.findIndex((t=>t.value===e));if(-1!==s&&(Ae.value.statusIndex=s),Ae.value.assigneeId&&ke.value.length>0){const e=ke.value.findIndex((e=>e.memberUID===Ae.value.assigneeId));-1!==e&&(Ae.value.assigneeIndex=e)}De(t),Ae.value.customerCode&&(Re(Ae.value.customerCode),Ee(Ae.value.customerCode))}}catch(s){console.error("Lá»—i láº¥y chi tiáº¿t:",s),ae(g("common.error_connection"))}finally{v.value=!1,c()}},Se=e=>{var t;let s=g("todo.user_hidden"),a="?",i="#e3f2fd",l=!1;const n=String(f.uid);if(e.senderId){const t=String(e.senderId),a=ke.value.find((e=>String(e.UID)===t||String(e.memberUID)===t));a?(s=a.UserName,a.AvatarColor&&(i=a.AvatarColor),String(a.UID)===n&&(l=!0)):t===n&&(l=!0)}a=s.charAt(0).toUpperCase();let o="";switch(e.type){case"NEW_TODO":o=g("todo.action_NEW_TODO");break;case"REOPEN_TODO":o=g("todo.action_REOPEN_TODO");break;case"NEW_SUB_TODO":o=g("todo.action_NEW_SUB_TODO");break;case"UPDATE_TODO":o=g("todo.action_UPDATE_TODO");break;case"UPLOAD_ATTACHMENT":o=g("todo.action_UPLOAD_ATTACHMENT");break;case"COMMENT":o=g("todo.action_COMMENT");break;default:o=""}const r=(null==(t=e.reactions)?void 0:t.details)||[];return{id:e.id,senderId:e.senderId,senderName:s,senderAvatarChar:a,senderAvatarColor:i,message:e.message||"",files:e.files||"",timeDisplay:fe(e.createdAt,g),actionText:o,isEdited:!!e.updatedAt,type:e.type,reactions:r,children:[],isMe:l}},De=async e=>{C.value=!0;try{const t=B[V.value],s=await ie(e,t);Array.isArray(s)?w.value=s.map((e=>{const t=Se(e);return e.replies&&e.replies.length>0&&(t.children=e.replies.map((t=>{const s=Se(t);return s.rootParentId=e.id,s}))),t})):w.value=[]}catch(t){console.error("Lá»—i láº¥y bÃ¬nh luáº­n:",t)}finally{C.value=!1}},Re=async e=>{var t;A.value=!0;try{const s=f.todoToken;if(!s)return;const a=await d(s,e),i=a.fields||(null==(t=a.data)?void 0:t.fields)||[],l=i.find((e=>"name"===e.code)),n=i.find((e=>"phone"===e.code)),o=i.find((e=>"member_no"===e.code));if(l&&(Ae.value.customerName=l.value,Ae.value.customerNameLabel=l.name||g("todo.customer_name_label")),n&&(Ae.value.customerPhone=n.value,Ae.value.customerPhoneLabel=n.name),o){Ae.value.customerManagerLabel=o.name||g("todo.customer_manager_label");const e=o.value,t=ke.value.find((t=>t.memberUID===e));Ae.value.customerManagerName=t?t.UserName:g("todo.unknown")}}catch(s){console.error("Lá»—i CRM:",s)}finally{A.value=!1}},Ee=async e=>{b.value=!0;try{const t=ve[$.value],s=f.todoToken;if(!s)return void console.error("ChÆ°a cÃ³ Token CRM/Todo");const a=await u(s,e,t);Array.isArray(a)&&(k.value=a.map((e=>{const t=new Date(e.createAt),s=`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`;let a=g("common.system");if(e.memberUid){const t=ke.value.find((t=>t.memberUID===e.memberUid));t&&(a=t.UserName)}let i="";if(e.typeSub){const t=`timeline.${e.typeSub}`;i=g(t),i===t&&(i=le[e.typeSub]||e.typeSub)}else i=g("todo.interaction_other");return{id:e.id,timeStr:s,content:i,actorName:a,originalType:e.typeSub}})))}catch(t){console.error("Lá»—i láº¥y lá»‹ch sá»­:",t)}finally{b.value=!1}};return{isLoading:v,isLoadingCustomer:A,isLoadingHistory:b,historyList:k,form:Ae,statusOptions:Ie,sourceOptions:be,assigneeOptions:xe,onStatusChange:async e=>{const t=parseInt(e.detail.value),s=we.value[t];if(!s)return;Ae.value.statusIndex=t;const a=s.value;if(Ae.value.raw){v.value=!0;try{const e={...Ae.value.raw,status:a,preFixCode:"TODO",description:Ae.value.desc,files:"",tagCodes:"",title:Ae.value.title||Ae.value.raw.title};console.log("Payload Update Status:",e);if(await ce(e)){de(g("todo.msg_status_changed")),Ae.value.raw.status=a;const e=we.value.findIndex((e=>e.value===a));Ae.value.statusIndex=-1!==e?e:0,Ae.value.customerCode&&await Ee(Ae.value.customerCode),await De(Ae.value.id)}}catch(i){console.error("Lá»—i cáº­p nháº­t tráº¡ng thÃ¡i:",i),ae(g("todo.msg_update_error"))}finally{v.value=!1}}},onSourceChange:e=>{Ae.value.sourceIndex=e.detail.value},onAssigneeChange:async e=>{const t=parseInt(e.detail.value);if(!ke.value[t])return;const s=ke.value[t].memberUID;if(Ae.value.assigneeIndex=t,Ae.value.assigneeId=s,Ae.value.raw){v.value=!0;try{const e={...Ae.value.raw,assigneeId:s,preFixCode:"TODO",description:Ae.value.desc,files:"",tagCodes:"",title:Ae.value.title||Ae.value.raw.title};console.log("Payload Update Assignee:",e);await ce(e)&&(de(g("todo.msg_assignee_changed")),Ae.value.raw.assigneeId=s,Ae.value.customerCode&&await Ee(Ae.value.customerCode),await De(Ae.value.id))}catch(a){console.error("Lá»—i cáº­p nháº­t ngÆ°á»i giao:",a),ae(g("todo.msg_update_error"))}finally{v.value=!1}}else ae(g("common.error_missing_data"))},goBack:()=>{p()},saveTodo:()=>{console.log("LÆ°u:",Ae.value),de(g("todo.msg_saved"))},historyFilterOptions:ee,historyFilterIndex:$,onHistoryFilterChange:e=>{$.value=e.detail.value,Ae.value.customerCode&&Ee(Ae.value.customerCode)},comments:w,isLoadingComments:C,newCommentText:I,isSubmittingComment:_,submitComment:async()=>{if(Q(I.value))oe(g("todo.msg_empty_content"));else{_.value=!0;try{const{cleanMessage:e,fileUrl:t}=await F(I.value),s=Ae.value.id,a={todoId:s,senderId:X(),message:e,files:t,parentId:-1},i=await ue(a);if(i){de(g("todo.msg_comment_success")),I.value="";const e=await he(i,s);if(e){const t=Se(e);w.value.unshift(t)}}}catch(e){console.error("Lá»—i gá»­i bÃ¬nh luáº­n:",e),ae(g("common.error_send"))}finally{_.value=!1}}},isConfirmDeleteCommentOpen:O,onRequestDeleteComment:e=>{T.value=e,O.value=!0},confirmDeleteComment:async()=>{if(!T.value)return;const e=T.value;O.value=!1;try{await ge(e),de(g("todo.msg_deleted"));const t=w.value.findIndex((t=>t.id===e));if(-1!==t)w.value.splice(t,1);else for(const s of w.value)if(s.children&&s.children.length>0){const t=s.children.findIndex((t=>t.id===e));if(-1!==t){s.children.splice(t,1);break}}}catch(t){console.error("Lá»—i xÃ³a bÃ¬nh luáº­n:",t),ae(g("common.fail_delete"))}finally{T.value=null}},cancelDeleteComment:()=>{O.value=!1,T.value=null},currentUserId:y,isEditingComment:S,onRequestEditComment:async e=>{const t=Ae.value.id;if(t){E.value=!1,U.value=null,J.value="",q.value="";try{const s=await he(e,t);if(console.log("API Response Detail:",s),s){const e=s.data||s;W.value={id:e.id,todoId:e.todoId,senderId:e.senderId};const t=e.senderId,a=ke.value.find((e=>e.UID===t));D.value=a?a.UserName:g("common.me");const i=e.message||"";console.log("Ná»™i dung edit:",i),S.value=!0,await h(),I.value=i}}catch(s){console.error("Lá»—i láº¥y chi tiáº¿t bÃ¬nh luáº­n:",s),ae(g("common.error_load"))}finally{v.value=!1}}},submitUpdateComment:async()=>{if(W.value)if(Q(I.value))oe(g("todo.msg_empty_content"));else{_.value=!0;try{const{cleanMessage:e,fileUrl:t}=await F(I.value),s={id:W.value.id,todoId:W.value.todoId,senderId:W.value.senderId,message:e,files:t},a=await pe(s);if(a){de(g("todo.msg_update_success"));const e=w.value.findIndex((e=>e.id===a.id));if(-1!==e)w.value[e].message=a.message,w.value[e].files=a.files,w.value[e].isEdited=!0;else for(const t of w.value)if(t.children){const e=t.children.findIndex((e=>e.id===a.id));if(-1!==e){t.children[e].message=a.message,t.children[e].files=a.files,t.children[e].isEdited=!0;break}}_e()}}catch(e){console.error("Lá»—i cáº­p nháº­t:",e),ae(g("common.error_update"))}finally{_.value=!1}}},onCancelEditComment:()=>{R.value=!0},isConfirmCancelEditOpen:R,continueEditing:()=>{R.value=!1},confirmCancelEdit:async()=>{R.value=!1,_e()},editingMemberName:D,isEmojiPickerOpen:L,emojiList:["ðŸ‘","ðŸ‘Ž","ðŸ˜","ðŸ˜†","ðŸ˜±","ðŸ˜­","ðŸ˜¤"],onToggleEmojiPicker:e=>{M.value=e,L.value=!0},closeEmojiPicker:G,selectEmoji:async e=>{if(!M.value)return;const t=M.value.id;G();const s=Ae.value.id,a=f.uid,i={todoId:Number(s),senderId:a,todoMessageId:Number(t),codeEmoji:e};try{if(await me(i)){let s=null;const i=w.value.findIndex((e=>e.id===t));if(-1!==i)s=w.value[i];else for(const e of w.value)if(e.children){const a=e.children.find((e=>e.id===t));if(a){s=a;break}}if(s){s.reactions||(s.reactions=[]);const t=s.reactions.findIndex((e=>e.senderId===a));if(-1!==t){s.reactions[t].codeEmoji===e?console.log("User tháº£ trÃ¹ng emoji cÅ©"):s.reactions[t].codeEmoji=e}else s.reactions.push({codeEmoji:e,senderId:a});s.reactions=[...s.reactions]}}}catch(l){console.error("Lá»—i tháº£ cáº£m xÃºc:",l),ae(g("common.error_connection"))}},isReplying:E,isConfirmCancelReplyOpen:N,replyingCommentData:U,replyingMemberName:J,onRequestReply:async e=>{S.value=!1,W.value=null,I.value="",U.value=e;const t=e.message||"",{cleanHtml:s}=Z(t);q.value=s,E.value=!0;const a=e.senderId,i=ke.value.find((e=>e.memberUID===a));J.value=i?i.UserName:g("todo.user_hidden"),await h()},onCancelReply:()=>{I.value.trim()?N.value=!0:K()},confirmCancelReply:K,continueReplying:()=>{N.value=!1},submitReply:async()=>{if(Q(I.value))oe(g("todo.msg_empty_content"));else if(U.value){_.value=!0;try{const{cleanMessage:e,fileUrl:t}=await F(I.value),s=Ae.value.id,a=X();let i=U.value.id;U.value.rootParentId&&(i=U.value.rootParentId);const l={todoId:s,senderId:a,message:e,files:t,parentId:i},n=await ue(l);if(n){de(g("todo.msg_reply_success"));const e=await he(n,Ae.value.id),t=Se(e),s=U.value.rootParentId||U.value.id,a=w.value.find((e=>e.id===s));a&&(a.children||(a.children=[]),t.rootParentId=s,a.children.push(t)),H()}}catch(e){console.error("Lá»—i gá»­i tráº£ lá»i:",e),ae(g("common.error_send"))}finally{_.value=!1}}},commentFilterIndex:V,commentFilterOptions:z,onCommentFilterChange:e=>{const t=e.detail.value;V.value!==t&&(V.value=t,Ae.value.id&&De(Ae.value.id))},isSavingDescription:j,onSaveDescription:async()=>{if(!P.value)if(Ae.value.raw){j.value=!0;try{const{newContent:e,fileUrls:t}=await(async e=>{if(!e)return{newContent:"",fileUrls:[]};const t=/<img[^>]+src="([^">]+)"/g;let s;const a=[],i=[],l=[];for(;null!==(s=t.exec(e));){const e=s[1];if(!e.startsWith("http")&&!e.startsWith("https")){const t=ye(e).then((t=>{i.push({oldSrc:e,newSrc:t}),l.push(t)})).catch((e=>{console.error("Upload áº£nh detail lá»—i:",e)}));a.push(t)}}a.length>0&&await Promise.all(a);let n=e;return i.forEach((e=>{n=n.split(e.oldSrc).join(e.newSrc)})),{newContent:n,fileUrls:l}})(Ae.value.desc);Ae.value.desc=e;const s=t.length>0?t.join(","):"",a={...Ae.value.raw,preFixCode:"TODO",description:Ae.value.desc,files:s,tagCodes:"",title:Ae.value.title||Ae.value.raw.title};console.log("Payload Update Description:",a);await ce(a)&&(de(g("todo.msg_desc_saved")),Ae.value.raw.description=Ae.value.desc,s&&(Ae.value.raw.files=s),await De(Ae.value.id))}catch(e){console.error("Lá»—i cáº­p nháº­t cÃ´ng viá»‡c:",e),ae(g("common.error_update"))}finally{j.value=!1}}else ae(g("common.error_missing_data"))},onDateUpdate:async e=>{if(P.value)return;if(!Ae.value.raw)return;let t=Ae.value.dueDate,s=Ae.value.notifyAt;"dueDate"===e.field?t=e.value:"notifyAt"===e.field&&(s=e.value);if(!ne(t,s))return oe(g("todo.msg_notify_must_be_before_due")),"dueDate"===e.field?Ae.value.dueDate:Ae.value.notifyAt,void("dueDate"===e.field?Ae.value.dueDate=Ae.value.raw.dueDate?re(Ae.value.raw.dueDate):"":Ae.value.notifyAt=Ae.value.raw.notificationReceivedAt?re(Ae.value.raw.notificationReceivedAt):"");v.value=!0;try{const t={...Ae.value.raw,preFixCode:"TODO",description:Ae.value.desc,files:"",tagCodes:"",title:Ae.value.title||Ae.value.raw.title},s=(e=>{if(!e)return 0;try{const t=e.replace(/-/g,"/");return new Date(t).getTime()}catch{return 0}})(e.value);"dueDate"===e.field?t.dueDate=s:"notifyAt"===e.field&&(t.notificationReceivedAt=s),console.log(`Payload Update ${e.field}:`,t);await ce(t)&&(de(g("todo.msg_update_success")),"dueDate"===e.field?(Ae.value.raw.dueDate=t.dueDate,Ae.value.dueDate=e.value):(Ae.value.raw.notificationReceivedAt=t.notificationReceivedAt,Ae.value.notifyAt=e.value),Ae.value.customerCode&&await Ee(Ae.value.customerCode),await De(Ae.value.id))}catch(a){console.error("Lá»—i cáº­p nháº­t ngÃ y:",a),ae(g("todo.msg_update_error")),"dueDate"===e.field?Ae.value.dueDate=re(Ae.value.raw.dueDate):Ae.value.notifyAt=re(Ae.value.raw.notificationReceivedAt)}finally{v.value=!1}},isStatusDisabled:Y,dynamicStatusOptions:we,onSaveTitle:async()=>{if(P.value)return;if(!Ae.value.raw)return;const e=Ae.value.title?Ae.value.title.trim():"",t=Ae.value.raw.title;if(!e)return oe(g("todo.msg_title_empty")),void(Ae.value.title=t);if(e!==t){v.value=!0;try{const t={...Ae.value.raw,title:e,preFixCode:"TODO",description:Ae.value.raw.description,files:Ae.value.raw.files||"",tagCodes:Ae.value.raw.tagCodes||""};console.log("Payload Update Title:",t);await ce(t)&&(de(g("todo.msg_title_changed")),Ae.value.raw.title=e,Ae.value.customerCode&&await Ee(Ae.value.customerCode),await De(Ae.value.id))}catch(s){console.error("Lá»—i cáº­p nháº­t tiÃªu Ä‘á»:",s),ae(g("todo.msg_update_error")),Ae.value.title=t}finally{v.value=!1}}},replyingMessagePreview:q,isHistoryOpen:x,toggleHistory:()=>{x.value=!x.value},isDone:P}};var _e={abbr:!0,b:!0,big:!0,code:!0,del:!0,em:!0,i:!0,ins:!0,label:!0,q:!0,small:!0,span:!0,strong:!0,sub:!0,sup:!0};const Oe={isInline:function(e,t){return _e[e]||-1!==(t||"").indexOf("display:inline")}},Te=e=>{e.$wxs||(e.$wxs=[]),e.$wxs.push("handler"),e.mixins||(e.mixins=[]),e.mixins.push({beforeCreate(){this.handler=Oe}})},Se={name:"node",options:{},data:()=>({ctrl:{},nodes:[]}),props:{name:String,attrs:{type:Object,default:()=>({})},childs:Array,opts:Array},watch:{childs:{handler(e){for(;this.nodes.length>e.length;)e.push({});this.nodes=e},immediate:!0}},components:{},mounted(){if(this.$nextTick((()=>{for(this.root=this.$parent;"mp-html"!==this.root.$options.name;this.root=this.root.$parent);})),this.opts[0]){let e;for(e=this.childs.length;e--&&"img"!==this.childs[e].name;);-1!==e&&(this.observer=g(this).relativeToViewport({top:500,bottom:500}),this.observer.observe("._img",(e=>{e.intersectionRatio&&(this.$set(this.ctrl,"load",1),this.observer.disconnect())})))}},beforeDestroy(){this.observer&&this.observer.disconnect()},methods:{play(e){const t=e.currentTarget.dataset.i,s=this.childs[t];if(this.root.$emit("play",{source:s.name,attrs:{...s.attrs,src:s.src[this.ctrl[t]||0]}}),this.root.pauseVideo){let t=!1;const s=e.target.id;for(let e=this.root._videos.length;e--;)this.root._videos[e].id===s?t=!0:this.root._videos[e].pause();if(!t){const e=f(s,this);e.id=s,this.root.playbackRate&&e.playbackRate(this.root.playbackRate),this.root._videos.push(e)}}},mediaEvent(e){const t=e.currentTarget.dataset.i,s=this.childs[t];this.root.$emit(e.type,{...e.detail,source:s.name,attrs:{...s.attrs,src:s.src[this.ctrl[t]||0]}})},imgTap(e){const t=this.childs[e.currentTarget.dataset.i];t.a?this.linkTap(t.a):t.attrs.ignore||(t.attrs.src=t.attrs.src||t.attrs["data-src"],this.root.$emit("imgtap",t.attrs),this.root.previewImg&&y({current:parseInt(t.attrs.i),urls:this.root.imgList}))},imgLongTap(e){},imgLoad(e){const t=e.currentTarget.dataset.i;(this.opts[1]&&!this.ctrl[t]||-1===this.ctrl[t])&&this.$set(this.ctrl,t,1),this.checkReady()},checkReady(){this.root&&!this.root.lazyLoad&&(this.root._unloadimgs-=1,this.root._unloadimgs||setTimeout((()=>{this.root.getRect().then((e=>{this.root.$emit("ready",e)})).catch((()=>{this.root.$emit("ready",{})}))}),350))},linkTap(e){const t=e.currentTarget?this.childs[e.currentTarget.dataset.i]:{},s=t.attrs||e,a=s.href;this.root.$emit("linktap",Object.assign({innerText:this.root.getText(t.children||[])},s)),a&&("#"===a[0]?this.root.navigateTo(a.substring(1)).catch((()=>{})):a.split("?")[0].includes("://")?this.root.copyLink&&window.open(a):v({url:a,fail(){A({url:a,fail(){}})}}))},mediaError(e){const t=e.currentTarget.dataset.i,s=this.childs[t];if("video"===s.name||"audio"===s.name){let e=(this.ctrl[t]||0)+1;if(e>s.src.length&&(e=0),e<s.src.length)return void this.$set(this.ctrl,t,e)}else if("img"===s.name){if(this.opts[0]&&!this.ctrl.load)return;this.opts[2]&&this.$set(this.ctrl,t,-1),this.checkReady()}this.root&&this.root.$emit("error",{source:s.name,attrs:s.attrs})}}};Te(Se);const De=ve(Se,[["render",function(e,t,s,a,i,l){const n=U,o=J,r=b("node",!0),c=L,d=M,u=V;return k(),x(c,{id:s.attrs.id,class:S("_block _"+s.name+" "+s.attrs.class),style:O(s.attrs.style)},{default:w((()=>[(k(!0),C(I,null,_(i.nodes,((a,h)=>(k(),C(I,{key:h},["img"===a.name&&!a.t&&(s.opts[1]&&!i.ctrl[h]||i.ctrl[h]<0)?(k(),x(n,{key:0,class:"_img",style:O(a.attrs.style),src:i.ctrl[h]<0?s.opts[2]:s.opts[1],mode:"widthFix"},null,8,["style","src"])):T("",!0),"img"===a.name?(k(),C("img",{key:1,id:a.attrs.id,class:S("_img "+a.attrs.class),style:O((-1===i.ctrl[h]?"display:none;":"")+a.attrs.style),src:a.attrs.src||(i.ctrl.load?a.attrs["data-src"]:""),"data-i":h,onLoad:t[0]||(t[0]=(...e)=>l.imgLoad&&l.imgLoad(...e)),onError:t[1]||(t[1]=(...e)=>l.mediaError&&l.mediaError(...e)),onClick:t[2]||(t[2]=D(((...e)=>l.imgTap&&l.imgTap(...e)),["stop"])),onLongpress:t[3]||(t[3]=(...e)=>l.imgLongTap&&l.imgLongTap(...e))},null,46,["id","src","data-i"])):a.text?(k(),x(o,{key:2,decode:""},{default:w((()=>[R(E(a.text),1)])),_:2},1024)):"br"===a.name?(k(),x(o,{key:3},{default:w((()=>[R(E("\n"))])),_:1})):"a"===a.name?(k(),x(c,{key:4,id:a.attrs.id,class:S((a.attrs.href?"_a ":"")+a.attrs.class),"hover-class":"_hover",style:O("display:inline;"+a.attrs.style),"data-i":h,onClick:D(l.linkTap,["stop"])},{default:w((()=>[N(r,{name:"span",childs:a.children,opts:s.opts,style:{display:"inherit"}},null,8,["childs","opts"])])),_:2},1032,["id","class","style","data-i","onClick"])):"video"===a.name?(k(),x(d,{key:5,id:a.attrs.id,class:S(a.attrs.class),style:O(a.attrs.style),autoplay:a.attrs.autoplay,controls:a.attrs.controls,loop:a.attrs.loop,muted:a.attrs.muted,"object-fit":a.attrs["object-fit"],poster:a.attrs.poster,src:a.src[i.ctrl[h]||0],"data-i":h,onPlay:l.play,onPause:l.mediaEvent,onFullscreenchange:l.mediaEvent,onError:l.mediaError},null,8,["id","class","style","autoplay","controls","loop","muted","object-fit","poster","src","data-i","onPlay","onPause","onFullscreenchange","onError"])):"iframe"===a.name?(k(),C("iframe",{key:6,style:O(a.attrs.style),allowfullscreen:a.attrs.allowfullscreen,frameborder:a.attrs.frameborder,src:a.attrs.src},null,12,["allowfullscreen","frameborder","src"])):"embed"===a.name?(k(),C("embed",{key:7,style:O(a.attrs.style),src:a.attrs.src},null,12,["src"])):"table"===a.name&&a.c||"li"===a.name?(k(),x(c,{key:8,id:a.attrs.id,class:S("_"+a.name+" "+a.attrs.class),style:O(a.attrs.style)},{default:w((()=>["li"===a.name?(k(),x(r,{key:0,childs:a.children,opts:s.opts},null,8,["childs","opts"])):(k(!0),C(I,{key:1},_(a.children,((e,t)=>(k(),x(c,{key:t,class:S("_"+e.name+" "+e.attrs.class),style:O(e.attrs.style)},{default:w((()=>["td"===e.name||"th"===e.name?(k(),x(r,{key:0,childs:e.children,opts:s.opts},null,8,["childs","opts"])):(k(!0),C(I,{key:1},_(e.children,((e,t)=>(k(),C(I,{key:t},["td"===e.name||"th"===e.name?(k(),x(c,{key:0,class:S("_"+e.name+" "+e.attrs.class),style:O(e.attrs.style)},{default:w((()=>[N(r,{childs:e.children,opts:s.opts},null,8,["childs","opts"])])),_:2},1032,["class","style"])):(k(),x(c,{key:1,class:S("_"+e.name+" "+e.attrs.class),style:O(e.attrs.style)},{default:w((()=>[(k(!0),C(I,null,_(e.children,((e,t)=>(k(),x(c,{key:t,class:S("_"+e.name+" "+e.attrs.class),style:O(e.attrs.style)},{default:w((()=>[N(r,{childs:e.children,opts:s.opts},null,8,["childs","opts"])])),_:2},1032,["class","style"])))),128))])),_:2},1032,["class","style"]))],64)))),128))])),_:2},1032,["class","style"])))),128))])),_:2},1032,["id","class","style"])):a.c||e.handler.isInline(a.name,a.attrs.style)?2===a.c?(k(),x(c,{key:10,id:a.attrs.id,class:S("_block _"+a.name+" "+a.attrs.class),style:O(a.f+";"+a.attrs.style)},{default:w((()=>[(k(!0),C(I,null,_(a.children,((e,t)=>(k(),x(r,{key:t,style:O(e.f),name:e.name,attrs:e.attrs,childs:e.children,opts:s.opts},null,8,["style","name","attrs","childs","opts"])))),128))])),_:2},1032,["id","class","style"])):(k(),x(r,{key:11,style:O(a.f),name:a.name,attrs:a.attrs,childs:a.children,opts:s.opts},null,8,["style","name","attrs","childs","opts"])):(k(),x(u,{key:9,id:a.attrs.id,style:O(a.f),"user-select":s.opts[4],nodes:[a]},null,8,["id","style","user-select","nodes"]))],64)))),128))])),_:1},8,["id","class","style"])}],["__scopeId","data-v-c6611527"]]),Re={trustTags:Me("a,abbr,ad,audio,b,blockquote,br,code,col,colgroup,dd,del,dl,dt,div,em,fieldset,h1,h2,h3,h4,h5,h6,hr,i,img,ins,label,legend,li,ol,p,q,ruby,rt,source,span,strong,sub,sup,table,tbody,td,tfoot,th,thead,tr,title,ul,video"),blockTags:Me("address,article,aside,body,caption,center,cite,footer,header,html,nav,pre,section"),ignoreTags:Me("area,base,canvas,embed,frame,head,iframe,input,link,map,meta,param,rp,script,source,style,textarea,title,track,wbr"),voidTags:Me("area,base,br,col,circle,ellipse,embed,frame,hr,img,input,line,link,meta,param,path,polygon,rect,source,track,use,wbr"),entities:{lt:"<",gt:">",quot:'"',apos:"'",ensp:"â€‚",emsp:"â€ƒ",nbsp:"Â ",semi:";",ndash:"â€“",mdash:"â€”",middot:"Â·",lsquo:"â€˜",rsquo:"â€™",ldquo:"â€œ",rdquo:"â€",bull:"â€¢",hellip:"â€¦",larr:"â†",uarr:"â†‘",rarr:"â†’",darr:"â†“"},tagStyle:{address:"font-style:italic",big:"display:inline;font-size:1.2em",caption:"display:table-caption;text-align:center",center:"text-align:center",cite:"font-style:italic",dd:"margin-left:40px",mark:"background-color:yellow",pre:"font-family:monospace;white-space:pre",s:"text-decoration:line-through",small:"display:inline;font-size:0.8em",strike:"text-decoration:line-through",u:"text-decoration:underline"},svgDict:{animatetransform:"animateTransform",lineargradient:"linearGradient",viewbox:"viewBox",attributename:"attributeName",repeatcount:"repeatCount",repeatdur:"repeatDur",foreignobject:"foreignObject"}},Ee={};let Ne;const Ue=z();Ne=Ue.windowWidth;const Je=Me(" ,\r,\n,\t,\f");let Le=0;function Me(e){const t=Object.create(null),s=e.split(",");for(let a=s.length;a--;)t[s[a]]=!0;return t}function Ve(e,t){let s=e.indexOf("&");for(;-1!==s;){const a=e.indexOf(";",s+3);let i;if(-1===a)break;"#"===e[s+1]?(i=parseInt(("x"===e[s+2]?"0":"")+e.substring(s+2,a)),isNaN(i)||(e=e.substr(0,s)+String.fromCharCode(i)+e.substr(a+1))):(i=e.substring(s+1,a),(Re.entities[i]||"amp"===i&&t)&&(e=e.substr(0,s)+(Re.entities[i]||"&")+e.substr(a+1))),s=e.indexOf("&",s+1)}return e}function ze(e){let t=e.length-1;for(let s=t;s>=-1;s--)(-1===s||e[s].c||!e[s].name||"div"!==e[s].name&&"p"!==e[s].name&&"h"!==e[s].name[0]||(e[s].attrs.style||"").includes("inline"))&&(t-s>=5&&e.splice(s+1,t-s,{name:"div",attrs:{},children:e.slice(s+1,t+1)}),t=s-1)}function Be(e){this.options=e||{},this.tagStyle=Object.assign({},Re.tagStyle,this.options.tagStyle),this.imgList=e.imgList||[],this.imgList._unloadimgs=0,this.plugins=e.plugins||[],this.attrs=Object.create(null),this.stack=[],this.nodes=[],this.pre=(this.options.containerStyle||"").includes("white-space")&&this.options.containerStyle.includes("pre")?2:0}function je(e){this.handler=e}Re.ignoreTags.iframe=void 0,Re.trustTags.iframe=!0,Re.ignoreTags.embed=void 0,Re.trustTags.embed=!0,Be.prototype.parse=function(e){for(let t=this.plugins.length;t--;)this.plugins[t].onUpdate&&(e=this.plugins[t].onUpdate(e,Re)||e);for(new je(this).parse(e);this.stack.length;)this.popNode();return this.nodes.length>50&&ze(this.nodes),this.nodes},Be.prototype.expose=function(){for(let e=this.stack.length;e--;){const t=this.stack[e];if(t.c||"a"===t.name||"video"===t.name||"audio"===t.name)return;t.c=1}},Be.prototype.hook=function(e){for(let t=this.plugins.length;t--;)if(this.plugins[t].onParse&&!1===this.plugins[t].onParse(e,this))return!1;return!0},Be.prototype.getUrl=function(e){const t=this.options.domain;return"/"===e[0]?"/"===e[1]?e=(t?t.split("://")[0]:"http")+":"+e:t&&(e=t+e):e.includes("data:")||e.includes("://")||t&&(e=t+"/"+e),e},Be.prototype.parseStyle=function(e){const t=e.attrs,s=(this.tagStyle[e.name]||"").split(";").concat((t.style||"").split(";")),a={};let i="";t.id&&!this.xml&&(this.options.useAnchor?this.expose():"img"!==e.name&&"a"!==e.name&&"video"!==e.name&&"audio"!==e.name&&(t.id=void 0)),t.width&&(a.width=parseFloat(t.width)+(t.width.includes("%")?"%":"px"),t.width=void 0),t.height&&(a.height=parseFloat(t.height)+(t.height.includes("%")?"%":"px"),t.height=void 0);for(let l=0,n=s.length;l<n;l++){const e=s[l].split(":");if(e.length<2)continue;const t=e.shift().trim().toLowerCase();let n=e.join(":").trim();if("-"===n[0]&&n.lastIndexOf("-")>0||n.includes("safe"))i+=`;${t}:${n}`;else if(!a[t]||n.includes("import")||!a[t].includes("import")){if(n.includes("url")){let e=n.indexOf("(")+1;if(e){for(;'"'===n[e]||"'"===n[e]||Je[n[e]];)e++;n=n.substr(0,e)+this.getUrl(n.substr(e))}}else n.includes("rpx")&&(n=n.replace(/[0-9.]+\s*rpx/g,(e=>parseFloat(e)*Ne/750+"px")));a[t]=n}}return e.attrs.style=i,a},Be.prototype.onTagName=function(e){this.tagName=this.xml?e:e.toLowerCase(),"svg"===this.tagName&&(this.xml=(this.xml||0)+1,Re.ignoreTags.style=void 0)},Be.prototype.onAttrName=function(e){(e=this.xml?e:e.toLowerCase()).includes("?")||e.includes(";")?this.attrName=void 0:"data-"===e.substr(0,5)?"data-src"!==e||this.attrs.src?"img"===this.tagName||"a"===this.tagName?this.attrName=e:this.attrName=void 0:this.attrName="src":(this.attrName=e,this.attrs[e]="T")},Be.prototype.onAttrVal=function(e){const t=this.attrName||"";"style"===t||"href"===t?this.attrs[t]=Ve(e,!0):t.includes("src")?this.attrs[t]=this.getUrl(Ve(e,!0)):t&&(this.attrs[t]=e)},Be.prototype.onOpenTag=function(e){const t=Object.create(null);t.name=this.tagName,t.attrs=this.attrs,this.options.nodes.length&&(t.type="node"),this.attrs=Object.create(null);const s=t.attrs,a=this.stack[this.stack.length-1],i=a?a.children:this.nodes,l=this.xml?e:Re.voidTags[t.name];if(Ee[t.name]&&(s.class=Ee[t.name]+(s.class?" "+s.class:"")),"embed"===t.name&&this.expose(),"video"!==t.name&&"audio"!==t.name||("video"!==t.name||s.id||(s.id="v"+Le++),s.controls||s.autoplay||(s.controls="T"),t.src=[],s.src&&(t.src.push(s.src),s.src=void 0),this.expose()),l){if(!this.hook(t)||Re.ignoreTags[t.name])return void("base"!==t.name||this.options.domain?"source"===t.name&&a&&("video"===a.name||"audio"===a.name)&&s.src&&a.src.push(s.src):this.options.domain=s.href);const e=this.parseStyle(t);if("img"===t.name){if(s.src&&(s.src.includes("webp")&&(t.webp="T"),s.src.includes("data:")&&"all"!==this.options.previewImg&&!s["original-src"]&&(s.ignore="T"),!s.ignore||t.webp||s.src.includes("cloud://"))){for(let i=this.stack.length;i--;){const a=this.stack[i];"a"===a.name&&(t.a=a.attrs),"table"!==a.name||t.webp||s.src.includes("cloud://")||(!e.display||e.display.includes("inline")?t.t="inline-block":t.t=e.display,e.display=void 0),a.c=1}s.i=this.imgList.length.toString();let a=s["original-src"]||s.src;this.imgList.push(a),t.t||(this.imgList._unloadimgs+=1),this.options.lazyLoad&&(s["data-src"]=s.src,s.src=void 0)}"inline"===e.display&&(e.display=""),s.ignore&&(e["max-width"]=e["max-width"]||"100%",s.style+=";-webkit-touch-callout:none"),parseInt(e.width)>Ne&&(e.height=void 0),isNaN(parseInt(e.width))||(t.w="T"),!isNaN(parseInt(e.height))&&(!e.height.includes("%")||a&&(a.attrs.style||"").includes("height"))&&(t.h="T"),t.w&&t.h&&e["object-fit"]&&("contain"===e["object-fit"]?t.m="aspectFit":"cover"===e["object-fit"]&&(t.m="aspectFill"))}else if("svg"===t.name)return i.push(t),this.stack.push(t),void this.popNode();for(const t in e)e[t]&&(s.style+=`;${t}:${e[t].replace(" !important","")}`);s.style=s.style.substr(1)||void 0}else("pre"===t.name||(s.style||"").includes("white-space")&&s.style.includes("pre"))&&2!==this.pre&&(this.pre=t.pre=1),t.children=[],this.stack.push(t);i.push(t)},Be.prototype.onCloseTag=function(e){let t;for(e=this.xml?e:e.toLowerCase(),t=this.stack.length;t--&&this.stack[t].name!==e;);if(-1!==t)for(;this.stack.length>t;)this.popNode();else if("p"===e||"br"===e){(this.stack.length?this.stack[this.stack.length-1].children:this.nodes).push({name:e,attrs:{class:Ee[e]||"",style:this.tagStyle[e]||""}})}},Be.prototype.popNode=function(){const e=this.stack.pop();let t=e.attrs;const s=e.children,a=this.stack[this.stack.length-1],i=a?a.children:this.nodes;if(!this.hook(e)||Re.ignoreTags[e.name])return"title"===e.name&&s.length&&"text"===s[0].type&&this.options.setTitle&&B({title:s[0].text}),void i.pop();if(e.pre&&2!==this.pre){this.pre=e.pre=void 0;for(let e=this.stack.length;e--;)this.stack[e].pre&&(this.pre=1)}const l={};if("svg"===e.name){if(this.xml>1)return void this.xml--;let s="";const a=t.style;return t.style="",t.xmlns="http://www.w3.org/2000/svg",function e(t){if("text"===t.type)return void(s+=t.text);const a=Re.svgDict[t.name]||t.name;if("foreignObject"===a)for(const s of t.children||[])if(s.attrs&&!s.attrs.xmlns){s.attrs.xmlns="http://www.w3.org/1999/xhtml";break}s+="<"+a;for(const i in t.attrs){const e=t.attrs[i];e&&(s+=` ${Re.svgDict[i]||i}="${e.replace(/"/g,"")}"`)}if(t.children){s+=">";for(let s=0;s<t.children.length;s++)e(t.children[s]);s+="</"+a+">"}else s+="/>"}(e),e.name="img",e.attrs={src:"data:image/svg+xml;utf8,"+s.replace(/#/g,"%23"),style:a,ignore:"T"},e.children=void 0,this.xml=!1,void(Re.ignoreTags.style=!0)}if(t.align&&("table"===e.name?"center"===t.align?l["margin-inline-start"]=l["margin-inline-end"]="auto":l.float=t.align:l["text-align"]=t.align,t.align=void 0),t.dir&&(l.direction=t.dir,t.dir=void 0),"font"===e.name&&(t.color&&(l.color=t.color,t.color=void 0),t.face&&(l["font-family"]=t.face,t.face=void 0),t.size)){let e=parseInt(t.size);isNaN(e)||(e<1?e=1:e>7&&(e=7),l["font-size"]=["x-small","small","medium","large","x-large","xx-large","xxx-large"][e-1]),t.size=void 0}if((t.class||"").includes("align-center")&&(l["text-align"]="center"),Object.assign(l,this.parseStyle(e)),"table"!==e.name&&parseInt(l.width)>Ne&&(l["max-width"]="100%",l["box-sizing"]="border-box"),Re.blockTags[e.name]?e.name="div":Re.trustTags[e.name]||this.xml||(e.name="span"),"a"===e.name||"ad"===e.name||"iframe"===e.name)this.expose();else if("video"===e.name)(l.height||"").includes("auto")&&(l.height=void 0);else if("ul"!==e.name&&"ol"!==e.name||!e.c)if("table"===e.name){let a=parseFloat(t.cellpadding),i=parseFloat(t.cellspacing);const n=parseFloat(t.border),o=l["border-color"],r=l["border-style"];if(e.c&&(isNaN(a)&&(a=2),isNaN(i)&&(i=2)),n&&(t.style+=`;border:${n}px ${r||"solid"} ${o||"gray"}`),e.flag&&e.c){l.display="grid","collapse"===l["border-collapse"]&&(l["border-collapse"]=void 0,i=0),i?(l["grid-gap"]=i+"px",l.padding=i+"px"):n&&(t.style+=";border-left:0;border-top:0");const c=[],d=[],u=[],h={};!function e(t){for(let s=0;s<t.length;s++)if("tr"===t[s].name)d.push(t[s]);else if("colgroup"===t[s].name){let e=1;for(const a of t[s].children||[])if("col"===a.name){const t=a.attrs.style||"",s=t.indexOf("width")?t.indexOf(";width"):0;if(-1!==s){let a=t.indexOf(";",s+6);-1===a&&(a=t.length),c[e]=t.substring(s?s+7:6,a)}e+=1}}else e(t[s].children||[])}(s);for(let e=1;e<=d.length;e++){let t=1;for(let s=0;s<d[e-1].children.length;s++){const l=d[e-1].children[s];if("td"===l.name||"th"===l.name){for(;h[e+"."+t];)t++;let s=l.attrs.style||"",d=s.indexOf("width")?s.indexOf(";width"):0;if(-1!==d){let e=s.indexOf(";",d+6);-1===e&&(e=s.length),l.attrs.colspan||(c[t]=s.substring(d?d+7:6,e)),s=s.substr(0,d)+s.substr(e)}if(s+=";display:flex",d=s.indexOf("vertical-align"),-1!==d){const e=s.substr(d+15,10);e.includes("middle")?s+=";align-items:center":e.includes("bottom")&&(s+=";align-items:flex-end")}else s+=";align-items:center";if(d=s.indexOf("text-align"),-1!==d){const e=s.substr(d+11,10);e.includes("center")?s+=";justify-content: center":e.includes("right")&&(s+=";justify-content: right")}if(s=(n?`;border:${n}px ${r||"solid"} ${o||"gray"}`+(i?"":";border-right:0;border-bottom:0"):"")+(a?`;padding:${a}px`:"")+";"+s,l.attrs.colspan&&(s+=`;grid-column-start:${t};grid-column-end:${t+parseInt(l.attrs.colspan)}`,l.attrs.rowspan||(s+=`;grid-row-start:${e};grid-row-end:${e+1}`),t+=parseInt(l.attrs.colspan)-1),l.attrs.rowspan){s+=`;grid-row-start:${e};grid-row-end:${e+parseInt(l.attrs.rowspan)}`,l.attrs.colspan||(s+=`;grid-column-start:${t};grid-column-end:${t+1}`);for(let s=1;s<l.attrs.rowspan;s++)for(let a=0;a<(l.attrs.colspan||1);a++)h[e+s+"."+(t-a)]=1}s&&(l.attrs.style=s),u.push(l),t++}}if(1===e){let e="";for(let s=1;s<t;s++)e+=(c[s]?c[s]:"auto")+" ";l["grid-template-columns"]=e}}e.children=u}else e.c&&(l.display="table"),isNaN(i)||(l["border-spacing"]=i+"px"),(n||a)&&function e(t){for(let s=0;s<t.length;s++){const i=t[s];"th"===i.name||"td"===i.name?(n&&(i.attrs.style=`border:${n}px ${r||"solid"} ${o||"gray"};${i.attrs.style||""}`),a&&(i.attrs.style=`padding:${a}px;${i.attrs.style||""}`)):i.children&&e(i.children)}}(s);if(this.options.scrollTable&&!(t.style||"").includes("inline")){const s=Object.assign({},e);e.name="div",e.attrs={style:"overflow:auto"},e.children=[s],t=s.attrs}}else if(("tbody"===e.name||"tr"===e.name)&&e.flag&&e.c)e.flag=void 0,function e(t){for(let s=0;s<t.length;s++)if("td"===t[s].name)for(const e of["color","background","background-color"])l[e]&&(t[s].attrs.style=e+":"+l[e]+";"+(t[s].attrs.style||""));else e(t[s].children||[])}(s);else if("td"!==e.name&&"th"!==e.name||!t.colspan&&!t.rowspan)if("ruby"===e.name){e.name="span";for(let e=0;e<s.length-1;e++)"text"===s[e].type&&"rt"===s[e+1].name&&(s[e]={name:"div",attrs:{style:"display:inline-block;text-align:center"},children:[{name:"div",attrs:{style:"font-size:50%;"+(s[e+1].attrs.style||"")},children:s[e+1].children},s[e]]},s.splice(e+1,1))}else e.c&&function(e){e.c=2;for(let t=e.children.length;t--;){const s=e.children[t];s.c&&"table"!==s.name||(e.c=1)}}(e);else for(let o=this.stack.length;o--;)"table"!==this.stack[o].name&&"tbody"!==this.stack[o].name&&"tr"!==this.stack[o].name||(this.stack[o].flag=1);else{const e={a:"lower-alpha",A:"upper-alpha",i:"lower-roman",I:"upper-roman"};e[t.type]&&(t.style+=";list-style-type:"+e[t.type],t.type=void 0);for(let t=s.length;t--;)"li"===s[t].name&&(s[t].c=1)}if((l.display||"").includes("flex")&&!e.c)for(let o=s.length;o--;){const e=s[o];e.f&&(e.attrs.style=(e.attrs.style||"")+e.f,e.f=void 0)}const n=a&&((a.attrs.style||"").includes("flex")||(a.attrs.style||"").includes("grid"))&&!e.c;n&&(e.f=";max-width:100%"),s.length>=50&&e.c&&!(l.display||"").includes("flex")&&ze(s);for(const o in l)if(l[o]){const s=`;${o}:${l[o].replace(" !important","")}`;n&&(o.includes("flex")&&"flex-direction"!==o||"align-self"===o||o.includes("grid")||"-"===l[o][0]||o.includes("width")&&s.includes("%"))?(e.f+=s,"width"===o&&(t.style+=";width:100%")):t.style+=s}t.style=t.style.substr(1)||void 0},Be.prototype.onText=function(e){if(!this.pre){let t,s="";for(let a=0,i=e.length;a<i;a++)Je[e[a]]?(" "!==s[s.length-1]&&(s+=" "),"\n"!==e[a]||t||(t=!0)):s+=e[a];if(" "===s){if(t)return;{const e=this.stack[this.stack.length-1];if(e&&"t"===e.name[0])return}}e=s}const t=Object.create(null);if(t.type="text",t.text=Ve(e),this.hook(t)){(this.stack.length?this.stack[this.stack.length-1].children:this.nodes).push(t)}},je.prototype.parse=function(e){this.content=e||"",this.i=0,this.start=0,this.state=this.text;for(let t=this.content.length;-1!==this.i&&this.i<t;)this.state()},je.prototype.checkClose=function(e){const t="/"===this.content[this.i];return!!(">"===this.content[this.i]||t&&">"===this.content[this.i+1])&&(e&&this.handler[e](this.content.substring(this.start,this.i)),this.i+=t?2:1,this.start=this.i,this.handler.onOpenTag(t),"script"===this.handler.tagName?(this.i=this.content.indexOf("</",this.i),-1!==this.i&&(this.i+=2,this.start=this.i),this.state=this.endTag):this.state=this.text,!0)},je.prototype.text=function(){if(this.i=this.content.indexOf("<",this.i),-1===this.i)return void(this.start<this.content.length&&this.handler.onText(this.content.substring(this.start,this.content.length)));const e=this.content[this.i+1];if(e>="a"&&e<="z"||e>="A"&&e<="Z")this.start!==this.i&&this.handler.onText(this.content.substring(this.start,this.i)),this.start=++this.i,this.state=this.tagName;else if("/"===e||"!"===e||"?"===e){this.start!==this.i&&this.handler.onText(this.content.substring(this.start,this.i));const t=this.content[this.i+2];if("/"===e&&(t>="a"&&t<="z"||t>="A"&&t<="Z"))return this.i+=2,this.start=this.i,void(this.state=this.endTag);let s="--\x3e";"!"===e&&"-"===this.content[this.i+2]&&"-"===this.content[this.i+3]||(s=">"),this.i=this.content.indexOf(s,this.i),-1!==this.i&&(this.i+=s.length,this.start=this.i)}else this.i++},je.prototype.tagName=function(){if(Je[this.content[this.i]]){for(this.handler.onTagName(this.content.substring(this.start,this.i));Je[this.content[++this.i]];);this.i<this.content.length&&!this.checkClose()&&(this.start=this.i,this.state=this.attrName)}else this.checkClose("onTagName")||this.i++},je.prototype.attrName=function(){let e=this.content[this.i];if(Je[e]||"="===e){this.handler.onAttrName(this.content.substring(this.start,this.i));let t="="===e;const s=this.content.length;for(;++this.i<s;)if(e=this.content[this.i],!Je[e]){if(this.checkClose())return;if(t)return this.start=this.i,void(this.state=this.attrVal);if("="!==this.content[this.i])return this.start=this.i,void(this.state=this.attrName);t=!0}}else this.checkClose("onAttrName")||this.i++},je.prototype.attrVal=function(){const e=this.content[this.i],t=this.content.length;if('"'===e||"'"===e){if(this.start=++this.i,this.i=this.content.indexOf(e,this.i),-1===this.i)return;this.handler.onAttrVal(this.content.substring(this.start,this.i))}else for(;this.i<t;this.i++){if(Je[this.content[this.i]]){this.handler.onAttrVal(this.content.substring(this.start,this.i));break}if(this.checkClose("onAttrVal"))return}for(;Je[this.content[++this.i]];);this.i<t&&!this.checkClose()&&(this.start=this.i,this.state=this.attrName)},je.prototype.endTag=function(){const e=this.content[this.i];if(Je[e]||">"===e||"/"===e){if(this.handler.onCloseTag(this.content.substring(this.start,this.i)),">"!==e&&(this.i=this.content.indexOf(">",this.i),-1===this.i))return;this.start=++this.i,this.state=this.text}else this.i++};const qe=[];const Pe=ve({name:"mp-html",data:()=>({nodes:[]}),props:{containerStyle:{type:String,default:""},content:{type:String,default:""},copyLink:{type:[Boolean,String],default:!0},domain:String,errorImg:{type:String,default:""},lazyLoad:{type:[Boolean,String],default:!1},loadingImg:{type:String,default:""},pauseVideo:{type:[Boolean,String],default:!0},previewImg:{type:[Boolean,String],default:!0},scrollTable:[Boolean,String],selectable:[Boolean,String],setTitle:{type:[Boolean,String],default:!0},showImgMenu:{type:[Boolean,String],default:!0},tagStyle:Object,useAnchor:[Boolean,Number]},emits:["load","ready","imgtap","linktap","play","error"],components:{node:De},watch:{content(e){this.setContent(e)}},created(){this.plugins=[];for(let e=qe.length;e--;)this.plugins.push(new qe[e](this))},mounted(){this.content&&!this.nodes.length&&this.setContent(this.content)},beforeDestroy(){this._hook("onDetached")},methods:{in(e,t,s){e&&t&&s&&(this._in={page:e,selector:t,scrollTop:s})},navigateTo(e,t){return new Promise(((s,a)=>{if(!this.useAnchor)return void a(Error("Anchor is disabled"));t=t||parseInt(this.useAnchor)||0;const i=j().in(this._in?this._in.page:this).select((this._in?this._in.selector:"._root")+(e?` #${e}`:"")).boundingClientRect();this._in?i.select(this._in.selector).scrollOffset().select(this._in.selector).boundingClientRect():i.selectViewport().scrollOffset(),i.exec((e=>{if(!e[0])return void a(Error("Label not found"));const i=e[1].scrollTop+e[0].top-(e[2]?e[2].top:0)+t;this._in?this._in.page[this._in.scrollTop]=i:q({scrollTop:i,duration:300}),s()}))}))},getText(e){let t="";return function e(s){for(let a=0;a<s.length;a++){const i=s[a];if("text"===i.type)t+=i.text.replace(/&amp;/g,"&");else if("br"===i.name)t+="\n";else{const s="p"===i.name||"div"===i.name||"tr"===i.name||"li"===i.name||"h"===i.name[0]&&i.name[1]>"0"&&i.name[1]<"7";s&&t&&"\n"!==t[t.length-1]&&(t+="\n"),i.children&&e(i.children),s&&"\n"!==t[t.length-1]?t+="\n":"td"!==i.name&&"th"!==i.name||(t+="\t")}}}(e||this.nodes),t},getRect(){return new Promise(((e,t)=>{j().in(this).select("#_root").boundingClientRect().exec((s=>s[0]?e(s[0]):t(Error("Root label not found"))))}))},pauseMedia(){for(let e=(this._videos||[]).length;e--;)this._videos[e].pause()},setPlaybackRate(e){this.playbackRate=e;for(let t=(this._videos||[]).length;t--;)this._videos[t].playbackRate(e)},setContent(e,t){t&&this.imgList||(this.imgList=[]);const s=new Be(this).parse(e);if(this.$set(this,"nodes",t?(this.nodes||[]).concat(s):s),this._videos=[],this.$nextTick((()=>{this._hook("onLoad"),this.$emit("load")})),this.lazyLoad||this.imgList._unloadimgs<this.imgList.length/2){let e=0;const t=s=>{s&&s.height||(s={}),s.height===e?this.$emit("ready",s):(e=s.height,setTimeout((()=>{this.getRect().then(t).catch(t)}),350))};this.getRect().then(t).catch(t)}else this.imgList._unloadimgs||this.getRect().then((e=>{this.$emit("ready",e)})).catch((()=>{this.$emit("ready",{})}))},_hook(e){for(let t=qe.length;t--;)this.plugins[t][e]&&this.plugins[t][e]()}}},[["render",function(e,t,s,a,i,l){const n=b("node"),o=L;return k(),x(o,{id:"_root",class:S((s.selectable?"_select ":"")+"_root"),style:O(s.containerStyle)},{default:w((()=>[i.nodes[0]?(k(),x(n,{key:1,childs:i.nodes,opts:[s.lazyLoad,s.loadingImg,s.errorImg,s.showImgMenu,s.selectable],name:"span"},null,8,["childs","opts"])):P(e.$slots,"default",{key:0},void 0,!0)])),_:3},8,["class","style"])}],["__scopeId","data-v-dc899c23"]]),Ye=ve(Y({__name:"CommentItem",props:{data:{},isReply:{type:Boolean}},emits:["react","reply","edit","delete"],setup(e,{emit:t}){const i=e;s();const l=a((()=>!0===i.data.isMe)),n={p:"font-size: 14px; line-height: 1.5; color: var(--text-primary); margin: 0; margin-bottom: 2px;",div:"font-size: 14px; line-height: 1.5; color: var(--text-primary);",span:"font-size: 14px; line-height: 1.5; color: var(--text-primary);",a:"color: #007aff; text-decoration: none; font-size: 14px;",img:"max-width: 100%; border-radius: 6px; margin-top: 4px;"},o=e=>{const t=e.href||e["data-src"]||e.src;t&&(console.log("Má»Ÿ link:",t),X(t))},r=a((()=>{const e=i.data.message||"";if("UPDATE_TODO"===i.data.type&&e.includes("->")){const t=e.lastIndexOf("->");if(-1!==t){const s=e.substring(0,t).trim(),a=e.substring(t+2).trim(),i=s.match(/^<p>(- .*?:)/)||s.match(/^(- .*?:)/);let l="",n=s;return i&&(l=i[1].replace(/<p>|:$/g,"").trim()+":",n=s.replace(i[0],"").trim(),n.startsWith("</p>")&&(n=n.substring(4))),{isUpdate:!0,label:l,oldRaw:n,newRaw:a}}}return{isUpdate:!1}}));return(e,t)=>{const s=J,a=L,i=U;return k(),x(a,{class:"comment-thread"},{default:w((()=>[N(a,{class:"flex gap-3 mb-4 items-start"},{default:w((()=>[N(Ae,{name:e.data.senderName,"avatar-color":e.data.senderAvatarColor,size:e.isReply?30:40,class:S(["shrink-0",e.isReply?"mr-2":"mr-3"])},null,8,["name","avatar-color","size","class"]),N(a,{class:"flex-1 overflow-hidden"},{default:w((()=>[N(a,{class:"comment-bubble rounded-2xl p-3 rounded-tl-none relative"},{default:w((()=>[N(a,{class:"flex flex-col items-start mb-2"},{default:w((()=>[N(a,{class:"flex flex-wrap items-center gap-1"},{default:w((()=>[N(s,{class:"font-bold text-sm sender-name"},{default:w((()=>[R(E(e.data.senderName),1)])),_:1}),e.data.actionText?(k(),x(s,{key:0,class:"text-xs action-text font-normal"},{default:w((()=>[R(E(e.data.actionText),1)])),_:1})):T("",!0)])),_:1}),N(a,{class:"flex items-center mt-1"},{default:w((()=>[N(s,{class:"text-xs time-text"},{default:w((()=>[R(E(e.data.timeDisplay),1)])),_:1}),e.data.isEdited?(k(),x(s,{key:0,class:"text-xs time-text italic ml-1"},{default:w((()=>[R(" â€¢ ÄÃ£ sá»­a ")])),_:1})):T("",!0)])),_:1})])),_:1}),r.value.isUpdate?(k(),x(a,{key:0,class:"content-body"},{default:w((()=>[N(s,{class:"font-bold text-sm log-label block mb-1"},{default:w((()=>[R(E(r.value.label),1)])),_:1}),N(a,{class:"change-flow"},{default:w((()=>[N(a,{class:"part-container"},{default:w((()=>[N(Pe,{content:r.value.oldRaw,"copy-link":!1,"tag-style":n,"container-style":"font-size: 14px; color: var(--text-primary); line-height: 1.5;",onLinktap:o},null,8,["content"])])),_:1}),N(a,{class:"arrow-container"},{default:w((()=>[N(s,{class:"arrow-text"},{default:w((()=>[R("â†’")])),_:1})])),_:1}),N(a,{class:"part-container"},{default:w((()=>[N(Pe,{content:r.value.newRaw,"copy-link":!1,"tag-style":n,"container-style":"font-size: 14px; color: var(--text-primary); line-height: 1.5;",onLinktap:o},null,8,["content"])])),_:1})])),_:1})])),_:1})):(k(),x(a,{key:1,class:"content-body"},{default:w((()=>[N(Pe,{content:e.data.message,"copy-link":!1,"tag-style":n,"container-style":"font-size: 14px; color: var(--text-primary); line-height: 1.5;",onLinktap:o},null,8,["content"]),e.data.files?(k(),x(a,{key:0,class:"mt-2"},{default:w((()=>[N(i,{src:e.data.files,mode:"widthFix",class:"comment-attachment-img",onClick:t[0]||(t[0]=D((t=>{var s;(s=e.data.files)&&y({urls:[s],current:0})}),["stop"]))},null,8,["src"])])),_:1})):T("",!0)])),_:1}))])),_:1}),N(a,{class:"c-footer-actions"},{default:w((()=>[N(a,{class:"reaction-row"},{default:w((()=>[e.data.reactions&&e.data.reactions.length>0?(k(),x(a,{key:0,class:"flex gap-1 mt-1"},{default:w((()=>[(k(!0),C(I,null,_(e.data.reactions,((e,t)=>(k(),x(a,{key:t,class:"emoji-tag"},{default:w((()=>[R(E(e.codeEmoji),1)])),_:2},1024)))),128))])),_:1})):T("",!0)])),_:1}),"COMMENT"===e.data.type?(k(),x(a,{key:0,class:"action-buttons-container"},{default:w((()=>[N(a,{class:"btn-icon-action",onClick:t[1]||(t[1]=t=>e.$emit("react",e.data))},{default:w((()=>[N(i,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE6klEQVR4nO1aOYwcRRQtboTNchkISDgiDnGkkHIZa8GQgE1qtE68XjmCwF4yzBU0M3T9V72rkSacjMO7IrGxbIM5bCBhbdZAAMthbDIWIyMNetO/pBY708d0zyHLX2qpd7vqV/2q+r/ef3+MuSgXqARBMCEikyLyuoi8B2AJwO8AVvXh+xK/aZvJubm5a804SBAEVwF4AcAigPMA2gWf8yKyICLPt1qtK4duQKPRuBrATgA/JyZ1DsB+ALsBbI6i6O4wDG8AcAUfvvN//AZgD4AD2qfTX0R+AjBN3UMxwjn3hIgsJwz4AsA2ANcV1dVoNK53zr0kIl8m9H0H4PGB7oKIvJsY8FiVA4rIkyLyVWKHajy6pkqJouhWXXkO8peI7Gi1WpdVOogxhjr1yK7qWJ+FYXhLJcqttbcnjtJSGIb3mQFLFEX3i8hJf9Q4h1IK5+fnb/YKReRzABvMkCSMA8VhNeYUT0WZyOSP0yfNZnOdGbI0m811AI76Y9aXzwAI/XGKouhGMyKp1Wo3JU5FrVBnABu9Yw/DJ/L4DDQAMPwXOVKndAV2mDEREZnROS3nujRFZJe/JwYRYvuV2dnZywF8rcbM5MFOHdhhrX3MjJlYa5/SRf4ldVeccy962GHGUNrt9iWKKDjHrT0bAvhIG20zYyoApnSOiz0vIBH5VxFpJgAk7GZewW0WkRUAe4tA8X77h/E8/2EKQNDZzdLNaun+PBPhwF3yi715DSnTX0Q+1vZPd1P8ln7cnVPZyv8nwv/lNaRMfwCvavs3uyle6Gllzokw4pUxBDn7O+eeVUM+WPNRE5o2s7gSR+O1vIaU6e+cu1cNOdlN8Rl+JLbJo4yOyclwZft19n77A9ighv+x5qNGgvZISICCEsQXd4cnuKANOas+MjLIXiThUx85XdrZRylOnR3AiTUfAexTsPiMGXMRkefUkPfTLsQ9KQqOaMo5MahJBkEwoSn24awLEcAbaRDlQIoCjzwXBxEUgtiJPXA9ljKPg+ojk6mgsSsYixXcxdjttxXANVUZQV0APvROHIbhnd3aMRh50NjzZPjVII3Za8AwDB/yEY7HzFp7W1kjqEPppjYvZmvtA73aish2NXYhM7EiF5sx8D0AftS2Z621W/o1Qsf8U3X9kBY1NbE6rkFpSxa/u5KHrVAadTGBXBkIHs1rAFNpEfk0gbP2ZdGjADZ55j6T40qQD8ezyAddoamE33RYQUZALgR3jsUcPnwnUQ3gbQDfJxbgNDNS6jIZ5IOIfKP9pgvRQSSUMzsYYzhRAK+IyG8Fijy/Ani5Xq+vzzOG6AIT8eZmHBME3SrJsVyd4lW71Fr7COM7gENqGFPnc/p+SNPbh9k2r17n3IMi8rfOqVgpw9dCuAJ5of0gZD4m0n014J2yJPbRUZDY9Xp9PUN8KRI7gTJP+LIC/zZDkii++I6ULit4cc7d4beWxyztsqpKXOwTy5UVenqU3lbJvTIcmoplNg6xuxKOXV3pLaUYSkJ5YxW69T7alLgnOo5deTG0S/U1WZ4mIp4i6OzTD7Z72IFhlKe77M5M8gcDikgPisgseSdmcQzbhPt8+M6iEZMittG2HZ7Aww4A0wPdhYz8YSsxl6YAhX/CQYxFADgSA7oJiW8mOrzVyQDqj2rOcNV15fn+reYxbDM5yEzzopgRy39FfuuU+t1BWQAAAABJRU5ErkJggg==",class:"icon-action"})])),_:1}),N(a,{class:"btn-icon-action",onClick:t[2]||(t[2]=t=>e.$emit("reply",e.data))},{default:w((()=>[N(i,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAENElEQVR4nO1a+YtcRRAur6jxSIyIKKh4GxUVFAVREQT/ACNeMfqT4IFEUbxx0N9EVhx39/X3db/16UpQn6ImKMEjkmAMChITzZoYLxTUEEN+UWOMmJXaqcHHHJvZnZ2ZHtgPHixT/aqrXldXV3+1IrOYxSy6ApInArgewNMk3wSwkeR3JHfYo39vAPCGjvHeXzc8PHyCxIAQwmkknwSwieR4k+d3e5rJvwDwBMlTu+6A9/5ykitJ/lswaAPJ57z3iwFcFEJY0MDxBSoDcDOAQVu16vuq6x2Sl3bcAf1qNtnE5AC+J/mw9/7k6epMkuQUAI+Q/KHg1Ip2dDbF+Pj4fgDuIfmnOfC17odSqbT/TM2hupxzN5LcanP8AeDumdIvQ0NDh5N8zZT/pStQKpUOlA6B5EEkHyW521bnldHR0cPaUqoxTfITU7g1SZJzZ8zifc99HoBvbO51WZbNn5aiNE2PILneVmI1yXnSZWRZNp/kGrPhM42OKSnI8/wAy0r6Nd4bGBg4VHoEknMBrDJb3lbbWn4ZwGP2FTaWy+UjpccgOY/kl+bMQy295Jw7n+QePcScc6dLJEiS5EzNmgD+bmmvkvzAPL9TIgPJpWbbu5MOdM5daQPHOpli20zNmy3sr2g6UAs6HaRlhkQK59wt5sirk6W6PQC253k+RyJFuVw+WKtp3SsNE5GW1RZWz0vkIPmC2uqcu7ZOCOBZc+QGiRwkb7LweqZOWD10QggLJXJ4788xR96vE2pFq8KY90cVWZYdYtGzRWoBYBvJXdInQKUS/7VOoD9q6Sx9AlbK/F8aCcZsueZKn4fWKhVqTSN9vtmfMi+XSOTw3i+eLP1eY46kEjlIvmi2LqoT6r1YL/wkd2oZIHHvjx262fUW23AQyWWxF40kb7WwernpoBDChQD26uEYcRm/xcLqsn0NfssGLpXIQPJes21lq8yf7pVdJM+SSBBCWGg27db029JLAO6yONyUJMlR0mNklbtS9cB+YEoUaTXFGafVs9N+tJJNV5sty6dM02oVXOCT1g0ODh4tvVmJj8yGT6dNnSoxp6RYlTLVloB0Cd77C0h+a3OvbZvp1JQHYNgU6p3+Qekg8jyfQ/LxAom9rG0Suwij/DVOt0sHoOcWySXWopvodAG4vVNNnolYnen2nVG0P9mH2qs9yDRNT5JOVpwkk0Zy7TppO817f5tz7uIQwrG1NdvIyMgxKlNuysJ1rKb1toLkJdJJFFpuV9eGRIGBqXv0SmoHbDP55wBKHWm11YLkcST/Ifljkdb33p9B8kMzaJu24/TAIvkSgI8BfGVX6N8s9tcDeN3uPovSND1eugn8/8XvqIYIyQFl++z3zTGVMw3hnDtbDbbwuE+LyoIDE+V003tBLMgrnau1TeJ7DYCrpB/ASj9iJ4Cf7T8UlpO8vx/YyFlIj/EfWzn/4zKL2Z4AAAAASUVORK5CYII=",class:"icon-action"})])),_:1}),l.value?(k(),C(I,{key:0},[N(a,{class:"btn-icon-action",onClick:t[3]||(t[3]=t=>e.$emit("edit",e.data))},{default:w((()=>[N(i,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDUlEQVR4nO3Zv24TMRwHcFNoF0DiBeiAChRYeQhWBtSt8A59gGMqI0JKzt+vHSlSxlu6MSGQ2vIMdOlEC50YUFcIMvJJp1OSS+7OfyL5J1mKzrHjT/zLT+eLEClSrBxZlt0CkJH8BuA3yVMAL8Q6BclNkkckp7X2Z60wSqk3MxD/G4CvIvaYTqc3ytck38+BXIuYYzKZ3Cb5CcBeeY3kuxmYMxFrDAaDOyRP7ELPi6LYWrAzByJ2BIDvWuud+nsqmKOiKG6KyHfioo6o7cxrU81mTmQqwLzq4LC9XQahtd4xaaaUetn4jcSCkFI+rCNMmtn+z9VqthAi/FenL/azf2qtn1T7DcrgbP/paDS62zipb4gThG+IM4RPiFOEL4hzhA9IFQHgygnCNaSOkFI+XQZBW6KjgHRBsM16XEDaIjqtp29IF0Q0kCaEUupR0w+boSHLIABcNlUnhoT0hQgK6RMRDNI3IgjEBcI7xBxyABzbsT9I7tbm3LXXTf+JOUS5XE/rgXmeP7A78RfA874Q3iEkX5XjzJm/TJs8zx+3SadgEACH1XO4wZid6YoIAflYf6hg0qxtOoWEXM15QtIJ4RVCctuO+WVSiOQHKeW+UupZlmUbKy+g43paDxyPx/eGw+F94SgY+qaxr2CCMEGcBBOECeIkmCBMkDghjKyJFpDyf7xoGoDjlSEpRBzxD8CDuZ8WmeYsAAAAAElFTkSuQmCC",class:"icon-action"})])),_:1}),N(a,{class:"btn-icon-action",onClick:t[4]||(t[4]=t=>e.$emit("delete",e.data.id))},{default:w((()=>[N(i,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAADjklEQVR4nM1ZW4hNURhehCjiwSiXeCDKJXJ7cHkwilxeXB6McolQPKBcIhwe3DJT1LHX/6+zj51LZHJ5oVwiDJHrELm+UGZGLvE0D4Ojle/U7DF7xpz9r935ar/8/zrfZf/7rL3bWykhVFZWdiKi/cxcw8y5lg4i+sjMe+1vVLGBmfe1FqCZQHtUsYH+nmVrcEJra7XWE/OTUcUGxll2tT4xFG2QXC7Xjpmr23rdOzyqCgqSSqXaM/PjIgiQw//pVuzpMPM7EA5UCSGTyQxCgLdipER05393JClo7GzMfFuMlJnPW1JjzByVEIhoLiZyTpKUcHZWRa1h5pvM/CBuPQ+rhSCkpEBEuxBkR1u307bW8yCiFNbsVFIgojU4O4eTCsLMHtasVlLQWs9HkDMJBjmLNfOUFIwxk1vbyx0EqcKaSUoKnucNQZDXCQZ5g51ysJJCEAQ9IPw9wSA/sKa7kgQR1VviIAg6uw4SBEFnXAH1QvZDwh8g3t91EN/3B6D/Xsh+SPgByMe5DqK1Ho+J3BeyHxK+CPFZroMYY2ajf0HIfkj4CMiXJTCR5ZhIVsh+SHgvxLe4DkJEW529nGDm9SA/6DoIMx+C1joh+yHyhRA/mcBETtme1rpMyH6IfCrO0rUEJnIdd/VSIfsh8hEI8jyBIC9sz/O84Uoanuf1gvjnBIJ8sb1sNluipIG3Kg1E9JuZO8Y1HFVPpVIdmPkXEf20msoFiKgOBnrHNRxV932/D3q1wvZD4s+wm4yMaziqbowZhf/iU+UKRHQVBqY5DDIdvSvKFYjoBEQWxTUcVddaL0bvuLD9kHgFRDbENRxVJ6KN6JUL2w+JbMb1eyCu4Rbq5ehtUq5gjFkKkaMOJ3IMvSXKFbTWMzGRS3ENt1C/jN4M5QqZTGYMgjwRMBxVr0ZvtHIFY0w/iNQIGI6q1+Je1Ve5Aj5B20eUhqaPDxJBUo0eg5x/umbmbzDRs1DDUfVsNluCS/erI/shA68w+qGFGo6qG2OGof7Skf1/vmtYsSmFGo6qG2NKMZEbjuyHDFTCxIJCDUfVtdZlCHLakf2QgTRMrG1Sr2rubX1b6sy8FtxpR/ZDYtshtluam4j2YCLbpLmbE1uJIL4D7qzlNsasUK7R6DHlYUVFRRcpXsvFzI+cP57k4ft+N2b+lP+zSh9EVJdOp7s6D2Jh38gz8z17FxYMYe/od4lobCGm/gAfYnDjhrpJZwAAAABJRU5ErkJggg==",class:"icon-action"})])),_:1})],64)):T("",!0)])),_:1})):T("",!0)])),_:1})])),_:1})])),_:1}),e.data.children&&e.data.children.length>0?(k(),x(a,{key:0,class:"pl-12 mt-2 replies-wrapper"},{default:w((()=>[(k(!0),C(I,null,_(e.data.children,(s=>(k(),x(Ye,{key:s.id,data:s,"is-reply":!0,onReact:t[5]||(t[5]=t=>e.$emit("react",t)),onReply:t[6]||(t[6]=t=>e.$emit("reply",t)),onEdit:t[7]||(t[7]=t=>e.$emit("edit",t)),onDelete:t[8]||(t[8]=t=>e.$emit("delete",t))},null,8,["data"])))),128))])),_:1})):T("",!0)])),_:1})}}}),[["__scopeId","data-v-a9dd0813"]]),Qe=ve(Y({__name:"todo_detail",setup(e){const t=s(),l=a((()=>t.isDark)),{isLoading:n,isLoadingCustomer:o,isLoadingHistory:r,historyList:c,form:d,statusOptions:u,sourceOptions:h,assigneeOptions:m,onStatusChange:p,onSourceChange:g,onAssigneeChange:f,saveTodo:y,historyFilterOptions:v,historyFilterIndex:A,onHistoryFilterChange:b,comments:O,isLoadingComments:M,newCommentText:z,isSubmittingComment:B,submitComment:P,isConfirmDeleteCommentOpen:Y,onRequestDeleteComment:Z,confirmDeleteComment:X,cancelDeleteComment:te,currentUserId:se,isEditingComment:ae,onRequestEditComment:ie,submitUpdateComment:le,onCancelEditComment:ne,isConfirmCancelEditOpen:oe,continueEditing:re,confirmCancelEdit:ce,editingMemberName:de,isEmojiPickerOpen:ue,emojiList:he,onToggleEmojiPicker:me,closeEmojiPicker:pe,selectEmoji:ge,isReplying:fe,replyingMemberName:ye,replyingCommentData:ve,onRequestReply:Ae,onCancelReply:Ce,submitReply:_e,isConfirmCancelReplyOpen:Oe,continueReplying:Te,confirmCancelReply:Se,commentFilterIndex:De,commentFilterOptions:Re,onCommentFilterChange:Ee,isSavingDescription:Ne,onSaveDescription:Ue,onDateUpdate:Je,isStatusDisabled:Le,onSaveTitle:Me,replyingMessagePreview:Ve,isHistoryOpen:ze,toggleHistory:Be,goBack:je,isDone:qe}=Ie(),Pe=i(!1);i("");const Qe=()=>{Pe.value=!Pe.value},Fe=i(null),Ke=()=>{Pe.value||(Pe.value=!0),setTimeout((()=>{j().select("#comment-input-anchor").boundingClientRect((e=>{e&&j().selectViewport().scrollOffset((t=>{if(t){let s=t.scrollTop+e.top-100;q({scrollTop:s,duration:300})}})).exec()})).exec()}),150)};return(e,t)=>{const s=L,a=U,i=J,g=K,y=V;return k(),x(s,{class:S(["container",{"theme-dark":l.value}])},{default:w((()=>[Q(n)?(k(),x(s,{key:0,class:"loading-bar"})):T("",!0),N(s,{class:"custom-header"},{default:w((()=>[N(s,{onClick:Q(je),class:"back-btn"},{default:w((()=>[N(a,{src:H,class:"back-icon"})])),_:1},8,["onClick"]),N(i,{class:"header-title"},{default:w((()=>[R(E(e.$t("todo.todo_detail_title")),1)])),_:1}),N(s,{class:"header-right"})])),_:1}),N(s,{class:"detail-header-content"},{default:w((()=>[N(s,{class:"header-top"},{default:w((()=>[N(i,{class:"header-code"},{default:w((()=>[R("#"+E(Q(d).code||"..."),1)])),_:1})])),_:1}),N(g,{class:"header-title-input",modelValue:Q(d).title,"onUpdate:modelValue":t[0]||(t[0]=e=>Q(d).title=e),placeholder:e.$t("todo.header_loading"),"auto-height":"",maxlength:"256","confirm-type":"done",disabled:Q(qe),onConfirm:Q(Me),onBlur:Q(Me),"placeholder-class":"input-placeholder"},null,8,["modelValue","placeholder","disabled","onConfirm","onBlur"])])),_:1}),N(s,{class:"detail-body"},{default:w((()=>[N(s,{class:"section-title"},{default:w((()=>[R(E(e.$t("todo.desc_section")),1)])),_:1}),N(s,{class:"section-block"},{default:w((()=>[N(G,{modelValue:Q(d).desc,"onUpdate:modelValue":t[1]||(t[1]=e=>Q(d).desc=e),placeholder:e.$t("todo.desc_placeholder"),"read-only":Q(qe)},null,8,["modelValue","placeholder","read-only"]),Q(qe)?T("",!0):(k(),x(s,{key:0,class:"input-actions",style:{"margin-top":"10px"}},{default:w((()=>[N(be,{type:"primary",size:"small",loading:Q(Ne),label:Q(Ne)?e.$t("common.saving"):e.$t("common.save"),onClick:Q(Ue)},null,8,["loading","label","onClick"])])),_:1}))])),_:1}),N(s,{class:"section-title"},{default:w((()=>[R(E(e.$t("todo.info_section")),1)])),_:1}),N(s,{class:S(["info-group",{"disabled-group":Q(qe)}])},{default:w((()=>[N(s,{class:"flat-item"},{default:w((()=>[N(s,{class:"item-left"},{default:w((()=>[N(a,{src:$,class:"item-icon"}),N(i,{class:"item-label"},{default:w((()=>[R(E(e.$t("todo.status")),1)])),_:1})])),_:1}),N(s,{class:"item-picker-box"},{default:w((()=>[N(ke,{range:Q(u),value:Q(d).statusIndex,onChange:Q(p),title:e.$t("todo.status")},{default:w((()=>[N(s,{class:S(["picker-text",{"disabled-text":Q(Le)}])},{default:w((()=>[R(E(Q(u)[Q(d).statusIndex]||e.$t("common.loading"))+" ",1),Q(Le)?T("",!0):(k(),x(i,{key:0},{default:w((()=>[R("â–¾")])),_:1}))])),_:1},8,["class"])])),_:1},8,["range","value","onChange","title"])])),_:1})])),_:1}),N(s,{class:"flat-item"},{default:w((()=>[N(s,{class:"item-left"},{default:w((()=>[N(a,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFeElEQVR4nO1aa2hcRRS+qe+iouATFLT4Q8SCVsXoL1HRiMVXXasiLMnO983exaWNgo8qLko0ahWV4gsEEeqDYG1N8FGF/vCHUnyDtgqKRU2rVGs0+EhsUznZMzq9vffu3WRvsi0ODGTnnDkz353zmHMmQfB/2wtbpVI5GMAlAO4nOQTgCwDbSI5L1783Ahgk2U+yS+YEbdI6ZPMkBwD8RXJnk/1PAC8JKJE1KwistVeT/DRhg9+RvIfkOd7YAgC3k9wUNwfAJ8aYK2cMQKlUOonk294mfiA5on9vJ/mArzKOz/2uVqsHkKwpr9C2AtjiyXszDMN5uYIgeT3J37wNLNEvL7/H5JRi5uwCxBvvIvm7nsYtJKsik/Xfv5JcnAeGDpJ9nhqsKZVKR5O8AMAO6caYhQngY4E4MAD+lm6M6VSZq73TubvVIB53qgPgRhmsVquHqi3IeF/S5DQgSr9Veb4qFosHypis4aneipagcCcB4A/fGNXNykLv1Wq1facKpFarzQHwrq5xhzfvClmzJSejNiEL7LDWXu6NHyuuU2nnNpCRCkRauVw+neSE2F8Yhoe7cVlT1pb5xphrpuOdnGHf5NMA3KvjQ43kZAGifC8r752RtXp1fGRK3ozk61MIcHn3tVMJdjvbsVtPxbN4KRexl8ac1LNKW5bxZDOplvIuU/6nYmhVpX2c6TqjdyeZMOzcYQTkZqGXy+VTcwAyX/k3RWmyFwDfq+FfnEXYQNQVerSTlbYly8aaBSINwI/CH2fYsieV92KqkJ6enkPUrU5Ya0+I2dQNKmh1jkDW6JzdriiyJ9mbxpe5DdUKwPqETS2Pc5EtBnKXzulPoK9X+kVpQly0Xp6wqVeSvlYLgVyrcwYS5D2k9PvSFh1SY4rNCwB8pCd2Vl5ASJ6ta7yfsIdFKvPVNCFfKpDTEuiTSZEx5sS8gIRhOE+BfJMgb4HK3JgoBMBPynREgpBfhF4sFg/LC0ilnvuPylpx9O7u7iNV5ta0RcdmMkon7cMY00ny57S5UiNoeyBecJwMvgl9LGhH1SK5juQHkiKk8WkWKSeyLZFJalGzZeyeynydJt8ZO4DP04AMqsCrZtr9RtRm2Fp7SgJfQfcwmCasPy0gAliVV0D0QKzTjYqanxmzh4eV77Y0YV2zdUVxfMX6LXfQlYWstedFgDyt6t2Z6sNn69Lo85Hcj+TzXtHj31JToVDYH8AzwpMqUGuxsV89z2t8lK9Wq80h+YSOj1trr8u65i7qJQbX29t7UFJiJX4+TyBRu9VCoA2aaSQ/bJTqxiVeeQDxingTylMLsja5/c50ZG8EGIB1Na6kXCVp4mvtBMTLVcZVI54UOwqyXKe1Ki4L3DwDBbpMfMaYhV4pdWVD76XCFztD85OtSqVyTCtLps3wSZPY4qqgEnNiqj27Nykge89ki1pdxM7CV6nnKG/JPczrTlsyaYZbZIXnApe08lkhC1+pXod2Xiuuf5YJSORkJo9T1MsYc/50HnqS+AqFwj56p3rUo69VnsfEfv0u0T5opklp3x2pXuqWegAlKStkBULy0ji+Qh3EC+63fCyhA7hQxzbLO2Qw3abe7I2kx1AAD6Y9hoph6rvj9jgg+A/EpCrJWtE0wlpbClrV9BFmUnC0a422Tzya92XPkNsAgG/T4gjrfUT/+WBUAc33H55IbsgUQ5poHVJQllqs59unFRBJjrgrutiIfpjn5Ld4R5elArislUD8jcyVMqZUALV+u0ErIWMCUk9JnitWyz8OON335g+L/Rkvz5BUQl58JZqHYXh8JPl7J2jHJl6wXC4fFR338pJVEkt89Q32pFauP5T69jcK4BFjzHHBntZIrpQTEJX0X3332vYPcl0YezzF/FYAAAAASUVORK5CYII=",class:"item-icon"}),N(i,{class:"item-label"},{default:w((()=>[R(E(e.$t("todo.source")),1)])),_:1})])),_:1}),N(s,{class:"item-picker-box"},{default:w((()=>[N(s,{class:"picker-text disabled-text"},{default:w((()=>[R(E(Q(h)[Q(d).sourceIndex]||"..."),1)])),_:1})])),_:1})])),_:1}),N(s,{class:"flat-item"},{default:w((()=>[N(s,{class:"item-left"},{default:w((()=>[N(a,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAADw0lEQVR4nO2ZXYhVVRTH12RmFlkpIhL1YPZpkWCgJPQQhIZvwVGxscvcs///fU/TNUeCcF6uEuiTfTxUihA+yuQnveQXmILYQ9CHImY9iCkx6KiRkZYpy1mHzkMz595zx9knmh/sp7vXumvtvc/aa60tMsYY/y3iOJ7pnHuN5FqSH5J8j2Svc+6lRqNxp5SZKIrGAaiSPEbyxjDjR5IvShkhOR3AkYyxZ0n2AXif5CobujMn9XcAv5P8CMALUhYqlcoDGQN/ILlIRDr+bW6j0bgDwIbsDgHYSvIeCQ3JLWbU1yTvz5uvznjvnya5kmS/ye6QkJB8hORfAP703j/XqnySJDMADJgzCyUUAN6w47G9DR1r0iMmoSC5U43w3sdFdcRx/JQ58pOEguRRNcI5N6/NsP0Hyb+DffQkT9n5frIdPQAuqx6NgBICkifUgFqt9kSbeq6onnq9PklCAOBL25HCN3Ucx5NNx28SCrvM9ENdWlQHybnmyHcja11rRvSaEeuL6gDwti3GJxIK59wCc+RAUR0kPzcdyyQUAF4xI34tkp5HUXQXyUumY5GEguRBM+KdoRLFHDoArLajtV9CkYbfInlWisqaI8clFAA+MyOqRXWQdLarfRIK7/3rZsRpLZ5albeC67QtxnIJheZJJLdpnqRphtYazcpakXU5zZ6jKBonoQHwjSWPs5qVIfms7eYJKQscrMfVqHUtyKw3mY1SFpxzc+yIDHR1dU1tMr+6YBFvvpQJALtshQ92d3dPGWpetVq9j+Qem7tPyob3/iGSv+QVWlq7mBN6oz8qZYSDnZRhHbEOyq1GnZQVAN/nOZLW6CTPSFmhlb61Wu2ZnBaSOtIvZSSO42la5amRSZI8PNQ8beJZo+GqOiVlgoOX27e20l80Mb8vvQxJPi+hcc7N0sqO5LVM73d6npyG50zXXjuVnzrnZstoogUUyVe1KrQjog5c1x5wK+0cu082m2za1D7snFtMcvxtc6BSqdwN4M00W7VxBcCm4T7uPCyKfZx+X7YwPwN4q6enZ+JI+tBhDzhnMw7osViRJMmDI/UnHAwC3ZlvTcc5rVcKVp//0NnZeS/J3RnFR0eja+69fzn7cKTpj9pSSFm9Xp9A8pApOk9yiYwyAJZnjtwhbVa0rITkB+kN7Jx7/LZY2nxoP2MLuqElYe/9Y/p4YxFlrgTGOTfPbLmmL8ZNCwJ411Zgr5QEkvvshKxtWgjAVyaUSEkgmaQBpxWhizlv5cEGgIGmnNBLKLSxzBl6ObexuWOM8b/jJtwwIqjk6mZBAAAAAElFTkSuQmCC",class:"item-icon"}),N(i,{class:"item-label"},{default:w((()=>[R(E(e.$t("todo.assignee")),1)])),_:1})])),_:1}),N(s,{class:"item-picker-box"},{default:w((()=>[N(ke,{range:Q(m),value:Q(d).assigneeIndex,onChange:Q(f),title:e.$t("todo.assignee")},{default:w((()=>[N(s,{class:"picker-text"},{default:w((()=>[R(E(Q(m).length>0&&Q(d).assigneeIndex>-1?Q(m)[Q(d).assigneeIndex]:e.$t("common.loading"))+" â–¾ ",1)])),_:1})])),_:1},8,["range","value","onChange","title"])])),_:1})])),_:1}),N(W,{dueDate:Q(d).dueDate,"onUpdate:dueDate":t[2]||(t[2]=e=>Q(d).dueDate=e),notifyAt:Q(d).notifyAt,"onUpdate:notifyAt":t[3]||(t[3]=e=>Q(d).notifyAt=e),onChange:Q(Je)},null,8,["dueDate","notifyAt","onChange"])])),_:1},8,["class"]),N(s,{class:"section-title"},{default:w((()=>[R(E(e.$t("todo.customer_section")),1)])),_:1}),N(s,{class:"info-group customer-block"},{default:w((()=>[Q(o)?(k(),x(s,{key:0,class:"loading-row"},{default:w((()=>[N(i,{class:"loading-text"},{default:w((()=>[R(E(e.$t("todo.loading_crm")),1)])),_:1})])),_:1})):Q(d).customerCode?(k(),x(s,{key:2},{default:w((()=>[N(s,{class:"flat-item"},{default:w((()=>[N(s,{class:"item-left"},{default:w((()=>[N(a,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF8ElEQVR4nO1a2W9UVRi/FXEl4q644YLGFdT4J2gUk4oY50GsqZ17fr87M81Iiw8+mDAmhhjRl2qj8UWfjEZfgIpbDJHEiCJK9cEFUKMs0YB9MEFLodR8l+/osdy5c87ttC7hS24ymfut55xvPTeKjsH/FLq7u08HcBeA1SSHSH5Fci/J3/WR318CWKc4nSTnRv8GqNfrJxpj7if5NslDJCcCn0MA3iK5THhFMw3d3d0nkVxBcrdVCsAoyfdJNowxS40x1/X29p4luPLI70qlcj3JewQHwEaSBxz6XST7BHdGjACwmOQOZ1U/BZBUq9UzQnkJjdAC+Mzht90Yc/t078JzzgqK8DvaxL5DFgjAsGPQs20/bnEcn0dyixrwG4DlpVJpVluFRFHUaDSOB9CvwUGM2VypVM5tC/MkSS6V7VYjviZ5Qwv8KwGsBPAeyT3qO/s1ig2Uy+X5HjIXAdimMreJDu3YidQIkh+Jw+add5IvARhvEal+BfBAvV4/LU82ybMBfGyNKbwz6hPpcSK5qVarzckROk9X3Cr6ogaFq0meIo9GrCecMC3HZ0DeNeNbq9XmWGPkmBXyGQDP2+OUtxPiqBp20whG8pI8vsaYBzXvjCn/D/IU5JGdscdsMMiIJEnutI7t4RNL1Ii9LQz+G8gOae4Q2kfycI0xN9oA4B2a+/v7TwbwrQp4qBU+yZcVd4WvEQ5tp9L+0AoXR6JZ6i9eR4zkwzZP+IRYkr+oMldE4dChNdhEuVy+oFVoJvm56rbcx8F3+25hV1fXqdbBo4JAcoPwSJLktoAjvyt3V0h2qWJbfJSoVqsXK/7OQP1dmUPKo9OzAkjLmSRJ7muKBeBd3Q34KCGx3a5QiPJZMn3LHZIVxX8zL6FJWT0qvYUPU/EhTYBjslqBNljF0vwTx/FCH/w4js+UqhnAwcx+huTdaumGEEUA/KhbfWEUCOpjkk8OSLSM/GVubHocST6tx2RliDIA1qghS0LolPZWlflhIN1jSrf6qJck3yiiEIBVynRVCJ3SPq4rOxBCZ4xZqjLXZTFNy4A4jq/xZdhoNI6zTRaAR0OUcVdWeAivyBOk+7TlUxbTffIypMyQJKYMRwL0nyx3RI2Z50sj9Zcti7Jepv1zqVQ6wZeh4GqjNe4b6TJa3XGt6Wb70kkytHOCthgioFOQCfWxW3zpBNf6ZdOcUMQQe7QkTkcBUKlUbgLwsyr0pC+d4CrNT8IjRCbzjpZ1dmmGQpgq45t1hYYDaNICMNQIgSRJrm3q7EXDrxO9dirzxa3wtXu05XtwRcC/kvdQ2xKiQ9+nzL/Lc3x5JziK21dQViMvIRYqURz62c6w4OgtV9BJTNqDh0QqF5zWurMtRWOzsl5CajMcO2UR3CIy4lZF46SSmkWE6MRE6A/n4BxWnKbTkzyQEWvLkG0bK2lecrk1p59rRz05iowqTpErhQ5nTrysVau7J6TRcSGO4wW6EPua4Tj5akEo/8S31Z00fBiWht9XiDHmIplGKu2aHP5r7dBPaHz5N44MH77wGj5kjINahkeZe8ngTOulNPzmObIM8Gz41Tpt0Kc7ROg4yN1COetZQqRXl1UB8IlzzSDF36s+JY5GnlcmzYm3irK1Wu38DH0WBQ/oJo9MSX4jtY2d+ImyGvqsASOyqtIjBAnQvgLAM85sbEJTwOtS9jh11fZCI9OsIbYen3QFxRDpzpIkubcdlzFazcqV3Fq7SCpLLpY2TWmILdDT03OO7sifx4fka8aYq6JpgnK5PB/AC+6uSwcpVxxTYlytVi+3zg/ge9+xzVQgjuOFTj22wxhzWVsYiwPqlYEw3i9OOR1Xb6VSaZYMw50IuHnKO5HlM04ASLN/O29ftbTf6vAfnNa796zr6SRJ4iKFptAI7eTrabbvtrh10tQPBmw5I8+YXIDqiKdTxkpSUUvTJY/81s6uU3D0sjS9tdJHbgFm7oOBjBAtheY7U/mEQz4D+Uc+4cg5JnIN9xSA9dJAabI8qM+I/rdecAS3aN9zDKL/APwBbeoXgdqsneAAAAAASUVORK5CYII=",class:"item-icon"}),N(i,{class:"item-label"},{default:w((()=>[R(E(e.$t("todo.customer_name_label")),1)])),_:1})])),_:1}),N(s,{class:"item-right-text"},{default:w((()=>[R(E(Q(d).customerName),1)])),_:1})])),_:1}),N(s,{class:"flat-item"},{default:w((()=>[N(s,{class:"item-left"},{default:w((()=>[N(a,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEF0lEQVR4nO1aS4gcVRS94x9FI/5jjKKCK8GIC43iQhE3oiChFXSk7Op7TlXPpHUprnohWalElKgB3ehOxUmM+FmI4sLfQMaAiJ+FUVQEY2KiYvyO3PR9+Gi6Ot2hU/MG5kBtpu6rvrfq3nPPu29EVrCCpQOA2wDMAzhIchfJ9bKc0Gg0TiC5heRi37WvKIo1shxAchXJt9zx3wFsJHkWye3+t9ckdczMzJwH4GN3+DtVvarv3h67ByCXVNHpdE4DsNOD+DTP84v6bVT1br//M8kLJTV0Op0TSb7rTn4yOzt7ZpUtyblkUwzAJnfua1W9YJitpRjJn9w+k5QAYK87dsOI9vd4rdi61ZIK0OsTi1mWnT7qGpKvevBzkgpIfmlOlWV5+ahrLAW96C2YOyUF0AvYWGmcdaoKD+RzSQHoNT1z6Llx1nmjtHV/i8jU0fNwRJC8lOS/JA/keX7qqOtU9V4v+nlJBfxflpSj2GdZdhLJ3cnRsKreEfK92+0edzh7AA+6/UK32z1GUkGj0TjWpImnSjHMtizLcwDsd9ubJDUA2OBv+XuSJw+x2+p22yVRTAH40J18uKo2APziNiqpoizLK0n+CeAfVb1+kA3J+8JGS1UvllQB4KFQ+BUpNkVyh9t8NCwNU9jq7nJHtwyyMV0WkcM2IwtJEaq6zra6HkxzSCP90YPZmkR3HwQLIOzdSV5dYbM+FD+AzZIqADweKLlqgqKqN4avB+BRSREkjwfwtjv5XlVhk7zV2M7tNkmKaDabZwP4yp183chgkB3JRhTM5iRrRlUvI/mDp9kLVSzlXyaQxNNJsllRFFdYE/Q3/kzVG7eaiQhg26B0dG1nZLJgzRfAFyZcpS4AuJbkr4crbFW9JqLm+XhOZkIz6lP910utVuvcWoIheTPJP6JgBn6Zdrt9SdQ09/rWOCiCRa+7zHaadi9S1DbRvKuWYFT19hAMyWerasEUAIBX4rfuDj9gArQv8LVGJpHtnM3R6voyIc1erGIz12YdqxsAT9l+ZthzAeShFm0YaHM0OdooiuK66EffGCYgbTQ7xnPXRLMzu3bkeX6+1KDLAjW/P8npI8ksmoTuq5JKk+4zh4YRAL6d5A+SXB2RxILUoQBIvuPBHKxSzUeCVqt1hgfym9SlzUg+EeX2k5PYeAG4P+g9qRP2NcJw3Lq2kcKRPkt7zTVQ/S2T9XR0EjjUwU2GkHxkenr6lHGe0e411UAkj8lSwXqLzQAA/BX2NTY3G2UI2Oyp7s983ZuWtrLUsINVkh9EtWODjbJq1txut9dG8mbnODPpuuZmG6K3bNcBAM/bkYadz9jxuKvnbwLd1iYix4WllR0O+eDcTgEWKy6j8lWyHODFPEvyZWM3/yeFPVZX40iaFaxAJov/AB/x+nqRD82iAAAAAElFTkSuQmCC",class:"item-icon"}),N(i,{class:"item-label"},{default:w((()=>[R(E(e.$t("todo.customer_phone_label")),1)])),_:1})])),_:1}),N(s,{class:"item-right-text phone-text"},{default:w((()=>[R(E(Q(d).customerPhone),1)])),_:1})])),_:1}),N(s,{class:"flat-item"},{default:w((()=>[N(s,{class:"item-left"},{default:w((()=>[N(a,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD9klEQVR4nO1ZUYgWVRS+W0mRpUQiZZmgL5ZJgQiBRCU9JInhw2rG0trs+b77z7/+ghBhQk2aINFToBKiDz4UJKgPKkIqZUpCFqRi+SBlYWVmbEoZmLZy3DMxLLuz/8z87gz0f3BhYO757nfm3Hvn3HOda6ONNkYdYRjeQ7IbwFaSXwG4QPIKgMNRFN3mqo56vX4fyY0ALpPsH6qJyFJXZXjvXyDZFwsG8DXJVQAWkJxJsmbvLpHcB2BFo9EY56oEEVkK4Jo5cNh7/9jgPjql9F0yOgB+8d7PcVWAiDyh89+EvR1F0S1p/UneKSJPAvjYbC729PQ87MpEZ2fnrSSP2RfelMVWHQaw3Zz5xJUJks+bE+e7urrG5tndbEfrr9Vqj7qyQHKDOfJGAY73jOOd1qrLJuKIiiiyYEk+Z47sa626bCLOmYjxeTmCIJhiHGdcWSD5Q1FHSE4wjp9bqy6biOMqIgzDqXk5wjCcbDvX964sANhsa+TlvBwiMt8icsCVBQAvmogdBTg+NI5VriyQbJiIIwU4frOp9Wpr1WUT8Y2JWFCA45XSpxbJMyZiel4O/QcZxyFXFkhus4jUC3AsN47NrizEO45msHkOTCRf0jzNDlwLb47K5sWstKnxXUa7MfoB7ByzwTnXcfNUZlwrmm40a+O9f9qiedRVBbAfI8m1zdqQ/MAcectVBTJwSrxxHvfePzBSfz0RAvhHW5Yojgri056Wf9KOu93d3XdoH4vGelc1kJygi9ecuT+l30zr81PlqigxNBW3bHiyS5lWFo2TrqqgHbTS1gnJaRaR066qIPm3bcN3p/R5yCLyo6siADxlX/qPtJ+bVU70J3hFRB53VYKILCL5e1xp1BrwcH11I0hkzWdFZK4rGR1aAQGwf4hitVYePyL5jEWnQwVbknmjKplo/+rBTCPqRhO6ZQJYFn9Va31WpNaC3S6SV4erxtu7nQDmkYwGVe6PayZdpJgxInp7e+8luc6q6XER+iyA1wYPbAt6Dcm/EiL1ebWIPDjEVcRqAL8m+v5J8t1arTaxZQ5YFf31QQ4cJLlYM9g0W60HJ8Sl1oYbjcbt3vslJD9NOgTgzZHGGRG2wxxMOLBX86pm7UVkVuKCZ1azdgBmk9ydGPdzzRxyOaHlf5Jfxns+gGezcnjvH4nF6HNWexGZq2Mbx7F6vX5XHkfeN4JvgyCYlJlggCNKTJMoD0cQBJMAnDKOLZmMLR+6qmm2iMxwOQHgRGJ6nMjLw4FEU/Vcy6THdicVsDvv4HFymGxFbqYA7DGedU0bJdaGzzuw3pkM8Q/JfY8CwBvHF1lE/Hc7W8HWl8WRQxUQ3D9M+yxnUNto43+N64tfgZqzuBAqAAAAAElFTkSuQmCC",class:"item-icon"}),N(i,{class:"item-label"},{default:w((()=>[R(E(e.$t("todo.customer_manager_label")),1)])),_:1})])),_:1}),N(s,{class:"item-right-text highlight-text"},{default:w((()=>[R(E(Q(d).customerManagerName||e.$t("todo.manager_none")),1)])),_:1})])),_:1})])),_:1})):(k(),x(s,{key:1,class:"empty-row"},{default:w((()=>[N(i,null,{default:w((()=>[R(E(e.$t("todo.no_customer_attached")),1)])),_:1})])),_:1}))])),_:1}),N(s,{class:"section-header-row"},{default:w((()=>[N(s,{class:"toggle-header",onClick:Qe},{default:w((()=>[N(i,{class:"section-title no-margin"},{default:w((()=>[R(E(e.$t("todo.comments_activities")),1)])),_:1}),N(a,{src:H,class:S(["toggle-icon",{open:Pe.value}])},null,8,["class"])])),_:1}),N(ke,{range:Q(Re),value:Q(De),onClick:t[4]||(t[4]=D((()=>{}),["stop"])),onChange:Q(Ee),title:e.$t("common.filter")},{default:w((()=>[N(s,{class:"filter-badge"},{default:w((()=>[R(E(Q(Re)[Q(De)])+" â–¾",1)])),_:1})])),_:1},8,["range","value","onChange","title"])])),_:1}),Pe.value?(k(),x(s,{key:0,class:"comments-section"},{default:w((()=>[N(s,{class:"comment-input-block",id:"comment-input-anchor"},{default:w((()=>[N(s,{class:"editor-container"},{default:w((()=>[N(G,{ref_key:"todoEditorRef",ref:Fe,modelValue:Q(z),"onUpdate:modelValue":t[5]||(t[5]=e=>F(z)?z.value=e:null),placeholder:Q(ae)?e.$t("todo.comment_placeholder_edit"):Q(fe)?e.$t("todo.comment_placeholder_reply"):e.$t("todo.comment_placeholder_write")},null,8,["modelValue","placeholder"])])),_:1}),Q(ae)?(k(),x(s,{key:0,class:"editing-alert"},{default:w((()=>[N(i,{class:"editing-text"},{default:w((()=>[R(E(e.$t("todo.editing_alert"))+" ",1),N(i,{class:"editing-name"},{default:w((()=>[R(E(Q(de)),1)])),_:1})])),_:1})])),_:1})):T("",!0),Q(fe)&&Q(ve)?(k(),x(s,{key:1,class:"reply-alert"},{default:w((()=>[N(s,{class:"reply-info"},{default:w((()=>[N(i,{class:"reply-label"},{default:w((()=>[R(E(e.$t("todo.replying_alert")),1)])),_:1}),N(i,{class:"reply-name"},{default:w((()=>[R(E(Q(ye)),1)])),_:1})])),_:1}),N(s,{class:"reply-quote"},{default:w((()=>[N(i,{class:"quote-icon"},{default:w((()=>[R("â€œ")])),_:1}),N(y,{nodes:Q(Ve),class:"quote-content"},null,8,["nodes"]),N(i,{class:"quote-icon"},{default:w((()=>[R("â€")])),_:1})])),_:1})])),_:1})):T("",!0),N(s,{class:"input-actions"},{default:w((()=>[Q(ae)||Q(fe)?Q(ae)?(k(),x(s,{key:1,class:"edit-actions-row"},{default:w((()=>[N(be,{type:"secondary",size:"small",label:e.$t("common.cancel"),disabled:Q(B),onClick:Q(ne)},null,8,["label","disabled","onClick"]),N(be,{type:"primary",size:"small",loading:Q(B),label:Q(B)?e.$t("common.saving"):e.$t("todo.update_btn"),onClick:Q(le)},null,8,["loading","label","onClick"])])),_:1})):Q(fe)?(k(),x(s,{key:2,class:"edit-actions-row"},{default:w((()=>[N(be,{type:"secondary",size:"small",label:e.$t("common.cancel"),disabled:Q(B),onClick:Q(Ce)},null,8,["label","disabled","onClick"]),N(be,{type:"primary",size:"small",loading:Q(B),label:Q(B)?e.$t("common.saving"):e.$t("todo.reply_btn"),onClick:Q(_e)},null,8,["loading","label","onClick"])])),_:1})):T("",!0):(k(),x(be,{key:0,type:"primary",size:"small",loading:Q(B),label:Q(B)?e.$t("common.saving"):e.$t("common.save"),onClick:Q(P)},null,8,["loading","label","onClick"]))])),_:1})])),_:1}),N(s,{class:"divider-line"}),Q(M)?(k(),x(s,{key:0,class:"loading-row"},{default:w((()=>[N(i,null,{default:w((()=>[R(E(e.$t("todo.loading_comments")),1)])),_:1})])),_:1})):0===Q(O).length?(k(),x(s,{key:1,class:"empty-row"},{default:w((()=>[N(i,null,{default:w((()=>[R(E(e.$t("todo.no_comments")),1)])),_:1})])),_:1})):(k(),x(s,{key:2},{default:w((()=>[(k(!0),C(I,null,_(Q(O),(e=>(k(),x(Ye,{key:e.id,data:e,onReact:Q(me),onReply:t[6]||(t[6]=e=>(e=>{Ae(e),Ke()})(e)),onEdit:t[7]||(t[7]=e=>(e=>{ie(e.id),Ke()})(e)),onDelete:t[8]||(t[8]=e=>Q(Z)(e))},null,8,["data","onReact"])))),128))])),_:1}))])),_:1})):T("",!0),N(s,{class:"section-header-row"},{default:w((()=>[N(s,{class:"toggle-header",onClick:Q(Be)},{default:w((()=>[N(i,{class:"section-title no-margin"},{default:w((()=>[R(E(e.$t("todo.history_section")),1)])),_:1}),N(a,{src:H,class:S(["toggle-icon",{open:Q(ze)}])},null,8,["class"])])),_:1},8,["onClick"]),N(ke,{range:Q(v),value:Q(A),onClick:t[9]||(t[9]=D((()=>{}),["stop"])),onChange:Q(b),title:e.$t("common.filter")},{default:w((()=>[N(s,{class:"filter-badge"},{default:w((()=>[R(E(Q(v)[Q(A)])+" â–¾",1)])),_:1})])),_:1},8,["range","value","onChange","title"])])),_:1}),Q(ze)?(k(),x(s,{key:1,class:"history-container"},{default:w((()=>[Q(r)?(k(),x(s,{key:0,class:"loading-row"},{default:w((()=>[N(i,{class:"loading-text"},{default:w((()=>[R(E(e.$t("todo.loading_history")),1)])),_:1})])),_:1})):0===Q(c).length?(k(),x(s,{key:1,class:"empty-row"},{default:w((()=>[N(i,null,{default:w((()=>[R(E(e.$t("todo.no_history")),1)])),_:1})])),_:1})):(k(),x(s,{key:2,class:"timeline-list"},{default:w((()=>[(k(!0),C(I,null,_(Q(c),((e,t)=>(k(),x(s,{key:e.id,class:"timeline-item"},{default:w((()=>[t!==Q(c).length-1?(k(),x(s,{key:0,class:"timeline-line"})):T("",!0),N(s,{class:"timeline-dot"}),N(s,{class:"timeline-content"},{default:w((()=>[N(s,{class:"timeline-header"},{default:w((()=>[N(i,{class:"t-actor"},{default:w((()=>[R(E(e.actorName),1)])),_:2},1024),N(i,{class:"t-time"},{default:w((()=>[R(E(e.timeStr),1)])),_:2},1024)])),_:2},1024),N(i,{class:"t-action"},{default:w((()=>[R(E(e.content),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}))])),_:1})):T("",!0),N(s,{style:{height:"50px"}})])),_:1}),N(ee,{visible:Q(oe),"onUpdate:visible":t[10]||(t[10]=e=>F(oe)?oe.value=e:null),title:e.$t("todo.cancel_edit_title"),message:e.$t("todo.cancel_edit_msg"),"cancel-label":e.$t("todo.continue_edit"),"confirm-label":e.$t("common.cancel_action"),"confirm-type":"danger",onCancel:Q(re),onConfirm:Q(ce)},null,8,["visible","title","message","cancel-label","confirm-label","onCancel","onConfirm"]),N(ee,{visible:Q(Oe),"onUpdate:visible":t[11]||(t[11]=e=>F(Oe)?Oe.value=e:null),title:e.$t("todo.cancel_reply_title"),message:e.$t("todo.cancel_reply_msg"),"cancel-label":e.$t("todo.continue_reply"),"confirm-label":e.$t("common.cancel_action"),"confirm-type":"danger",onCancel:Q(Te),onConfirm:Q(Se)},null,8,["visible","title","message","cancel-label","confirm-label","onCancel","onConfirm"]),N(ee,{visible:Q(Y),"onUpdate:visible":t[12]||(t[12]=e=>F(Y)?Y.value=e:null),title:e.$t("todo.delete_comment_title"),message:e.$t("todo.delete_comment_msg"),"confirm-type":"danger",onConfirm:Q(X),onCancel:Q(te)},null,8,["visible","title","message","onConfirm","onCancel"]),Q(ue)?(k(),x(s,{key:1,class:"modal-overlay",onClick:Q(pe)},{default:w((()=>[N(s,{class:"emoji-picker-container",onClick:t[13]||(t[13]=D((()=>{}),["stop"]))},{default:w((()=>[N(s,{class:"emoji-grid"},{default:w((()=>[(k(!0),C(I,null,_(Q(he),((e,t)=>(k(),x(s,{key:t,class:"emoji-item",onClick:t=>Q(ge)(e)},{default:w((()=>[R(E(e),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["onClick"])):T("",!0),N(xe),N(we)])),_:1},8,["class"])}}}),[["__scopeId","data-v-4a8a4b4d"]]);export{Qe as default};
