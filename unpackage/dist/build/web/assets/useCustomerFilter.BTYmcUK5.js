import{j as e,u as a,z as t,A as l,k as s,l as o,w as n,m as d,t as r,E as c,B as u,D as m,p as i,q as f,r as p,Y as _,c as v,F as A,G as g,H as D,I as h,O as k,P as I,Q as U,U as y,S as b,a as C,Z as F,_ as x}from"./index-0xyHw498.js";import{n as B,o as E,_ as M,A as S,U as V,p as w,s as Q}from"./GlobalNotification.D-LYB0lp.js";const J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAACaElEQVR4nO2ZPWgUQRiGJxpFJE0aUUHRQkELBW0U/ClUEBtt1ko5uJ33mdu1kFhJLNbSTqtYaSF2VmIhFoogooU2VgEtFAVFQfz/QU1kYVYOIckmuZ/ZsA9Mc8z3ft97M7c336wxNQED3AEmKzLuTWdkskrDzGTEBA5ljSRJMmwCJUmS4TJG7vtJD9I0HTKBkabpUF6br/HxlBNbrdYKSeN+4u1Go7HMBEIURUsl3fS1PQVWTRuQJMka4LkPuA4sMX0miqLFkq75ml4659aVCnTObZD02gdezbJskekfA5Iu+1rexnG8aVbRcRxvkfQ+F8iFckHTHxMXvYkPwLY5qVhrd0j67IUumB4j6ZzP/dVau3teYsA+4LsXHDU9QtIZn/MncLAjos65w5J+eeFTpssAJ3yu30DUafFjkv4AE8652HQJSceLPJKa3UqSFt+UtfZop/WBI8XKSxrptP7/yUaLveucO9QpXUn7Jf3w2qc7pVvqaSLpG7BnvnrAzuLpKOm86SEDwJhP/NFau32uQs65rcX/FTBm+kBu5pIv4J1zbvNsBay1G4E3fT9BRG1nIEmvrLXry8YCa4EXxZkuy7JBE9Cp9Fmz2Vw9U0ywp2xged5Dz6FdfRhc35O0dW5lR7CdKCV7/uDvBqiNBAa1kcCgNhIY1EYCg9pIYFAbCQxqI4HBQjMC7Cozz4QKcNcXOQFcSdN0ZSWNZFk2KOlkftfli/0i6Wx+QVEpIwX5SuQr4lcmvyoad84dqJyRgvw6FXjS9tu54d9RVstI23YbadtunyppZKrtVlkjBZL2Ao+AW/8+rFmA/AWNPv46WAAdpQAAAABJRU5ErkJggg==",N=M(e({__name:"DateRangeFilter",props:{title:{},startDate:{},endDate:{}},emits:["update:startDate","update:endDate"],setup(e,{emit:p}){const{locale:_}=a(),v=p,A=e=>{v("update:startDate",e)},g=e=>{v("update:endDate",e)};return(e,a)=>{const p=f,v=t(l("uni-datetime-picker"),E);return s(),o(p,{class:"date-filter-block"},{default:n((()=>[e.title?(s(),o(p,{key:0,class:"f-section-title"},{default:n((()=>[d(r(e.title),1)])),_:1})):c("",!0),u(p,{class:"f-row"},{default:n((()=>[u(p,{class:"f-group half"},{default:n((()=>[(s(),o(v,{key:`start-${m(_)}`,type:"date",value:e.startDate,onChange:A,border:!1},{default:n((()=>[u(p,{class:i(["f-picker date",{placeholder:!e.startDate}])},{default:n((()=>[d(r(e.startDate?m(B)(e.startDate):e.$t("common.from_date")),1)])),_:1},8,["class"])])),_:1},8,["value"]))])),_:1}),u(p,{class:"f-group half"},{default:n((()=>[(s(),o(v,{key:`end-${m(_)}`,type:"date",value:e.endDate,onChange:g,border:!1},{default:n((()=>[u(p,{class:i(["f-picker date",{placeholder:!e.endDate}])},{default:n((()=>[d(r(e.endDate?m(B)(e.endDate):e.$t("common.to_date")),1)])),_:1},8,["class"])])),_:1},8,["value"]))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-292b5496"]]),L=M(e({__name:"CustomerModal",props:{visible:{type:Boolean},customers:{},loading:{type:Boolean},managers:{},loadingMore:{type:Boolean}},emits:["close","select","filter","loadMore"],setup(e,{emit:t}){const{t:l}=a(),m=e,C=t,F=p(!1),x=_({name:"",phone:"",managerIndex:0,selectedMemberUID:"",startDate:"",endDate:""}),B=()=>{C("loadMore")},E=v((()=>[l("customer_modal.manager_default"),...(m.managers||[]).map((e=>e.UserName||l("common.unknown_member")))])),M=()=>{F.value=!F.value},w=e=>{const a=parseInt(e.detail.value);if(x.managerIndex=a,0===a)x.selectedMemberUID="";else{const e=m.managers[a-1];e&&(x.selectedMemberUID=e.memberUID)}},Q=()=>{x.name="",x.phone="",x.managerIndex=0,x.selectedMemberUID="",x.startDate="",x.endDate="",L()},L=()=>{C("filter",{name:x.name,phone:x.phone,managerUID:x.selectedMemberUID,startDate:x.startDate,endDate:x.endDate}),F.value=!1},R=()=>{C("close")},$=e=>{if(!e)return"";const a=new Date(e);return`${a.getDate()}/${a.getMonth()+1}/${a.getFullYear()}`};return(e,a)=>{const t=k,l=I,m=f,p=U,_=y,v=b;return e.visible?(s(),o(m,{key:0,class:"modal-overlay",onClick:h(R,["stop"])},{default:n((()=>[u(m,{class:"modal-content",onClick:a[4]||(a[4]=h((()=>{}),["stop"]))},{default:n((()=>[u(m,{class:"modal-header"},{default:n((()=>[u(t,{class:"modal-title"},{default:n((()=>[d(r(e.$t("customer_modal.title")),1)])),_:1}),u(m,{class:"header-actions"},{default:n((()=>[u(m,{class:i(["filter-toggle-btn",{active:F.value}]),onClick:M},{default:n((()=>[u(l,{src:J,class:"filter-icon-img"})])),_:1},8,["class"]),u(t,{class:"close-btn",onClick:R},{default:n((()=>[d("✕")])),_:1})])),_:1})])),_:1}),F.value?(s(),o(m,{key:0,class:"filter-section"},{default:n((()=>[u(m,{class:"f-item"},{default:n((()=>[u(p,{class:"f-input",modelValue:x.name,"onUpdate:modelValue":a[0]||(a[0]=e=>x.name=e),placeholder:e.$t("customer_modal.placeholder_name"),"placeholder-class":"ph-style"},null,8,["modelValue","placeholder"])])),_:1}),u(m,{class:"f-item"},{default:n((()=>[u(p,{class:"f-input",modelValue:x.phone,"onUpdate:modelValue":a[1]||(a[1]=e=>x.phone=e),type:"number",placeholder:e.$t("customer_modal.placeholder_phone"),"placeholder-class":"ph-style"},null,8,["modelValue","placeholder"])])),_:1}),u(m,{class:"f-item"},{default:n((()=>[u(S,{range:E.value,value:x.managerIndex,onChange:w,title:e.$t("customer_modal.manager_default")},{default:n((()=>[u(m,{class:"f-picker-box"},{default:n((()=>[u(t,{class:i(0===x.managerIndex?"text-ph":"text-val")},{default:n((()=>[d(r(E.value[x.managerIndex]),1)])),_:1},8,["class"]),u(t,{class:"arrow"},{default:n((()=>[d("▼")])),_:1})])),_:1})])),_:1},8,["range","value","title"])])),_:1}),u(m,{class:"f-item"},{default:n((()=>[u(N,{startDate:x.startDate,endDate:x.endDate,"onUpdate:startDate":a[2]||(a[2]=e=>x.startDate=e),"onUpdate:endDate":a[3]||(a[3]=e=>x.endDate=e)},null,8,["startDate","endDate"])])),_:1}),u(m,{class:"f-actions"},{default:n((()=>[u(_,{class:"btn-reset",onClick:Q},{default:n((()=>[d(r(e.$t("common.reset")),1)])),_:1}),u(_,{class:"btn-submit",onClick:L},{default:n((()=>[d(r(e.$t("common.filter")),1)])),_:1})])),_:1})])),_:1})):c("",!0),e.loading?(s(),o(m,{key:1,class:"loading-state"},{default:n((()=>[d(r(e.$t("common.loading")),1)])),_:1})):(s(),o(v,{key:2,"scroll-y":"",class:"customer-list",onScrolltolower:B,"lower-threshold":"50"},{default:n((()=>[(s(!0),A(D,null,g(e.customers,((a,l)=>(s(),o(m,{key:a.id,class:"customer-item",onClick:e=>(e=>{C("select",e),R()})(a)},{default:n((()=>[u(V,{name:a.name,size:40,class:"mr-3"},null,8,["name"]),u(m,{class:"info-column"},{default:n((()=>[u(t,{class:"name-text"},{default:n((()=>[d(r(a.name||e.$t("customer_modal.no_name")),1)])),_:2},1024),u(t,{class:"phone-text"},{default:n((()=>[d(r(a.phone||e.$t("customer_modal.no_phone")),1)])),_:2},1024)])),_:2},1024),u(m,{class:"date-column"},{default:n((()=>[u(t,{class:"date-text"},{default:n((()=>[d(r($(a.createAt)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),e.loadingMore?(s(),o(m,{key:0,class:"loading-more-container"},{default:n((()=>[u(t,{class:"loading-more-text"},{default:n((()=>[d(r(e.$t("customer_modal.loading_more")),1)])),_:1})])),_:1})):c("",!0),0===e.customers.length?(s(),o(m,{key:1,class:"empty-state"},{default:n((()=>[d(r(e.$t("common.no_data")),1)])),_:1})):c("",!0)])),_:1}))])),_:1})])),_:1})):c("",!0)}}}),[["__scopeId","data-v-3a4b19dc"]]),R=()=>{const{t:e}=a(),t=C(),l=p([]),s=p(!1),o=p(!1),n=p(1),d=p({}),r=p(!1),c=async(a={},c=!1)=>{if(c){if(r.value||o.value)return;o.value=!0,n.value+=1}else s.value=!0,n.value=1,r.value=!1,d.value=a;try{const u=t.crmToken;if(!u)return;const m=await F(u),i=(e,a)=>{const t=m.find((a=>a.code===e));return t?t.id:a},f=i("create_at",-1),p=i("name",154),_=i("phone",155),v=i("member_no",156),A=c?d.value:a,g=(null==A?void 0:A.name)||"",D=(null==A?void 0:A.phone)||"",h=(null==A?void 0:A.managerUID)||"",k=w(null==A?void 0:A.startDate,null==A?void 0:A.endDate),I={page:n.value,size:15,fieldSearch:[{id:f,value:k,type:"RANGER",isSearch:!!k},{id:p,value:g,type:"CONTAIN",isSearch:!!g},{id:_,value:D,type:"CONTAIN",isSearch:!!D},{id:v,value:h,type:"EQUAL",isSearch:!!h}]},U=(await x(u,I)).map((a=>{const t=a.customerFieldItems.find((e=>"name"===e.code)),l=a.customerFieldItems.find((e=>"phone"===e.code)),s=a.customerFieldItems.find((e=>"member_no"===e.code));return{id:a.id,uid:a.uid,createAt:a.createAt,name:t?t.value:e("common.no_name"),phone:l?l.value:"",code:a.code||"",managerUid:s?s.value:""}}));l.value=c?[...l.value,...U]:U,U.length<15&&(r.value=!0)}catch(u){console.error("Lỗi tải khách hàng:",u),Q(e("todo.error_load_crm")),c||(l.value=[])}finally{s.value=!1,o.value=!1}};return{customerList:l,loadingCustomer:s,loadingMore:o,fetchCustomers:c,loadMoreCustomers:()=>{c(null,!0)}}};export{L as C,N as D,J as _,R as u};
